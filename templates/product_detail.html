{% load youtube_filters %}
{% load math_filters %}
{% load static math_filters %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ product.product_title }} - globesuggest</title>
    <!-- JSON-LD Schema Markup -->
    <script type="application/ld+json">
        {{ product_schema|safe }}
    </script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
        integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="shortcut icon" href="/media/bee_logo.png" type="image/x-icon">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@300..700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Quicksand', sans-serif;
            background-color: #f0f0f0;
            /* Light grey background as in the image */
        }

        .gradient-bg {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        }

        .soft-shadow {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
        }

        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.1);
        }

        .popup {
            display: none;
            position: fixed;
            z-index: 999;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
        }

        .popup-content {
            background-color: white;
            padding: 2rem;
            border-radius: 0.5rem;
            max-width: 800px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        /* Fixed right-side logos: visible on desktop and tablet landscape only */
        .fixed-right-logos {
            position: fixed;
            top: 50%;
            right: 12px;
            transform: translateY(-50%);
            z-index: 40;
            display: none;
            gap: 12px;
            align-items: center;
            flex-direction: column;
        }

        .fixed-right-logos img {
            display: block;
            width: 68px;
            height: auto;
            filter: drop-shadow(0 4px 12px rgba(0, 0, 0, 0.15));
            border-radius: 8px;
            background: transparent;
        }

        .fixed-right-logos .logo-item {
            position: relative;
        }

        .fixed-right-logos .tooltip {
            position: absolute;
            right: 100%;
            top: 50%;
            transform: translate(-6px, -50%);
            background: rgba(15, 23, 42, 0.92);
            color: #fff;
            font-size: 12px;
            line-height: 1;
            padding: 6px 8px;
            border-radius: 6px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity .18s ease, transform .18s ease;
        }

        .fixed-right-logos .tooltip::after {
            content: "";
            position: absolute;
            left: 100%;
            top: 50%;
            transform: translateY(-50%);
            border-width: 6px;
            border-style: solid;
            border-color: transparent transparent transparent rgba(15, 23, 42, 0.92);
        }

        .fixed-right-logos .logo-item:hover .tooltip {
            opacity: 1;
            transform: translate(-2px, -50%);
        }

        /* Desktop */
        @media (min-width: 1024px) {
            .fixed-right-logos {
                display: flex;
            }

            .fixed-right-logos img {
                width: 84px;
            }
        }

        /* Tablet landscape */
        @media (min-width: 768px) and (orientation: landscape) {
            .fixed-right-logos {
                display: flex;
            }

            .fixed-right-logos img {
                width: 55px;
            }
        }

        /* Switch layouts by orientation: mobile + tablet portrait use scroller */
        .video-desktop {
            display: none;
        }

        .video-mobile {
            display: block;
        }

        @media (min-width: 768px) {
            .video-desktop {
                display: flex;
            }

            .video-mobile {
                display: none;
            }
        }

        @media (min-width: 768px) and (orientation: portrait) {
            .video-desktop {
                display: none !important;
            }

            .video-mobile {
                display: block !important;
            }
        }

        @media (min-width: 1024px) {
            .video-desktop {
                display: flex !important;
            }

            .video-mobile {
                display: none !important;
            }
        }

        /* Hide scrollbars for the video scroller */
        .video-scroll {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        .video-scroll::-webkit-scrollbar {
            display: none;
        }

        /* Mobile Search Button & Expanded Search Bar */
        @media (max-width: 639px) {
            .mobile-search-btn {
                position: fixed;
                right: 12px;
                bottom: 70px;
                z-index: 45;
                width: 48px;
                height: 48px;
                border-radius: 50%;
                background: #ffffff;
                box-shadow: 
                    0 6px 20px rgba(0, 0, 0, 0.15),
                    0 3px 8px rgba(0, 0, 0, 0.1),
                    inset 0 1px 1px rgba(255, 255, 255, 1),
                    inset 0 -1px 2px rgba(0, 0, 0, 0.03);
                display: flex;
                align-items: center;
                justify-content: center;
                cursor: pointer;
                transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                border: none;
            }

            .mobile-search-btn:hover {
                box-shadow: 
                    0 8px 25px rgba(0, 0, 0, 0.18),
                    0 4px 10px rgba(0, 0, 0, 0.12),
                    inset 0 1px 1px rgba(255, 255, 255, 1),
                    inset 0 -1px 2px rgba(0, 0, 0, 0.03);
                transform: translateY(-2px);
            }

            .mobile-search-btn:active {
                box-shadow: 
                    0 2px 8px rgba(0, 0, 0, 0.12),
                    0 1px 3px rgba(0, 0, 0, 0.08),
                    inset 0 2px 4px rgba(0, 0, 0, 0.06);
                transform: translateY(1px);
            }

            .mobile-search-btn.active {
                position: fixed;
                left: 50%;
                top: 85px;
                transform: translateX(-50%);
                bottom: auto;
                width: calc(100% - 32px);
                max-width: 400px;
                height: 48px;
                border-radius: 9999px;
                background: #ffffff;
                box-shadow: 
                    0 4px 20px rgba(0, 0, 0, 0.15),
                    0 2px 8px rgba(0, 0, 0, 0.1);
                border: 1px solid rgba(0, 0, 0, 0.08);
            }

            .mobile-search-btn .search-icon-wrapper {
                display: flex;
                align-items: center;
                justify-content: center;
                pointer-events: none;
                transition: all 0.3s ease;
            }

            .mobile-search-btn .search-icon {
                transition: all 0.3s ease;
                color: #000000;
                font-size: 18px;
                pointer-events: none;
            }

            .mobile-search-btn.active .search-icon-wrapper {
                position: absolute;
                left: 16px;
            }

            .mobile-search-btn.active .search-icon {
                color: #6b7280;
            }

            .mobile-search-input {
                width: 0;
                opacity: 0;
                border: none;
                outline: none;
                background: transparent;
                font-size: 15px;
                padding: 0;
                transition: all 0.3s ease 0.1s;
                pointer-events: none;
            }

            .mobile-search-btn.active .mobile-search-input {
                width: calc(100% - 80px);
                opacity: 1;
                padding-left: 44px;
                padding-right: 12px;
                pointer-events: auto;
            }

            .mobile-search-close {
                position: absolute;
                right: 12px;
                width: 28px;
                height: 28px;
                border-radius: 50%;
                background: #f3f4f6;
                display: flex;
                align-items: center;
                justify-content: center;
                opacity: 0;
                transform: scale(0.5);
                transition: all 0.2s ease;
                cursor: pointer;
                pointer-events: none;
            }

            .mobile-search-btn.active .mobile-search-close {
                opacity: 1;
                transform: scale(1);
                pointer-events: auto;
            }

            .mobile-search-close:hover {
                background: #e5e7eb;
            }

            .mobile-search-close:active {
                background: #d1d5db;
                transform: scale(0.95);
            }

            .mobile-search-overlay {
                position: fixed;
                inset: 0;
                background: rgba(0, 0, 0, 0.3);
                z-index: 44;
                opacity: 0;
                pointer-events: none;
                transition: opacity 0.3s ease;
            }

            .mobile-search-overlay.active {
                opacity: 1;
                pointer-events: auto;
            }

            /* Search Results Dropdown */
            .mobile-search-results {
                position: fixed;
                left: 50%;
                top: 140px;
                transform: translateX(-50%);
                width: calc(100% - 32px);
                max-width: 400px;
                max-height: 60vh;
                background: white;
                border-radius: 16px;
                box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
                z-index: 46;
                overflow-y: auto;
                opacity: 0;
                pointer-events: none;
                transition: opacity 0.2s ease, transform 0.2s ease;
            }

            .mobile-search-results.active {
                opacity: 1;
                pointer-events: auto;
            }

            .mobile-search-results::-webkit-scrollbar {
                width: 4px;
            }

            .mobile-search-results::-webkit-scrollbar-thumb {
                background: #d1d5db;
                border-radius: 4px;
            }
        }

        /* Hide on larger screens */
        @media (min-width: 640px) {
            .mobile-search-btn,
            .mobile-search-overlay,
            .mobile-search-results {
                display: none !important;
            }
        }
    </style>
</head>

<body class="bg-gray-50 text-gray-800">
    <header class="fixed sm:static top-0 left-0 right-0 z-50 bg-white">
        <nav class="container mx-auto px-6 py-4 flex justify-between items-center max-container-width">
          <div class="text-sm text-gray-800 flex items-center">
            <a href="/" target="_blank"
              class="flex items-center hover:opacity-90 transition-all duration-200">
              <img src="/media/globesuggest_logo.png" alt="globesuggest Logo" class="h-8 sm:h-10 w-auto">
            </a>
          </div>
          <div class="flex items-center space-x-4">
            <!-- Mobile-only icons replacing the Get Free Quote button -->
            <div class="flex sm:hidden items-center space-x-2" aria-label="Badges">
              <img src="/media/Verified Supplier globesuggest.png" alt="Verified Supplier" class="h-10 w-auto">
              <img src="/media/Original Content By globesuggest.png" alt="Original Content" class="h-10 w-auto">
            </div>
          </div>
        </nav>
    </header>
    <!-- Main Content -->
    <main class="pt-16 sm:pt-0 text-center mx-auto bg-white">
        <!-- Hero Section -->
        <section class="text-center mb-16 pt-16 max-w-6xl mx-auto" data-section="hero">
            <div class="lg:grid lg:grid-cols-2 lg:gap-12 lg:items-center">
                <div class="lg:text-left">
                    <h1 class="sm:text-[2.6rem] text-[2rem] font-bold text-gray-900 mb-[3%] leading-tight">
                        <span id="formatted-title">{{ product.product_title }}</span>
                    </h1>
                    <script>
                        document.addEventListener('DOMContentLoaded', function () {
                            const titleElement = document.getElementById('formatted-title');
                            const titleText = titleElement.innerText;
                            const words = titleText.split(' ');
                            let formattedText = '';

                            for (let i = 0; i < words.length; i++) {
                                formattedText += words[i] + ' ';
                                if ((i + 1) % 3 === 0 && i !== words.length - 1) {
                                    formattedText += '<br>';
                                }
                            }

                            titleElement.innerHTML = formattedText;
                        });
                    </script>
                    <p
                        class="text-[1rem] md:text-base text-gray-600 mb-4 max-w-2xl mx-auto px-4 sm:px-6 md:px-0 sm:leading-normal leading-[25px] font-medium">
                        {{ product.short_description|markdown_links }}
                    </p>

                    <!-- Enquiry button for larger screens -->
                    <div class="hidden lg:flex justify-center lg:justify-start mb-[10%] md:mb-[5%]">
                        <button data-cta="enquiry"
                            onclick="document.getElementById('discuss-your-needs').scrollIntoView({ behavior: 'smooth' });"
                            class="bg-black text-white px-6 py-2 rounded-full font-bold text-base hover:bg-gray-800 transition-transform transform hover:scale-105 duration-300 shadow-lg flex items-center justify-center">
                            Enquiry
                            <span
                                class="ml-3 flex items-center justify-center bg-white text-black h-6 w-6 rounded-full">
                                <i class="fas fa-chevron-right text-xs"></i>
                            </span>
                        </button>
                    </div>

                    <!-- Inline price under ORDER for desktop and tablet landscape only -->
                    <div class="hidden lg:block md:landscape:block mt-2 md:mt-3 lg:mt-4" data-role="price-area">
                        <div class="inline-flex items-baseline gap-2">
                            <span class="text-gray-900 font-bold text-3xl">Price:</span>
                            <span class="text-gray-900 font-bold text-2xl lg:text-3xl">
                                {% if product.price %}
                                ₹{{ product.price }}
                                {% else %}
                                Contact for pricing
                                {% endif %}
                            </span>
                        </div>
                        <br>
                        <div class="inline-flex items-baseline gap-4 mt-2">
                            <span class="text-gray-600 text-lg">Unit: {{ product.price_unit }}</span>
                            <span class="text-gray-600 text-lg">MOQ: {{ product.moq }}</span>
                            <span class="text-gray-600 text-lg">HS Code: {{ product.hs_code }}</span>
                        </div>
                    </div>
                </div>

                <div class="lg:flex lg:justify-end lg:items-center">
                    <!-- Price Section for mobile screens above the image -->
                    <div class="flex lg:hidden justify-center mb-[10%] md:mb-[5%]" data-role="price-area">
                        <div class="px-8 py-0">
                            <div class="flex items-center justify-center">
                                <span class="text-2xl md:text-4xl font-bold text-gray-900">
                                    {% if product.price %}
                                    Price : ₹{{ product.price }}
                                    {% else %}
                                    Contact for pricing
                                    {% endif %}
                                </span>
                                <span class="text-gray-600 text-lg font-medium ml-2 sm:hidden">Per: {{ product.price_unit }}</span>
                            </div>
                            <div class="flex justify-center mt-2">
                                <span class="text-gray-600 text-lg hidden sm:block">Unit: {{ product.price_unit }}</span>
                                <span class="text-gray-600 text-lg font-medium sm:font-normal ml-4">MOQ: {{ product.moq }}</span>
                            </div>
                        </div>
                    </div>

                    {% if product.images %}
                    <div class="relative mb-8 md:mb-12">
                        <div
                            class="absolute inset-0 bg-gradient-to-tr from-blue-300 via-green-200 to-purple-300 opacity-20 blur-3xl -z-10">
                        </div>
                        <img src="https://1matrix.io{{ product.images.0.image }}" alt="{{ product.images.0.alt }}"
                            class="relative w-full sm:max-w-[27rem] max-w-[75%] mx-auto h-auto rounded-2xl -mt-[30px] sm:mb-0">
                    </div>
        {% endif %}

        <script>
            document.addEventListener('DOMContentLoaded', function () {
                const nav = document.getElementById('bs-tabs-nav');
                if (!nav) return;

                const buttons = nav.querySelectorAll('[data-bs-tab-btn]');
                const panels = document.querySelectorAll('[data-bs-tab-panel]');
                if (!buttons.length || !panels.length) return;

                function setActive(targetId) {
                    panels.forEach(panel => {
                        panel.classList.toggle('hidden', panel.id !== targetId);
                    });

                    buttons.forEach(btn => {
                        const t = btn.getAttribute('data-bs-target');
                        const isActive = t === targetId;

                        // Outer button state (active = black bg + black border + white text)
                        btn.classList.toggle('bg-black', isActive);
                        btn.classList.toggle('border-black', isActive);
                        btn.classList.toggle('shadow-md', isActive);
                        btn.classList.toggle('text-white', isActive);

                        btn.classList.toggle('bg-transparent', !isActive);
                        btn.classList.toggle('border-gray-200', !isActive);
                        btn.classList.toggle('shadow-none', !isActive);
                        btn.classList.toggle('text-gray-700', !isActive);

                        // Inner sliding background
                        const bg = btn.querySelector('.tab-bg');
                        if (bg) {
                            bg.classList.toggle('translate-x-0', isActive);
                            bg.classList.toggle('-translate-x-full', !isActive);
                        }

                        // Label color
                        const label = btn.querySelector('.tab-label');
                        if (label) {
                            label.classList.toggle('text-white', isActive);
                            label.classList.toggle('text-gray-700', !isActive);
                        }
                    });
                }

                buttons.forEach(btn => {
                    btn.addEventListener('click', function () {
                        const target = btn.getAttribute('data-bs-target');
                        if (target) setActive(target);
                    });
                });

                // Initialise default active tab - first panel
                const firstPanel = panels[0];
                if (firstPanel) setActive(firstPanel.id);
            });
        </script>

                    <!-- Enquiry button for mobile screens -->
                    <div class="flex lg:hidden justify-center my-[10%] md:mb-[5%]">
                        <button data-cta="enquiry"
                            onclick="document.getElementById('discuss-your-needs').scrollIntoView({ behavior: 'smooth' });"
                            class="bg-black text-white px-6 py-2 rounded-full font-bold text-base hover:bg-gray-800 transition-transform transform hover:scale-105 duration-300 shadow-lg flex items-center justify-center">
                            Quote
                            <span
                                class="ml-3 flex items-center justify-center bg-white text-black h-6 w-6 rounded-full">
                                <i class="fas fa-chevron-right text-xs"></i>
                            </span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Icons -->
            <div class="relative flex justify-center items-center mb-16">
                <div class="absolute w-11/12 sm:w-4/5 md:w-3/5 h-px bg-gray-300"></div>
                <div
                    class="relative flex justify-between items-center w-11/12 sm:w-4/5 md:w-3/5 gap-3 sm:gap-6 md:gap-8">
                    {% if product.trusted_icons %}
                    {% for icon in product.trusted_icons %}
                    <img src="https://1matrix.io{{ icon }}" alt="Trusted Icon"
                        class="w-[70px] h-[70px] sm:w-12 sm:h-12 md:w-16 md:h-16 object-contain z-10 transform hover:scale-105 transition-transform duration-300">
                    {% endfor %}
                    {% else %}
                    <div
                        class="w-10 h-10 sm:w-12 sm:h-12 md:w-16 md:h-16 flex items-center justify-center z-10 transform hover:scale-105 transition-transform duration-300">
                        <i class="fas fa-award text-xl sm:text-2xl md:text-3xl" aria-hidden="true"></i>
                    </div>
                    <div
                        class="w-10 h-10 sm:w-12 sm:h-12 md:w-16 md:h-16 flex items-center justify-center z-10 transform hover:scale-105 transition-transform duration-300">
                        <i class="fas fa-certificate text-xl sm:text-2xl md:text-3xl" aria-hidden="true"></i>
                    </div>
                    <div
                        class="w-10 h-10 sm:w-12 sm:h-12 md:w-16 md:h-16 flex items-center justify-center z-10 transform hover:scale-105 transition-transform duration-300">
                        <i class="fas fa-check-circle text-xl sm:text-2xl md:text-3xl" aria-hidden="true"></i>
                    </div>
                    <div
                        class="w-10 h-10 sm:w-12 sm:h-12 md:w-16 md:h-16 flex items-center justify-center z-10 transform hover:scale-105 transition-transform duration-300">
                        <i class="fas fa-shield-alt text-xl sm:text-2xl md:text-3xl" aria-hidden="true"></i>
                    </div>
                    {% endif %}
                </div>
            </div>
        </section>

        <div class="py-8 lg:py-16 w-full flex flex-col items-center justify-center bg-[rgb(240,240,240,1)]">
            <!-- Details Section -->
            <section class="px-6 lg:px-0 bg-[rgb(240,240,240,1)] w-full text-center md:text-left pb-8 md:pb-16"
                data-section="details">
                <div class="max-w-5xl mx-auto grid grid-cols-1 md:grid-cols-2 gap-x-16 gap-y-8">
                        <div>
                            <h3 class="font-bold text-2xl mb-3">{{product.primary_uses_title}}</h3>
                            {% if product.primary_uses_industries %}
                            <div class="mb-4 flex flex-wrap gap-2 justify-center md:justify-start">
                                {% for industry in product.primary_uses_industries|split:"," %}
                                <span class="inline-block bg-gray-100 text-gray-800 text-xs px-3 py-1 rounded-full font-medium">
                                    {{ industry|strip }}
                                </span>
                                {% endfor %}
                            </div>
                            {% endif %}
                            <p class="text-gray-600 text-sm sm:text-base leading-relaxed font-medium">
                                {{ product.uses|markdown_links }}
                            </p>
                        </div>
                        <div>
                            <h3 class="font-bold text-2xl mb-3">{{product.other_uses_title}}</h3>
                            <p class="text-gray-600 text-sm sm:text-base leading-relaxed font-medium">
                                {{ product.best_suited_for|markdown_links }}
                            </p>
                        </div>
                </div>
            </section>

            <!-- Variations + Technical Details Side-by-Side -->
            <section class="px-6 lg:px-0 bg-[rgb(240,240,240,1)] w-full text-center md:text-left"
                data-section="variations-tech">
                <div class="grid grid-cols-1 md:grid-cols-2 max-w-5xl mx-auto gap-8 md:gap-16 items-start">
                    <!-- Left: Variations -->
                    <div>
                        <div class="flex flex-col items-center md:items-start gap-x-16 gap-y-3">
                            <h2 class="text-xl font-bold text-center md:text-left">Variations</h2>
                            {% if product.variations %}
                            <div class="space-y-1 w-full flex flex-col items-center md:items-start">
                                {% for variation in product.variations %}
                                    {% if "colour" in variation.name|lower or "color" in variation.name|lower %}
                                        <div class="flex flex-col items-center md:items-start w-full">
                                            <h4 class="font-bold text-lg mb-1.5">Colours</h4>
                                            <div
                                                class="flex flex-wrap overflow-visible justify-center md:justify-start gap-2 w-full py-1.5">
                                                {% for option in variation.values %}
                                                <div class="flex items-center bg-white flex-shrink-0">
                                                    <button
                                                        class="px-4 py-1.5 border border-gray-400 rounded-md font-medium text-sm hover:bg-black hover:text-white transition-all duration-200 flex items-center gap-2">
                                                        <span class="w-4 h-4 rounded-full inline-block"
                                                            style="background-color: {{ option.value|default:option }}"></span>
                                                        {{ option.value|default:option }}
                                                        {% if option.price and option.price != "0" %}
                                                        <span class="text-xs text-gray-500">(+{{ option.price }})</span>
                                                        {% endif %}
                                                    </button>
                                                </div>
                                                {% endfor %}
                                            </div>
                                        </div>
                                    {% elif "size" in variation.name|lower or "volume" in variation.name|lower %}
                                        <div class="flex flex-col items-center md:items-start w-full">
                                            <h4 class="font-bold text-lg mb-1.5">{{ variation.name|title }}</h4>
                                            <div
                                                class="flex flex-wrap overflow-visible justify-center md:justify-start gap-2 w-full py-1.5">
                                                {% for option in variation.values %}
                                                <button
                                                    class="px-4 py-1.5 border border-gray-400 rounded-md font-medium text-sm hover:bg-black hover:text-white transition-all duration-200 bg-white flex-shrink-0">
                                                    {{ option.value|default:option }}
                                                    {% if option.price and option.price != "0" %}
                                                    <span class="text-xs text-gray-500">(+{{ option.price }})</span>
                                                    {% endif %}
                                                </button>
                                                {% endfor %}
                                            </div>
                                        </div>
                                    {% elif "weight" in variation.name|lower %}
                                        <div class="flex flex-col items-center md:items-start w-full">
                                            <h4 class="font-bold text-lg mb-1.5">Weight</h4>
                                            <div
                                                class="flex flex-wrap overflow-visible justify-center md:justify-start gap-2 w-full py-1.5">
                                                {% for option in variation.values %}
                                                <button
                                                    class="px-4 py-1.5 border border-gray-400 rounded-md font-medium text-sm hover:bg-black hover:text-white transition-all duration-200 bg-white flex-shrink-0">
                                                    {{ option.value|default:option }}
                                                    {% if option.price and option.price != "0" %}
                                                    <span class="text-xs text-gray-500">(+{{ option.price }})</span>
                                                    {% endif %}
                                                </button>
                                                {% endfor %}
                                            </div>
                                        </div>
                                    {% elif "pack" in variation.name|lower or "quantity" in variation.name|lower %}
                                        <div class="flex flex-col items-center md:items-start w-full">
                                            <h4 class="font-bold text-lg mb-1.5">{{ variation.name|title }}</h4>
                                            <div
                                                class="flex flex-wrap overflow-visible justify-center md:justify-start gap-2 w-full py-1.5">
                                                {% for option in variation.values %}
                                                <button
                                                    class="px-4 py-1.5 border border-gray-400 rounded-md font-medium text-sm hover:bg-black hover:text-white transition-all duration-200 bg-white flex-shrink-0">
                                                    {{ option.value|default:option }}
                                                    {% if option.price and option.price != "0" %}
                                                    <span class="text-xs text-gray-500">(+{{ option.price }})</span>
                                                    {% endif %}
                                                </button>
                                                {% endfor %}
                                            </div>
                                        </div>
                                    {% elif "finish" in variation.name|lower %}
                                        <div class="flex flex-col items-center md:items-start w-full">
                                            <h4 class="font-bold text-lg mb-1.5">{{ variation.name|title }}</h4>
                                            <div
                                                class="flex flex-wrap overflow-visible justify-center md:justify-start gap-2 w-full py-1.5">
                                                {% for option in variation.values %}
                                                <button
                                                    class="px-4 py-1.5 border border-gray-400 rounded-md font-medium text-sm hover:bg-black hover:text-white transition-all duration-200 bg-white flex-shrink-0">
                                                    {{ option.value|default:option }}
                                                    {% if option.price and option.price != "0" %}
                                                    <span class="text-xs text-gray-500">(+{{ option.price }})</span>
                                                    {% endif %}
                                                </button>
                                                {% endfor %}
                                            </div>
                                        </div>
                                    {% else %}
                                        <div class="flex flex-col items-center md:items-start w-full">
                                            <h4 class="font-bold text-lg mb-1.5">{{ variation.name|title }}</h4>
                                            <div
                                                class="flex flex-wrap overflow-visible justify-center md:justify-start gap-2 w-full py-1.5">
                                                {% for option in variation.values %}
                                                <button
                                                    class="px-4 py-1.5 border border-gray-400 rounded-md font-medium text-sm hover:bg-black hover:text-white transition-all duration-200 bg-white flex-shrink-0">
                                                    {{ option.value|default:option }}
                                                    {% if option.price and option.price != "0" %}
                                                    <span class="text-xs text-gray-500">(+{{ option.price }})</span>
                                                    {% endif %}
                                                </button>
                                                {% endfor %}
                                            </div>
                                        </div>
                                    {% endif %}
                                {% endfor %}
                            </div>
                        {% else %}
                        <div class="col-span-2 text-center py-3">
                            <p class="text-gray-500">No variations available for this product.</p>
                        </div>
                        {% endif %}
                    </div>
                </div>

                <!-- Right: Technical Details -->
                <div>
                    <h2 class="text-xl font-bold text-center md:text-left mb-6">Technical Details</h2>
                    <div class="grid grid-cols-3 md:grid-cols-3 gap-4">
                        {% if product.technical_details %}
                        {% for detail in product.technical_details %}
                        <div class="bg-white border border-gray-200 rounded-xl p-4 flex flex-col justify-between"
                            style="width: 100%; max-width: 160px; height: auto;">
                            <div
                                class="text-[12px] tracking-widest uppercase text-gray-500 font-semibold text-left truncate">
                                {{ detail.name }}</div>
                            <div class="mt-1.5 text-sm text-gray-900 font-medium sm:font-semibold text-left truncate">
                                {{ detail.description }}
                            </div>
                        </div>
                        {% endfor %}
                        {% endif %}
                    </div>
                </div>
        </div>
        </section>
        </div>

        <!-- Product Videos -->
        <style>
            /* Switch layouts by orientation: mobile + tablet portrait use scroller */
            .video-desktop {
                display: none;
            }

            .video-mobile {
                display: block;
            }

            @media (min-width: 768px) {
                .video-desktop {
                    display: flex;
                }

                .video-mobile {
                    display: none;
                }
            }

            @media (min-width: 768px) and (orientation: portrait) {
                .video-desktop {
                    display: none !important;
                }

                .video-mobile {
                    display: block !important;
                }
            }

            @media (min-width: 1024px) {
                .video-desktop {
                    display: flex !important;
                }

                .video-mobile {
                    display: none !important;
                }
            }

            /* Hide scrollbars for the video scroller */
            .video-scroll {
                -ms-overflow-style: none;
                scrollbar-width: none;
            }

            .video-scroll::-webkit-scrollbar {
                display: none;
            }
        </style>
        <section class="my-12 md:my-16 max-w-5xl mx-auto" data-section="videos">
            <!-- Responsive view: Three-column hero layout (left text, main video, two side cards) -->
            <div class="grid grid-cols-1 md:grid-cols-12 md:gap-8 justify-center items-stretch">
                <!-- Left: Headline, description, CTA -->
                <div class="col-span-1 md:col-span-5 px-2 ml-4 md:ml-0 flex flex-col justify-between mb-6 md:mb-0">
                    <div class="text-left">
                        <div class="text-left text-gray-900 font-extrabold tracking-tight leading-[1.05]">
                            <div class="text-[36px] md:text-[48px] lg:text-[56px]">Watch.</div>
                            <div class="text-[36px] md:text-[48px] lg:text-[56px] flex">
                                <span>Learn.</span>
                                <span class="ml-4">Grow</span>
                            </div>
                        </div>
                        <p class="mt-6 text-gray-600 text-base font-semibold leading-relaxed max-w-xs text-left">
                            Explore features, benefits,<br>
                            and real uses of our products<br>
                            through the videos
                        </p>
                    </div>
                    <div class="mt-10 flex flex-col gap-4 text-left">
                        {% if product.size_chart %}
                        <a href="{{ product.size_chart }}"
                            class="inline-flex items-center justify-center rounded-full bg-gray-200 text-black w-40 h-12 text-sm font-semibold shadow-sm" target="_blank">
                            Size Chart
                        </a>
                        {% endif %}
                        {% if product.product_catalog %}
                        <a href="{{ product.product_catalog }}"
                            class="inline-flex items-center justify-center rounded-full bg-black text-white w-[13rem] h-12 text-sm font-semibold shadow-sm px-4" target="_blank">
                            Download Catalogue
                        </a>
                        {% endif %}
                    </div>
                </div>

                <!-- Right: Three videos (main video + two stacked videos) -->
                <div class="col-span-1 md:col-span-7 flex flex-col md:flex-row md:items-stretch gap-4 video-desktop">
                    <!-- Main Video Card -->
                    {% if product.product_video_1 or product.video_url_1 %}
                    <div class="flex-1 md:pl-4 lg:pl-6 max-w-[360px] lg:max-w-[400px] mx-auto md:mx-0">
                        <div class="flex flex-col items-center">
                            <div class="bg-white rounded-xl ring-1 ring-gray-200 overflow-hidden transition-all duration-300 flex items-center justify-center relative shadow-sm h-[480px] lg:h-[540px]"
                                 style="aspect-ratio: 1080/1920;">
                                {% if product.product_video_1 %}
                                <video class="w-full h-full object-cover"
                                       poster="https://1matrix.io{{ product.product_video_1_thumb|default:'' }}"
                                       preload="none"
                                       controls autoplay muted loop>
                                    <source src="https://1matrix.io{{ product.product_video_1 }}" type="video/mp4">
                                </video>
                                {% else %}
                                    {% if "shorts" in product.video_url_1 %}
                                    <iframe class="w-full h-full"
                                            src="https://www.youtube-nocookie.com/embed/{{ product.video_url_1|extract_youtube_id }}?modestbranding=1&rel=0&playsinline=1&autoplay=1&mute=1&loop=1&playlist={{ product.video_url_1|extract_youtube_id }}&enablejsapi=1&origin={{ request.scheme }}://{{ request.get_host }}"
                                            frameborder="0" referrerpolicy="strict-origin-when-cross-origin"
                                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                                            allowfullscreen></iframe>
                                    {% else %}
                                    <iframe class="w-full h-full transform -rotate-90 scale-[1.77]"
                                            src="https://www.youtube-nocookie.com/embed/{{ product.video_url_1|extract_youtube_id }}?modestbranding=1&rel=0&playsinline=1&autoplay=1&mute=1&loop=1&playlist={{ product.video_url_1|extract_youtube_id }}&enablejsapi=1&origin={{ request.scheme }}://{{ request.get_host }}"
                                            frameborder="0" referrerpolicy="strict-origin-when-cross-origin"
                                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                                            allowfullscreen></iframe>
                                    {% endif %}
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    {% endif %}

                    <!-- Right: Two stacked video cards -->
                    {% if product.product_video_2 or product.product_video_3 or product.video_url_2 or product.video_url_3 %}
                    <div
                        class="w-full md:w-[160px] lg:w-[150px] {% if product.has_video_2_and_3 %}grid grid-rows-2 h-[480px] lg:h-[540px]{% else %}flex flex-col{% endif %} gap-6">
                        {% if product.product_video_2 or product.video_url_2 %}
                        <div class="{% if product.has_video_2_and_3 %}h-full {% endif %}flex flex-col items-center">
                            <div class="bg-white rounded-xl ring-1 ring-gray-200 overflow-hidden transition-all duration-300 flex items-center justify-center relative shadow-sm {% if product.has_video_2_and_3 %}w-full h-full{% endif %}"
                                style="aspect-ratio: 1080/1920;">
                                {% if product.product_video_2 %}
                                <video class="w-full h-full object-cover"
                                       poster="https://1matrix.io{{ product.product_video_2_thumb|default:'' }}"
                                       preload="none"
                                       controls>
                                    <source src="https://1matrix.io{{ product.product_video_2 }}" type="video/mp4">
                                </video>
                                {% else %}
                                    {% if "shorts" in product.video_url_2 %}
                                    <iframe class="w-full h-full"
                                            src="https://www.youtube-nocookie.com/embed/{{ product.video_url_2|extract_youtube_id }}?modestbranding=1&rel=0&playsinline=1&autoplay=1&mute=1&loop=1&playlist={{ product.video_url_2|extract_youtube_id }}&enablejsapi=1&origin={{ request.scheme }}://{{ request.get_host }}"
                                            frameborder="0" referrerpolicy="strict-origin-when-cross-origin"
                                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                                            allowfullscreen></iframe>
                                    {% else %}
                                    <iframe class="w-full h-full transform -rotate-90 scale-[1.77]"
                                            src="https://www.youtube-nocookie.com/embed/{{ product.video_url_2|extract_youtube_id }}?modestbranding=1&rel=0&playsinline=1&autoplay=1&mute=1&loop=1&playlist={{ product.video_url_2|extract_youtube_id }}&enablejsapi=1&origin={{ request.scheme }}://{{ request.get_host }}"
                                            frameborder="0" referrerpolicy="strict-origin-when-cross-origin"
                                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                                            allowfullscreen></iframe>
                                    {% endif %}
                                {% endif %}
                            </div>
                        </div>
                        {% endif %}

                        {% if product.product_video_3 or product.video_url_3 %}
                        <div class="{% if product.has_video_2_and_3 %}h-full {% endif %}flex flex-col items-center">
                            <div class="bg-white rounded-xl ring-1 ring-gray-200 overflow-hidden transition-all duration-300 flex items-center justify-center relative shadow-sm {% if product.has_video_2_and_3 %}w-full h-full{% endif %}"
                                style="aspect-ratio: 1080/1920;">
                                {% if product.product_video_3 %}
                                <video class="w-full h-full object-cover"
                                       poster="https://1matrix.io{{ product.product_video_3_thumb|default:'' }}"
                                       preload="none"
                                       controls>
                                    <source src="https://1matrix.io{{ product.product_video_3 }}" type="video/mp4">
                                </video>
                                {% else %}
                                    {% if "shorts" in product.video_url_3 %}
                                    <iframe class="w-full h-full"
                                            src="https://www.youtube-nocookie.com/embed/{{ product.video_url_3|extract_youtube_id }}?modestbranding=1&rel=0&playsinline=1&autoplay=1&mute=1&loop=1&playlist={{ product.video_url_3|extract_youtube_id }}&enablejsapi=1&origin={{ request.scheme }}://{{ request.get_host }}"
                                            frameborder="0" referrerpolicy="strict-origin-when-cross-origin"
                                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                                            allowfullscreen></iframe>
                                    {% else %}
                                    <iframe class="w-full h-full transform -rotate-90 scale-[1.77]"
                                            src="https://www.youtube-nocookie.com/embed/{{ product.video_url_3|extract_youtube_id }}?modestbranding=1&rel=0&playsinline=1&autoplay=1&mute=1&loop=1&playlist={{ product.video_url_3|extract_youtube_id }}&enablejsapi=1&origin={{ request.scheme }}://{{ request.get_host }}"
                                            frameborder="0" referrerpolicy="strict-origin-when-cross-origin"
                                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                                            allowfullscreen></iframe>
                                    {% endif %}
                                {% endif %}
                            </div>
                        </div>
                        {% endif %}
                    </div>
                    {% endif %}
                </div>
            </div>
            <!-- Mobile/Tablet Portrait: Horizontal scroll videos with equal card sizes (1080/1920) -->
            <div class="mx-6 md:mx-0 col-span-1 md:col-span-7 max-w-5xl video-mobile">
                <div class="video-scroll overflow-x-auto overflow-y-hidden -mx-2 px-2">
                    <div class="flex gap-4 snap-x snap-mandatory">
                        {% if product.product_video_1 or product.video_url_1 %}
                        <div class="snap-start flex-shrink-0">
                            <div class="bg-white rounded-xl ring-1 ring-gray-200 overflow-hidden transition-all duration-300 flex items-center justify-center relative shadow-sm w-[260px] md:w-[320px]"
                                style="aspect-ratio: 1080/1920;">
                                {% if product.product_video_1 %}
                                <video class="w-full h-full object-cover"
                                       poster="{{ product.product_video_1_thumb|default:'' }}"
                                       preload="none"
                                       controls>
                                    <source src="https://1matrix.io{{ product.product_video_1 }}" type="video/mp4">
                                </video>
                                {% else %}
                                    {% if "shorts" in product.video_url_1 %}
                                    <iframe class="w-full h-full"
                                            src="https://www.youtube-nocookie.com/embed/{{ product.video_url_1|extract_youtube_id }}?modestbranding=1&rel=0&playsinline=1&autoplay=1&mute=1&loop=1&playlist={{ product.video_url_1|extract_youtube_id }}&enablejsapi=1&origin={{ request.scheme }}://{{ request.get_host }}"
                                            frameborder="0" referrerpolicy="strict-origin-when-cross-origin"
                                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                                            allowfullscreen></iframe>
                                    {% else %}
                                    <iframe class="w-full h-full transform -rotate-90 scale-[1.77]"
                                            src="https://www.youtube-nocookie.com/embed/{{ product.video_url_1|extract_youtube_id }}?modestbranding=1&rel=0&playsinline=1&autoplay=1&mute=1&loop=1&playlist={{ product.video_url_1|extract_youtube_id }}&enablejsapi=1&origin={{ request.scheme }}://{{ request.get_host }}"
                                            frameborder="0" referrerpolicy="strict-origin-when-cross-origin"
                                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                                            allowfullscreen></iframe>
                                    {% endif %}
                                {% endif %}
                            </div>
                        </div>
                        {% endif %}
                        {% if product.product_video_2 or product.video_url_2 %}
                        <div class="snap-start flex-shrink-0">
                            <div class="bg-white rounded-xl ring-1 ring-gray-200 overflow-hidden transition-all duration-300 flex items-center justify-center relative shadow-sm w-[260px] md:w-[320px]"
                                style="aspect-ratio: 1080/1920;">
                                {% if product.product_video_2 %}
                                <video class="w-full h-full object-cover"
                                       poster="https://1matrix.io{{ product.product_video_2_thumb|default:'' }}"
                                       preload="none"
                                       controls>
                                    <source src="https://1matrix.io{{ product.product_video_2 }}" type="video/mp4">
                                </video>
                                {% else %}
                                    {% if "shorts" in product.video_url_2 %}
                                    <iframe class="w-full h-full"
                                            src="https://www.youtube-nocookie.com/embed/{{ product.video_url_2|extract_youtube_id }}?modestbranding=1&rel=0&playsinline=1&autoplay=1&mute=1&loop=1&playlist={{ product.video_url_2|extract_youtube_id }}&enablejsapi=1&origin={{ request.scheme }}://{{ request.get_host }}"
                                            frameborder="0" referrerpolicy="strict-origin-when-cross-origin"
                                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                                            allowfullscreen></iframe>
                                    {% else %}
                                    <iframe class="w-full h-full transform -rotate-90 scale-[1.77]"
                                            src="https://www.youtube-nocookie.com/embed/{{ product.video_url_2|extract_youtube_id }}?modestbranding=1&rel=0&playsinline=1&autoplay=1&mute=1&loop=1&playlist={{ product.video_url_2|extract_youtube_id }}&enablejsapi=1&origin={{ request.scheme }}://{{ request.get_host }}"
                                            frameborder="0" referrerpolicy="strict-origin-when-cross-origin"
                                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                                            allowfullscreen></iframe>
                                    {% endif %}
                                {% endif %}
                            </div>
                        </div>
                        {% endif %}
                        {% if product.product_video_3 or product.video_url_3 %}
                        <div class="snap-start flex-shrink-0">
                            <div class="bg-white rounded-xl ring-1 ring-gray-200 overflow-hidden transition-all duration-300 flex items-center justify-center relative shadow-sm w-[260px] md:w-[320px]"
                                style="aspect-ratio: 1080/1920;">
                                {% if product.product_video_3 %}
                                <video class="w-full h-full object-cover"
                                       poster="https://1matrix.io{{ product.product_video_3_thumb|default:'' }}"
                                       preload="none"
                                       controls>
                                    <source src="https://1matrix.io{{ product.product_video_3 }}" type="video/mp4">
                                </video>
                                {% else %}
                                    {% if "shorts" in product.video_url_3 %}
                                    <iframe class="w-full h-full"
                                            src="https://www.youtube-nocookie.com/embed/{{ product.video_url_3|extract_youtube_id }}?modestbranding=1&rel=0&playsinline=1&autoplay=1&mute=1&loop=1&playlist={{ product.video_url_3|extract_youtube_id }}&enablejsapi=1&origin={{ request.scheme }}://{{ request.get_host }}"
                                            frameborder="0" referrerpolicy="strict-origin-when-cross-origin"
                                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                                            allowfullscreen></iframe>
                                    {% else %}
                                    <iframe class="w-full h-full transform -rotate-90 scale-[1.77]"
                                            src="https://www.youtube-nocookie.com/embed/{{ product.video_url_3|extract_youtube_id }}?modestbranding=1&rel=0&playsinline=1&autoplay=1&mute=1&loop=1&playlist={{ product.video_url_3|extract_youtube_id }}&enablejsapi=1&origin={{ request.scheme }}://{{ request.get_host }}"
                                            frameborder="0" referrerpolicy="strict-origin-when-cross-origin"
                                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                                            allowfullscreen></iframe>
                                    {% endif %}
                                {% endif %}
                            </div>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </section>

        <div class="bg-[rgb(240,240,240,1)] pt-8 sm:pt-16 pb-16">
            <!-- Product Showcase Section -->
            <style>
                /* Showcase thumbnails visibility */
                .showcase-desktop {
                    display: none;
                }

                .showcase-mobile {
                    display: block;
                }

                @media (min-width: 768px) and (orientation: landscape) {
                    .showcase-desktop {
                        display: flex !important;
                    }

                    .showcase-mobile {
                        display: none !important;
                    }
                }

                @media (min-width: 1024px) {
                    .showcase-desktop {
                        display: flex !important;
                    }

                    .showcase-mobile {
                        display: none !important;
                    }
                }

                @media (max-width: 767.98px),
                (min-width: 768px) and (orientation: portrait) {
                    .showcase-desktop {
                        display: none !important;
                    }

                    .showcase-mobile {
                        display: block !important;
                        margin: 0 auto;
                    }
                }

                .thumbs-scroll {
                    -ms-overflow-style: none;
                    scrollbar-width: none;
                }

                .thumbs-scroll::-webkit-scrollbar {
                    display: none;
                }
            </style>
            <section class="max-w-5xl mx-auto" data-section="showcase">
                <h2 class="sm:hidden text-xl uppercase tracking-[0.25em] text-gray-800 font-semibold mb-4">About Product
                </h2>
                <!-- Main Product Showcase -->
                <div class="relative w-full overflow-hidden">
                    <div class="grid grid-cols-1 md:grid-cols-2 items-center gap-8 md:gap-2">
                        <!-- Left: Image with vertical thumbnails on md+ -->
                        <div class="order-1 w-full h-full">
                            <div class="flex justify-center items-start gap-4">
                                <!-- Thumbnails (desktop/tablet landscape) -->
                                <div
                                    class="hidden md:flex md:flex-col md:gap-4 md:justify-between md:h-[420px] md:shrink-0 showcase-desktop">
                                    {% if product.images.1 %}
                                    <button type="button"
                                        class="group overflow-hidden focus:outline-none focus-visible:ring-2 focus-visible:ring-gray-900"
                                        data-showcase-thumb data-full="https://1matrix.io{{ product.images.1.image }}">
                                        <img src="https://1matrix.io{{ product.images.1.image }}"
                                            alt="{{ product.images.1.alt|default:'Product image' }}"
                                            class="h-16 w-16 object-cover md:h-20 md:w-20 border border-gray-200 bg-white transition-all duration-200 group-[.is-active]:ring-2 group-[.is-active]:ring-gray-900">
                                    </button>
                                    {% endif %}
                                    {% if product.images.2 %}
                                    <button type="button"
                                        class="group overflow-hidden focus:outline-none focus-visible:ring-2 focus-visible:ring-gray-900"
                                        data-showcase-thumb data-full="https://1matrix.io{{ product.images.2.image }}">
                                        <img src="https://1matrix.io{{ product.images.2.image }}"
                                            alt="{{ product.images.2.alt|default:'Product image' }}"
                                            class="h-16 w-16 object-cover md:h-20 md:w-20 border border-gray-200 bg-white transition-all duration-200">
                                    </button>
                                    {% endif %}
                                    {% if product.images.3 %}
                                    <button type="button"
                                        class="group overflow-hidden focus:outline-none focus-visible:ring-2 focus-visible:ring-gray-900"
                                        data-showcase-thumb data-full="https://1matrix.io{{ product.images.3.image }}">
                                        <img src="https://1matrix.io{{ product.images.3.image }}"
                                            alt="{{ product.images.3.alt|default:'Product image' }}"
                                            class="h-16 w-16 object-cover md:h-20 md:w-20 border border-gray-200 bg-white transition-all duration-200">
                                    </button>
                                    {% endif %}
                                    {% if product.images.4 %}
                                    <button type="button"
                                        class="group overflow-hidden focus:outline-none focus-visible:ring-2 focus-visible:ring-gray-900"
                                        data-showcase-thumb data-full="https://1matrix.io{{ product.images.4.image }}">
                                        <img src="https://1matrix.io{{ product.images.4.image }}"
                                            alt="{{ product.images.4.alt|default:'Product image' }}"
                                            class="h-16 w-16 object-cover md:h-20 md:w-20 border border-gray-200 bg-white transition-all duration-200">
                                    </button>
                                    {% endif %}
                                </div>

                                <!-- Main Image -->
                                <div class="relative w-[420px] h-[420px] flex items-center justify-center">
                                    <img id="mainShowcaseImage" src="https://1matrix.io{{ product.images.1.image }}"
                                        alt="{{ product.images.1.alt }}"
                                        class="w-[95%] h-[95%] md:w-[420px] md:h-[420px] object-contain md:object-cover select-none">
                                </div>
                            </div>
                            <!-- Thumbnails (mobile/tablet portrait) -->
                            <div class="px-4 sm:px-0 showcase-mobile mt-4">
                                <div class="thumbs-scroll overflow-x-auto overflow-y-hidden">
                                    <div class="flex justify-between gap-3 snap-x snap-mandatory">
                                        {% if product.images.1 %}
                                        <button type="button"
                                            class="group inline-flex items-center justify-center overflow-hidden focus:outline-none focus-visible:ring-2 focus-visible:ring-gray-900 border border-gray-200 bg-white h-20 w-20 flex-shrink-0 snap-start"
                                            data-showcase-thumb
                                            data-full="https://1matrix.io{{ product.images.1.image }}">
                                            <img src="https://1matrix.io{{ product.images.1.image }}"
                                                alt="{{ product.images.1.alt|default:'Product image' }}"
                                                class="h-full w-full object-cover transition-all duration-200 group-[.is-active]:ring-2 group-[.is-active]:ring-gray-900">
                                        </button>
                                        {% endif %}
                                        {% if product.images.2 %}
                                        <button type="button"
                                            class="group inline-flex items-center justify-center overflow-hidden focus:outline-none focus-visible:ring-2 focus-visible:ring-gray-900 border border-gray-200 bg-white h-20 w-20 flex-shrink-0 snap-start"
                                            data-showcase-thumb
                                            data-full="https://1matrix.io{{ product.images.2.image }}">
                                            <img src="https://1matrix.io{{ product.images.2.image }}"
                                                alt="{{ product.images.2.alt|default:'Product image' }}"
                                                class="h-full w-full object-cover transition-all duration-200">
                                        </button>
                                        {% endif %}
                                        {% if product.images.3 %}
                                        <button type="button"
                                            class="group inline-flex items-center justify-center overflow-hidden focus:outline-none focus-visible:ring-2 focus-visible:ring-gray-900 border border-gray-200 bg-white h-20 w-20 flex-shrink-0 snap-start"
                                            data-showcase-thumb
                                            data-full="https://1matrix.io{{ product.images.3.image }}">
                                            <img src="https://1matrix.io{{ product.images.3.image }}"
                                                alt="{{ product.images.3.alt|default:'Product image' }}"
                                                class="h-full w-full object-cover transition-all duration-200">
                                        </button>
                                        {% endif %}
                                        {% if product.images.4 %}
                                        <button type="button"
                                            class="group inline-flex items-center justify-center overflow-hidden focus:outline-none focus-visible:ring-2 focus-visible:ring-gray-900 border border-gray-200 bg-white h-20 w-20 flex-shrink-0 snap-start"
                                            data-showcase-thumb
                                            data-full="https://1matrix.io{{ product.images.4.image }}">
                                            <img src="https://1matrix.io{{ product.images.4.image }}"
                                                alt="{{ product.images.4.alt|default:'Product image' }}"
                                                class="h-full w-full object-cover transition-all duration-200">
                                        </button>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Right: ABOUT US copy -->
                        <div class="order-2 px-4 md:pl-8 md:pr-0 pt-8 pb-0 sm:py-8 md:py-0 text-justify">
                            <h2
                                class="uppercase text-4xl sm:text-3xl md:text-4xl font-extrabold tracking-tight text-gray-900 mb-6 text-left">
                                Product <br> Description</h2>
                            <div class="text-base sm:text-[1rem] text-gray-600 mb-8 max-w-xl text-justify">
                                <div id="shortDescription" class="block font-medium sm:font-medium">
                                    {{ product.product_description|safe|truncatewords:68 }}
                                    {% if product.product_description|wordcount > 68 %}
                                    <button id="readMoreBtn"
                                        class="text-blue-600 hover:text-blue-800 font-medium ml-1 focus:outline-none">Read
                                        more</button>
                                    {% endif %}
                                </div>
                                {% if product.product_description|wordcount > 68 %}
                                <div id="fullDescription" class="hidden font-medium sm:font-medium">
                                    {{ product.product_description|safe }}
                                    <button id="readLessBtn"
                                        class="text-blue-600 hover:text-blue-800 font-medium ml-1 focus:outline-none">Read
                                        less</button>
                                </div>
                                {% endif %}
                            </div>
                            <script>
                                document.addEventListener('DOMContentLoaded', function () {
                                    const readMoreBtn = document.getElementById('readMoreBtn');
                                    const readLessBtn = document.getElementById('readLessBtn');
                                    const shortDesc = document.getElementById('shortDescription');
                                    const fullDesc = document.getElementById('fullDescription');

                                    if (readMoreBtn) {
                                        readMoreBtn.addEventListener('click', function () {
                                            shortDesc.classList.add('hidden');
                                            fullDesc.classList.remove('hidden');
                                        });
                                    }

                                    if (readLessBtn) {
                                        readLessBtn.addEventListener('click', function () {
                                            fullDesc.classList.add('hidden');
                                            shortDesc.classList.remove('hidden');
                                        });
                                    }
                                });
                            </script>
                        </div>
                    </div>
                </div>
                <script>
                    document.addEventListener('DOMContentLoaded', function () {
                        const mainImage = document.getElementById('mainShowcaseImage');
                        const thumbButtons = document.querySelectorAll('[data-showcase-thumb]');

                        if (!mainImage || thumbButtons.length === 0) return;

                        // Activate the first thumb
                        const activate = (btn) => {
                            thumbButtons.forEach(b => b.classList.remove('is-active'));
                            btn.classList.add('is-active');
                        };

                        activate(thumbButtons[0]);

                        thumbButtons.forEach((btn) => {
                            const applyChange = () => {
                                const newSrc = btn.getAttribute('data-full');
                                if (newSrc) {
                                    mainImage.src = newSrc;
                                    activate(btn);
                                }
                            };

                            btn.addEventListener('click', (e) => {
                                e.preventDefault();
                                applyChange();
                            });

                            btn.setAttribute('tabindex', '0');
                            btn.addEventListener('keydown', (e) => {
                                if (e.key === 'Enter' || e.key === ' ') {
                                    e.preventDefault();
                                    applyChange();
                                }
                            });
                        });
                    });
                </script>
            </section>
        </div>

        {% if tabs_section %}
        <!-- Dynamic Tabs Section (Why / Guarantee / Quality / QC) -->
        <section id="why-tabs" class="mt-10 md:mt-[1rem] overflow-x-hidden" data-section="why-us">
            <div class="w-full mx-auto px-4 sm:px-6 lg:px-12">
                <div class="overflow-hidden">
                    <nav id="bs-tabs-nav"
                        class="md:px-12 mt-0 sm:mt-8 flex flex-wrap justify-start items-center gap-2 sm:gap-3 md:gap-6 pb-4">
                        {% for tab in tabs_section %}
                        <!-- Uiverse-style tab button -->
                        <button type="button" data-bs-tab-btn data-bs-target="panel-tab-{{ tab.id }}"
                            class="relative flex items-center justify-center whitespace-nowrap px-5 sm:px-6 py-2.5 sm:py-3 overflow-hidden font-medium rounded-full border-2 transition-all duration-300 {% if forloop.first %}bg-black border-black shadow-md text-white{% else %}bg-transparent border-gray-200 text-gray-700{% endif %}">
                            <span
                                class="tab-bg pointer-events-none absolute bottom-0 left-0 w-full h-full rounded-md bg-black transition-all duration-500 ease-in-out {% if forloop.first %}translate-x-0{% else %}-translate-x-full{% endif %}">
                            </span>
                            <!-- Label -->
                            <span
                                class="tab-label relative text-center uppercase tracking-[0.15em] sm:tracking-[0.2em] text-[11px] sm:text-xs font-medium transition-colors duration-200 {% if forloop.first %}text-white{% else %}text-gray-700{% endif %}">
                                {{ tab.tab_name }}
                            </span>
                        </button>
                        {% endfor %}
                    </nav>
                </div>

                <div class="space-y-10">
                    {% for tab in tabs_section %}
                    {% with tab_points=tab.points.all|slice:":5" %}
                    <div id="panel-tab-{{ tab.id }}" data-bs-tab-panel
                        class="{% if not forloop.first %}hidden{% endif %} overflow-x-hidden">
                        <div
                            class="px-2 py-8 sm:px-10 sm:py-10 md:px-12 md:py-12 overflow-x-hidden">
                            <div class="grid gap-8 md:gap-10 md:grid-cols-[minmax(0,1.1fr)_minmax(0,1.4fr)] items-start">
                                <!-- Left column (hero point) -->
                                <div class="space-y-6 md:space-y-7 text-left">
                                    {% if tab_points.0 %}
                                    <div class="text-left">
                                        <span
                                            class="inline-flex h-10 w-10 items-center justify-center rounded-full bg-white shadow-[0_10px_25px_rgba(15,23,42,0.12)] ring-1 ring-black/5">
                                            {% if tab_points.0.icon %}
                                            <img src="{{ tab_points.0.icon.url }}" alt="{{ tab_points.0.title }}"
                                                class="h-5 w-5 object-contain">
                                            {% else %}
                                            <i class="fas fa-circle text-[10px] text-blue-600"></i>
                                            {% endif %}
                                        </span>
                                    </div>
                                    <div class="text-left">
                                        <h2
                                            class="text-2xl sm:text-3xl md:text-[2.2rem] font-semibold tracking-tight text-gray-900 text-left">
                                            {{ tab_points.0.title }}
                                        </h2>
                                        <p
                                            class="mt-3 text-md sm:text-sm font-medium sm:font-normal md:text-base text-gray-600 leading-relaxed max-w-md text-left">
                                            {{ tab_points.0.description }}
                                        </p>
                                    </div>
                                    {% endif %}
                                </div>

                                <!-- Right column (remaining points as cards) -->
                                <!-- Desktop / tablet landscape: original 2-column grid layout -->
                                <div
                                    class="tab-points-desktop grid grid-cols-2 sm:grid-cols-2 gap-4 sm:gap-5 md:gap-6 items-stretch">
                                    {% if tab_points|length > 1 %}
                                    {% for point in tab_points|slice:"1:" %}
                                    <article
                                        class="group relative items-start flex flex-col rounded-2xl p-6 sm:p-7 bg-white text-gray-900 shadow-[0_0_10px_rgba(0,0,0,0.1)]">
                                        <div
                                            class="mb-4 inline-flex h-8 w-8 items-center justify-center rounded-full bg-white text-blue-600">
                                            {% if point.icon %}
                                            <img src="{{ point.icon.url }}" alt="{{ point.title }}"
                                                class="h-4 w-4 object-contain">
                                            {% else %}
                                            <i class="fas fa-circle text-[9px]"></i>
                                            {% endif %}
                                        </div>
                                        <h3 class="text-sm sm:text-[15px] font-semibold text-gray-900 text-left">
                                            {{ point.title }}
                                        </h3>
                                        <p
                                            class="mt-2 text-sm sm:text-sm font-medium leading-relaxed text-gray-600 text-left">
                                            {{ point.description }}
                                        </p>
                                    </article>
                                    {% endfor %}
                                    {% else %}
                                    <div
                                        class="col-span-1 sm:col-span-2 text-xs text-gray-500 text-center py-8">
                                        No points configured for this tab yet.
                                    </div>
                                    {% endif %}
                                </div>

                            </div>

                            <!-- Mobile & tablet portrait: horizontal scroll (same as blog cards) -->
                            {% if tab_points|length > 1 %}
                            <div class="tab-points-mobile mt-6 -mx-2 sm:-mx-10 md:-mx-12">
                                <div class="tab-points-scroll overflow-x-auto overflow-y-visible px-2 sm:px-10 md:px-12">
                                    <div class="flex gap-4 snap-x snap-mandatory" style="width: max-content;">
                                        {% for point in tab_points|slice:"1:" %}
                                        <article
                                            class="group snap-start flex-shrink-0 w-[260px] relative items-start flex flex-col rounded-2xl p-5 bg-[rgb(240,240,240,1)] text-gray-900 border border-black/5 shadow-[0_10px_30px_rgba(15,23,42,0.08)]">
                                            <div
                                                class="mb-3 inline-flex h-8 w-8 items-center justify-center rounded-full bg-white text-blue-600">
                                                {% if point.icon %}
                                                <img src="{{ point.icon.url }}" alt="{{ point.title }}"
                                                    class="h-4 w-4 object-contain">
                                                {% else %}
                                                <i class="fas fa-circle text-[9px]"></i>
                                                {% endif %}
                                            </div>
                                            <h3 class="text-sm font-semibold text-gray-900 text-left">
                                                {{ point.title }}
                                            </h3>
                                            <p class="mt-2 text-sm font-medium leading-relaxed text-gray-600 text-left">
                                                {{ point.description }}
                                            </p>
                                        </article>
                                        {% endfor %}
                                    </div>
                                </div>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    {% endwith %}
                    {% endfor %}
                </div>
            </div>
        </section>
        {% endif %}

        <!-- Technical Details Section moved next to Variations -->

        <style>
            /* Tabs right-column layout behavior by device */
            .tab-points-desktop {
                display: none;
            }

            .tab-points-mobile {
                display: block;
            }

            @media (min-width: 768px) {
                .tab-points-desktop {
                    display: grid;
                }

                .tab-points-mobile {
                    display: none;
                }
            }

            @media (min-width: 768px) and (orientation: portrait) {
                .tab-points-desktop {
                    display: none !important;
                }

                .tab-points-mobile {
                    display: block !important;
                }
            }

            @media (min-width: 1024px) {
                .tab-points-desktop {
                    display: grid !important;
                }

                .tab-points-mobile {
                    display: none !important;
                }
            }

            /* Hide scrollbars for tab points scroller (same as blog) */
            .tab-points-scroll {
                -ms-overflow-style: none;
                scrollbar-width: none;
            }

            .tab-points-scroll::-webkit-scrollbar {
                display: none;
            }
        </style>

        <div class="bg-[rgb(240,240,240,1)] py-8 sm:py-16">
            <h2 class="hidden sm:block text-3xl font-bold text-center text-gray-700 mb-[3rem]">Comparison - Us vs Others
            </h2>
            <h2 class="sm:hidden text-3xl font-bold text-center text-gray-700 mb-1">Comparison</h2>
            <span class="sm:hidden block text-base font-medium text-center text-gray-700 mb-[2rem]">Us vs Others</span>
            <section id="comparison-section" class="mb-8 max-w-5xl mx-auto pl-4" data-section="comparison">
                {% if product.comparisons %}
                <!-- New UI (matches the reference) using product.comparisons -->
                <!-- Desktop / Tablet -->
                <div class="hidden md:block relative">
                    <!-- Center floating card -->
                    <div
                        class="pointer-events-none absolute inset-y-2 left-1/2 -translate-x-1/2 w-[40%] bg-white/90 shadow-[0_20px_60px_rgba(0,0,0,0.08)] rounded-xl z-0">
                    </div>
                    <!-- Center card top label -->
                    <div class="absolute -top-3 left-1/2 -translate-x-1/2 z-10">
                        <div
                            class="px-3 py-1 rounded-full bg-white shadow ring-1 ring-black/5 text-[11px] font-semibold tracking-wide">
                            US</div>
                    </div>
                    <!-- Headings row -->
                    <div class="grid grid-cols-3 text-sm text-gray-600 z-10 relative">
                        <div></div>
                        <div class="text-center font-medium">&nbsp;</div>
                        <div class="text-center font-medium">Our Competitors</div>
                    </div>
                    <!-- Rows -->
                    <div class="mt-4 divide-y divide-gray-300 z-10 relative bg-transparent">
                        {% for row in product.comparisons %}
                        <div class="grid grid-cols-3 items-start py-5">
                            <!-- Feature name -->
                            <div class="pr-6">
                                <div class="font-semibold text-left text-gray-900">{{ row.content }}</div>
                            </div>
                            <!-- Our cell -->
                            <div class="px-6">
                                <div class="flex items-center justify-center gap-3">
                                    <p class="text-sm text-gray-800 font-semibold sm:font-medium">
                                        {{ row.you|default:'Included' }}
                                    </p>
                                </div>
                            </div>
                            <!-- Competitor cell -->
                            <div class="pl-6 flex items-start justify-center">
                                <p class="text-sm text-gray-700 sm:font-medium text-center">
                                    {{ row.others|default:'—' }}
                                </p>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>

                <!-- Mobile: table layout like desktop -->
                <div class="md:hidden relative">
                    <!-- Center floating card for US column -->
                    <div
                        class="pointer-events-none absolute inset-y-1 left-1/2 -translate-x-1/2 w-1/3 bg-white shadow-[0_12px_36px_rgba(0,0,0,0.07)] rounded-xl z-0">
                    </div>
                    <!-- US label on the floating card -->
                    <div class="absolute -top-2 left-1/2 -translate-x-1/2 z-10">
                        <div
                            class="px-2 py-0.5 rounded-full bg-white shadow ring-1 ring-black/5 text-[10px] font-semibold tracking-wide">
                            US</div>
                    </div>
                    <!-- Headings row -->
                    <div class="grid grid-cols-3 text-xs text-gray-600 z-10 relative">
                        <div></div>
                        <div class="text-center font-medium">&nbsp;</div>
                        <div class="text-center rounded-full bg-white py-1 px-2 mx-auto font-medium">Others</div>
                    </div>
                    <!-- Rows -->
                    <div class="mt-3 divide-y divide-gray-200 z-10 relative bg-transparent">
                        {% for row in product.comparisons %}
                        <div class="grid grid-cols-3 items-start py-4">
                            <!-- Feature name -->
                            <div class="pr-3">
                                <div class="font-semibold text-left text-gray-900 text-sm">{{ row.content }}</div>
                            </div>
                            <!-- Our cell -->
                            <div class="px-2">
                                <div class="flex items-center gap-2 text-center justify-center">
                                    <p class="text-xs text-center text-gray-800 font-semibold sm:font-normal">
                                        {{ row.you|default:'Included'|truncatewords:5 }}
                                    </p>
                                </div>
                            </div>
                            <!-- Competitor cell -->
                            <div class="flex items-start justify-center px-1">
                                <p class="text-xs text-center text-gray-700 font-semibold">
                                    {{ row.others|default:'—'|truncatewords:4 }}
                                </p>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% else %}
                <!-- Fallback to existing implementation when comparisons_formatted is provided -->
                <!-- Desktop view (previous design) -->
                <div class="hidden md:grid md:grid-cols-2 gap-8">
                    <!-- Us Column -->
                    <div>
                        <h2 class="text-2xl font-bold text-gray-700 mb-6">Us</h2>
                        <div class="space-y-4">
                            {% for comparison in product.comparisons_formatted %}
                            <div class="flex bg-green-50 rounded-lg p-4 hover:shadow-md transition-shadow duration-300">
                                <div class="flex items-center justify-start w-16 h-16 mr-4">
                                    {% if comparison.our.icon %}
                                    <img src="https://1matrix.io{{ comparison.our.icon }}"
                                        alt="{{ comparison.our.title }} icon" class="w-12 h-12 object-contain">
                                    {% else %}
                                    <i class="fas fa-check-circle text-gray-800 text-2xl"></i>
                                    {% endif %}
                                </div>
                                <div class="text-left">
                                    <h3 class="font-semibold text-gray-800">{{ comparison.our.title }}</h3>
                                    <p class="text-sm text-gray-600">{{ comparison.our.description }}</p>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                    <!-- Other Column -->
                    <div>
                        <h2 class="text-2xl font-bold text-gray-700 mb-6">Other</h2>
                        <div class="space-y-4">
                            {% for comparison in product.comparisons_formatted %}
                            <div class="flex bg-red-50 rounded-lg p-4 hover:shadow-md transition-shadow duration-300">
                                <div class="flex items-center justify-center w-16 h-16 mr-4">
                                    {% if comparison.others.icon %}
                                    <img src="https://1matrix.io{{ comparison.others.icon }}"
                                        alt="{{ comparison.others.title }} icon" class="w-12 h-12 object-contain">
                                    {% else %}
                                    <i class="fas fa-exclamation-circle text-gray-800 text-2xl"></i>
                                    {% endif %}
                                </div>
                                <div class="text-left">
                                    <h3 class="font-semibold text-gray-800">{{ comparison.others.title }}</h3>
                                    <p class="text-sm text-gray-600">{{ comparison.others.description }}</p>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
                <!-- Mobile view (previous design) -->
                <div class="md:hidden space-y-8">
                    <h2 class="text-2xl font-bold text-center text-gray-700 mb-6">Comparison</h2>
                    {% for comparison in product.comparisons_formatted %}
                    <div class="space-y-4">
                        <div class="grid grid-cols-2 gap-4">
                            <div class="text-center">
                                <h3 class="text-lg font-bold text-gray-700 mb-2 text-center">Us</h3>
                                <div
                                    class="flex flex-col items-center bg-green-50 rounded-lg p-4 hover:shadow-md transition-shadow duration-300">
                                    <div class="flex items-center justify-center w-20 h-20">
                                        {% if comparison.our.icon %}
                                        <img src="https://1matrix.io{{ comparison.our.icon }}"
                                            alt="{{ comparison.our.title }} icon" class="w-16 h-16 object-contain">
                                        {% else %}
                                        <i class="fas fa-check-circle text-green-600 text-4xl"></i>
                                        {% endif %}
                                    </div>
                                    <div class="text-center">
                                        <h3 class="font-semibold text-gray-800">{{ comparison.our.title }}</h3>
                                        <p class="text-sm text-gray-600">{{ comparison.our.description }}</p>
                                    </div>
                                </div>
                            </div>
                            <div class="text-center">
                                <h3 class="text-lg font-bold text-gray-700 mb-2 text-center">Other</h3>
                                <div
                                    class="flex flex-col items-center justify-center bg-red-50 rounded-lg p-4 hover:shadow-md transition-shadow duration-300">
                                    <div class="flex items-center justify-center w-20 h-20">
                                        {% if comparison.others.icon %}
                                        <img src="https://1matrix.io{{ comparison.others.icon }}"
                                            alt="{{ comparison.others.title }} icon" class="w-16 h-16 object-contain">
                                        {% else %}
                                        <i class="fas fa-exclamation-circle text-red-500 text-4xl"></i>
                                        {% endif %}
                                    </div>
                                    <div class="text-center">
                                        <h3 class="font-semibold text-gray-800">{{ comparison.others.title }}</h3>
                                        <p class="text-sm text-gray-600">{{ comparison.others.description }}</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% if not forloop.last %}
                        <div class="border-b border-gray-200 my-6"></div>
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
                {% endif %}
            </section>
        </div>

        <!-- Blog Section -->
        <section id="blog" class="py-12 px-4 md:py-16 bg-white sm:px-6 md:px-10 lg:px-16 xl:px-24"
            data-section="blog">
            <style>
                /* Blog visibility: mobile + tablet portrait use scroller */
                .blog-desktop {
                    display: none;
                }

                .blog-mobile {
                    display: block;
                }

                @media (min-width: 768px) {
                    .blog-desktop {
                        display: block;
                    }

                    .blog-mobile {
                        display: none;
                    }
                }

                @media (min-width: 768px) and (orientation: portrait) {
                    .blog-desktop {
                        display: none !important;
                    }

                    .blog-mobile {
                        display: block !important;
                    }
                }

                @media (min-width: 1024px) {
                    .blog-desktop {
                        display: block !important;
                    }

                    .blog-mobile {
                        display: none !important;
                    }
                }

                /* Hide scrollbars for blog scroller */
                .blog-scroll {
                    -ms-overflow-style: none;
                    scrollbar-width: none;
                }

                .blog-scroll::-webkit-scrollbar {
                    display: none;
                }
            </style>
            <div class="max-w-5xl mx-auto sm:px-4">
                <div class="text-center max-w-4xl mx-auto mb-8">
                    <h2 class="text-4xl font-bold text-center text-gray-700 mb-2">Blogs</h2>
                    <p class="mt-2 text-sm text-gray-500 font-medium">Latest inspirations and stories</p>
                </div>

                <!-- Desktop / Tablet Landscape: Grid -->
                <div class="blog-desktop">
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 md:gap-8">
                        {% for post in product.blog_posts %}
                        {% if forloop.counter <= 3 %} <article class="group">
                            <a href="{% if product.product_id %}{% url 'blog_detail' product.product_id forloop.counter %}{% else %}#{% endif %}"
                                class="relative block">
                                <div class="relative w-full aspect-[4/5] overflow-hidden bg-gray-100">
                                    <img src="https://1matrix.io{% if post.image %}{{ post.image }}{% else %}https://1matrix.io/media/product_images/about-us-img-1.webp{% endif %}"
                                        alt="{{ post.title }}"
                                        class="absolute inset-0 w-full h-full object-cover transition-transform duration-700 ease-out group-hover:scale-105"
                                        data-no-srcset="true" />
                                </div>
                                <div class="absolute inset-x-6 bottom-6">
                                    <div class="bg-white p-5 sm:p-6 shadow-md ring-1 ring-black/5">
                                        <p class="text-[10px] uppercase tracking-[0.3em] text-gray-500">BLOG</p>
                                        <h3 class="mt-2 text-base sm:text-base font-medium text-gray-900 leading-snug">
                                            {{ post.title|truncatewords:10 }}</h3>
                                    </div>
                                </div>
                            </a>
                            </article>
                            {% endif %}
                            {% endfor %}
                    </div>
                </div>

                <!-- Mobile + Tablet Portrait: Horizontal scroll with hidden scrollbar -->
                <div class="blog-mobile">
                    <div class="blog-scroll overflow-x-auto overflow-y-hidden -mx-2 px-2">
                        <div class="flex gap-4 snap-x snap-mandatory">
                        {% for post in product.blog_posts %}
                        {% if forloop.counter <= 3 %} <article
                                class="group snap-start flex-shrink-0 w-[260px] md:w-[320px]">
                                <a href="{% if product.product_id %}{% url 'blog_detail' product.product_id forloop.counter %}{% else %}#{% endif %}"
                                    class="relative block">
                                    <div class="relative w-full aspect-[4/5] overflow-hidden bg-gray-100">
                                        <img src="https://1matrix.io{% if post.image %}{{ post.image }}{% else %}https://1matrix.io/media/product_images/about-us-img-1.webp{% endif %}"
                                            alt="{{ post.title }}"
                                            class="absolute inset-0 w-full h-full object-cover transition-transform duration-700 ease-out group-hover:scale-105"
                                            data-no-srcset="true" />
                                    </div>
                                    <div class="absolute inset-x-6 bottom-6">
                                        <div class="bg-white p-4 sm:p-6 shadow-md ring-1 ring-black/5">
                                            <p class="text-[10px] uppercase tracking-[0.3em] text-gray-500">BLOG</p>
                                            <h3
                                                class="mt-2 text-sm sm:text-lg md:text-xl font-medium text-gray-900 leading-snug">
                                                {{ post.title|truncatewords:10 }}
                                            </h3>
                                        </div>
                                    </div>
                                </a>
                                </article>
                                {% endif %}
                                {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- FAQ Section -->
        {% if product and product.faqs_formatted %}
        <section id="faqs-section" class="py-16 md:py-20 bg-[rgb(234,231,231,1)]" data-section="faqs">
            <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="text-center mb-10 md:mb-14">
                    <h2
                        class="text-3xl md:text-4xl lg:text-5xl mx-[1.2rem] md:mx-0 font-semibold tracking-tight text-gray-900">
                        <span>Frequently asked </span>
                        <span class="relative inline-block"><span>questions</span></span>
                    </h2>
                    <p class="mt-4 font-medium text-sm md:text-base text-gray-600 max-w-2xl mx-auto">
                        Here are some common questions about this product.
                    </p>
                </div>

                <style>
                    @media (max-width: 767px) {
                        .no-scrollbar::-webkit-scrollbar {
                            display: none;
                        }

                        .no-scrollbar {
                            -ms-overflow-style: none;
                            scrollbar-width: none;
                        }
                    }
                </style>
                <div id="faqs-grid" class="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-5 mx-5 md:mx-0">
                    {% for faq in product.faqs_formatted %}
                    <div class="group self-start bg-white rounded-xl ring-1 ring-gray-100 shadow-[0_0px_4px_rgba(0,0,0,0.05)] p-3 md:p-4"
                        data-faq-item>
                        <button type="button"
                            class="faq-toggle list-none cursor-pointer flex w-full items-center justify-between"
                            aria-expanded="false" aria-controls="faq-panel-{{ forloop.counter0 }}">
                            <h3 class="text-sm md:text-sm font-medium text-gray-900 text-left">
                                {{ faq.question|default:"Question"|markdown_links }}
                            </h3>
                            <span
                                class="flex h-6 w-6 flex-shrink-0 items-center justify-center rounded-full bg-black text-white ring-1 ring-black/10 shadow-sm transition-transform ml-2">
                                <svg class="h-3 w-3 icon-plus" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 5v14M5 12h14" />
                                </svg>
                                <svg class="h-3 w-3 icon-minus hidden" viewBox="0 0 24 24" fill="none"
                                    stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M5 12h14" />
                                </svg>
                            </span>
                        </button>
                        <div id="faq-panel-{{ forloop.counter0 }}"
                            class="faq-panel mt-0 max-h-0 text-left overflow-hidden text-sm md:text-sm text-gray-600 font-medium sm:font-normal leading-relaxed transition-[max-height,margin] duration-300 ease-in-out">
                            {{ faq.answer|default:"Answer"|markdown_links }}
                        </div>
                    </div>
                    {% empty %}
                    <div class="md:col-span-2 text-center text-gray-500">FAQs will appear here once added.</div>
                    {% endfor %}
                </div>
                <div id="faq-dots" class="mt-6 flex justify-center space-x-2 md:hidden"></div>
            </div>
        </section>
        <script>
            document.addEventListener('DOMContentLoaded', function () {
                const section = document.getElementById('faqs-section');
                if (!section) return;
                const grid = section.querySelector('#faqs-grid');
                const dotsContainer = section.querySelector('#faq-dots');
                const mqMobile = window.matchMedia('(max-width: 767px)');
                const originalFaqItems = Array.from(section.querySelectorAll('[data-faq-item]'));
                let slider = null;

                const buildSlider = () => {
                    if (slider || !mqMobile.matches || !grid) return;
                    slider = document.createElement('div');
                    slider.className = 'faq-slider flex overflow-x-auto snap-x snap-mandatory scroll-smooth -mx-5 px-5 no-scrollbar space-x-4 md:hidden';

                    for (let i = 0; i < originalFaqItems.length; i += 4) {
                        const slide = document.createElement('div');
                        slide.className = 'min-w-full shrink-0 snap-center flex flex-col items-stretch gap-4';
                        originalFaqItems.slice(i, i + 4).forEach(item => {
                            // Ensure each FAQ fits mobile viewport width
                            item.classList.add('w-full');
                            item.classList.remove('self-start');
                            item.classList.add('mx-auto');
                            try {
                                item.style.width = '100%';
                                item.style.maxWidth = 'calc(100vw - 48px)';
                            } catch (e) { }
                            slide.appendChild(item);
                        });
                        slider.appendChild(slide);
                    }

                    grid.innerHTML = '';
                    grid.appendChild(slider);

                    const slidesCount = Math.ceil(originalFaqItems.length / 4);
                    dotsContainer.innerHTML = '';
                    if (slidesCount > 1) {
                        for (let i = 0; i < slidesCount; i++) {
                            const dot = document.createElement('button');
                            dot.type = 'button';
                            dot.setAttribute('aria-label', `Go to page ${i + 1}`);
                            dot.setAttribute('aria-current', i === 0 ? 'true' : 'false');
                            dot.className = 'h-2 w-2 rounded-full bg-gray-300 aria-[current=true]:bg-gray-900';
                            dot.addEventListener('click', () => {
                                if (!slider) return;
                                const slides = Array.from(slider.children);
                                const target = slides[i];
                                if (target) slider.scrollTo({ left: target.offsetLeft, behavior: 'smooth' });
                            });
                            dotsContainer.appendChild(dot);
                        }

                        const updateDots = () => {
                            if (!slider) return;
                            const slides = Array.from(slider.children);
                            let idx = 0;
                            let minDelta = Infinity;
                            slides.forEach((s, j) => {
                                const delta = Math.abs(slider.scrollLeft - s.offsetLeft);
                                if (delta < minDelta) { minDelta = delta; idx = j; }
                            });
                            const dots = Array.from(dotsContainer.children);
                            dots.forEach((d, j) => d.setAttribute('aria-current', j === idx ? 'true' : 'false'));
                        };
                        slider.addEventListener('scroll', () => { window.requestAnimationFrame(updateDots); });
                    }
                };

                const destroySlider = () => {
                    if (!slider || !grid) return;
                    const slides = Array.from(slider.children);
                    slides.forEach(slide => {
                        while (slide.firstChild) {
                            // Restore original sizing classes when moving back to grid
                            slide.firstChild.classList.remove('w-full');
                            slide.firstChild.classList.add('self-start');
                            slide.firstChild.classList.remove('mx-auto');
                            try {
                                slide.firstChild.style.width = '';
                                slide.firstChild.style.maxWidth = '';
                            } catch (e) { }
                            grid.insertBefore(slide.firstChild, slider);
                        }
                    });
                    slider.remove();
                    slider = null;
                    dotsContainer.innerHTML = '';
                };

                const handleResponsive = () => {
                    if (mqMobile.matches) { buildSlider(); } else { destroySlider(); }
                };

                handleResponsive();
                mqMobile.addEventListener('change', handleResponsive);

                const items = Array.from(section.querySelectorAll('[data-faq-item]'));
                let openItem = null;
                const closeItem = (item) => {
                    if (!item) return;
                    const button = item.querySelector('.faq-toggle');
                    const panel = item.querySelector('.faq-panel');
                    const iconPlus = item.querySelector('.icon-plus');
                    const iconMinus = item.querySelector('.icon-minus');
                    button.setAttribute('aria-expanded', 'false');
                    panel.style.maxHeight = '0px';
                    panel.classList.remove('mt-3');
                    panel.classList.add('mt-0');
                    if (iconPlus) iconPlus.classList.remove('hidden');
                    if (iconMinus) iconMinus.classList.add('hidden');
                };
                const openItemFn = (item) => {
                    const button = item.querySelector('.faq-toggle');
                    const panel = item.querySelector('.faq-panel');
                    const iconPlus = item.querySelector('.icon-plus');
                    const iconMinus = item.querySelector('.icon-minus');
                    button.setAttribute('aria-expanded', 'true');
                    panel.style.maxHeight = panel.scrollHeight + 'px';
                    panel.classList.remove('mt-0');
                    panel.classList.add('mt-3');
                    if (iconPlus) iconPlus.classList.add('hidden');
                    if (iconMinus) iconMinus.classList.remove('hidden');
                };
                items.forEach((item) => {
                    closeItem(item);
                    const button = item.querySelector('.faq-toggle');
                    const panel = item.querySelector('.faq-panel');
                    button.addEventListener('click', function () {
                        const isOpen = button.getAttribute('aria-expanded') === 'true';
                        if (openItem && openItem !== item) { closeItem(openItem); openItem = null; }
                        if (isOpen) { closeItem(item); openItem = null; } else { openItemFn(item); openItem = item; }
                    });
                    window.addEventListener('resize', () => { if (openItem === item) { panel.style.maxHeight = panel.scrollHeight + 'px'; } });
                });
            });
        </script>
        {% endif %}

        <!-- Import / Export & Packaging Intelligence Section (replaces Steps To Buy) -->
        {% if product.how_to_import_steps or product.import_required_documents or product.import_available_documents or product.import_shipping_options or product.export_required_documents or product.export_available_documents or product.packaging_details or product.important_compliance %}
        <section id="import-export-section" class="relative overflow-hidden bg-gradient-to-br from-slate-50 via-gray-50 to-stone-100 pt-12 pb-14 sm:pt-20 sm:pb-28 px-4 sm:px-0" data-section="import-export">
            <!-- Decorative background elements -->
            <div class="absolute inset-0 pointer-events-none overflow-hidden">
                <div class="absolute -top-32 -right-32 w-96 h-96 rounded-full bg-gradient-to-br from-blue-100/40 to-indigo-100/30 blur-3xl"></div>
                <div class="absolute -bottom-24 -left-24 w-80 h-80 rounded-full bg-gradient-to-tr from-emerald-100/30 to-teal-100/20 blur-3xl"></div>
                <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[600px] h-[600px] rounded-full bg-gradient-to-r from-amber-50/20 via-transparent to-rose-50/20 blur-3xl"></div>
            </div>

            <div class="relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-12">
                <!-- Section Header -->
                <div class="text-center mb-10 sm:mb-14">
                    <div class="inline-flex items-center gap-2 px-4 py-1.5 rounded-full bg-gradient-to-r from-gray-900 to-gray-800 text-white text-[10px] sm:text-xs font-semibold tracking-[0.25em] uppercase shadow-lg mb-4">
                        <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path></svg>
                        Trade Intelligence Hub
                    </div>
                    <h2 class="text-2xl sm:text-3xl md:text-4xl font-bold text-gray-900 tracking-tight">
                        Import · Export · Packaging
                    </h2>
                    <p class="mt-3 text-sm sm:text-base text-gray-600 font-medium max-w-2xl mx-auto leading-relaxed">
                        Everything you need to know about documentation, logistics, packaging and compliance for <span class="text-gray-900 font-semibold">{{ product.product_title|default:"this product" }}</span>
                    </p>
                </div>

                <!-- Advanced Tab Navigation -->
                <div class="relative mb-8 sm:mb-10" id="ie-tabs-wrapper">
                    <!-- Left scroll arrow (hidden by default, shown when can scroll left) -->
                    <button type="button" id="ie-scroll-left" aria-label="Scroll tabs left"
                            class="absolute left-0 top-1/2 -translate-y-1/2 z-20 w-10 h-10 flex items-center justify-center rounded-full bg-white/95 border border-gray-200 shadow-lg text-gray-700 hover:bg-gray-50 hover:text-gray-900 hover:shadow-xl transition-all duration-200 opacity-0 pointer-events-none sm:hidden"
                            style="backdrop-filter: blur(8px);">
                        <i class="fas fa-chevron-left text-sm"></i>
                    </button>
                    
                    <!-- Right scroll arrow (shown when can scroll right) -->
                    <button type="button" id="ie-scroll-right" aria-label="Scroll tabs right"
                            class="absolute right-0 top-1/2 -translate-y-1/2 z-20 w-10 h-10 flex items-center justify-center rounded-full bg-white/95 border border-gray-200 shadow-lg text-gray-700 hover:bg-gray-50 hover:text-gray-900 hover:shadow-xl transition-all duration-200 opacity-0 pointer-events-none sm:hidden"
                            style="backdrop-filter: blur(8px);">
                        <i class="fas fa-chevron-right text-sm"></i>
                    </button>
                    
                    <!-- Left fade gradient -->
                    <div id="ie-fade-left" class="absolute left-0 top-0 bottom-2 w-8 bg-gradient-to-r from-slate-50 via-slate-50/90 to-transparent pointer-events-none z-10 opacity-0 transition-opacity duration-200 sm:hidden"></div>
                    
                    <!-- Right fade gradient -->
                    <div id="ie-fade-right" class="absolute right-0 top-0 bottom-2 w-8 bg-gradient-to-l from-slate-50 via-slate-50/90 to-transparent pointer-events-none z-10 opacity-0 transition-opacity duration-200 sm:hidden"></div>
                    
                    <div class="ie-tabs-scroll overflow-x-auto pb-2 px-1" id="ie-tabs-scroll-container">
                        <nav id="ie-tabs-nav" class="relative inline-flex items-center gap-1 p-1.5 rounded-2xl bg-white/90 backdrop-blur-sm border border-gray-200/80 shadow-[0_4px_24px_rgba(0,0,0,0.06)]" role="tablist" aria-label="Trade information tabs">
                            <!-- Animated indicator -->
                            <span id="ie-tab-indicator" class="absolute top-1.5 bottom-1.5 rounded-xl bg-gradient-to-r from-gray-900 via-gray-800 to-gray-900 shadow-[0_4px_12px_rgba(0,0,0,0.15)] transition-all duration-400 ease-[cubic-bezier(0.34,1.56,0.64,1)] pointer-events-none" style="width:0; left:6px;"></span>
                            
                            {% if product.how_to_import_steps %}
                            <button type="button" role="tab" aria-selected="false"
                                    class="ie-tab-btn group relative z-10 flex items-center gap-2 px-4 sm:px-5 py-2.5 sm:py-3 rounded-xl text-[11px] sm:text-xs font-semibold uppercase tracking-[0.15em] text-gray-600 transition-all duration-300 whitespace-nowrap focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-gray-900"
                                    data-ie-tab-btn data-ie-target="ie-tab-how-import">
                                <span class="flex items-center justify-center w-6 h-6 rounded-lg bg-gray-100 group-hover:bg-gray-200 transition-colors duration-200">
                                    <i class="fas fa-route text-[10px] text-gray-500 group-hover:text-gray-700"></i>
                                </span>
                                <span class="hidden sm:inline">How to Import</span>
                                <span class="sm:hidden">Import</span>
                            </button>
                    {% endif %}

                            {% if product.import_required_documents %}
                            <button type="button" role="tab" aria-selected="false"
                                    class="ie-tab-btn group relative z-10 flex items-center gap-2 px-4 sm:px-5 py-2.5 sm:py-3 rounded-xl text-[11px] sm:text-xs font-semibold uppercase tracking-[0.15em] text-gray-600 transition-all duration-300 whitespace-nowrap focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-gray-900"
                                    data-ie-tab-btn data-ie-target="ie-tab-import-required">
                                <span class="flex items-center justify-center w-6 h-6 rounded-lg bg-red-50 group-hover:bg-red-100 transition-colors duration-200">
                                    <i class="fas fa-file-shield text-[10px] text-red-500"></i>
                                </span>
                                <span class="hidden sm:inline">Required Docs</span>
                                <span class="sm:hidden">Required</span>
                            </button>
                            {% endif %}

                            {% if product.import_available_documents %}
                            <button type="button" role="tab" aria-selected="false"
                                    class="ie-tab-btn group relative z-10 flex items-center gap-2 px-4 sm:px-5 py-2.5 sm:py-3 rounded-xl text-[11px] sm:text-xs font-semibold uppercase tracking-[0.15em] text-gray-600 transition-all duration-300 whitespace-nowrap focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-gray-900"
                                    data-ie-tab-btn data-ie-target="ie-tab-import-available">
                                <span class="flex items-center justify-center w-6 h-6 rounded-lg bg-emerald-50 group-hover:bg-emerald-100 transition-colors duration-200">
                                    <i class="fas fa-file-circle-check text-[10px] text-emerald-500"></i>
                                </span>
                                <span class="hidden sm:inline">Available Docs</span>
                                <span class="sm:hidden">Available</span>
                            </button>
                            {% endif %}

                            {% if product.import_shipping_options %}
                            <button type="button" role="tab" aria-selected="false"
                                    class="ie-tab-btn group relative z-10 flex items-center gap-2 px-4 sm:px-5 py-2.5 sm:py-3 rounded-xl text-[11px] sm:text-xs font-semibold uppercase tracking-[0.15em] text-gray-600 transition-all duration-300 whitespace-nowrap focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-gray-900"
                                    data-ie-tab-btn data-ie-target="ie-tab-shipping">
                                <span class="flex items-center justify-center w-6 h-6 rounded-lg bg-blue-50 group-hover:bg-blue-100 transition-colors duration-200">
                                    <i class="fas fa-plane-departure text-[10px] text-blue-500"></i>
                                </span>
                                <span class="hidden sm:inline">Shipping</span>
                                <span class="sm:hidden">Ship</span>
                            </button>
                            {% endif %}

                            {% if product.export_required_documents %}
                            <button type="button" role="tab" aria-selected="false"
                                    class="ie-tab-btn group relative z-10 flex items-center gap-2 px-4 sm:px-5 py-2.5 sm:py-3 rounded-xl text-[11px] sm:text-xs font-semibold uppercase tracking-[0.15em] text-gray-600 transition-all duration-300 whitespace-nowrap focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-gray-900"
                                    data-ie-tab-btn data-ie-target="ie-tab-export-required">
                                <span class="flex items-center justify-center w-6 h-6 rounded-lg bg-orange-50 group-hover:bg-orange-100 transition-colors duration-200">
                                    <i class="fas fa-file-export text-[10px] text-orange-500"></i>
                                </span>
                                <span class="hidden sm:inline">Export Docs</span>
                                <span class="sm:hidden">Export</span>
                            </button>
                            {% endif %}

                            {% if product.export_available_documents %}
                            <button type="button" role="tab" aria-selected="false"
                                    class="ie-tab-btn group relative z-10 flex items-center gap-2 px-4 sm:px-5 py-2.5 sm:py-3 rounded-xl text-[11px] sm:text-xs font-semibold uppercase tracking-[0.15em] text-gray-600 transition-all duration-300 whitespace-nowrap focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-gray-900"
                                    data-ie-tab-btn data-ie-target="ie-tab-export-available">
                                <span class="flex items-center justify-center w-6 h-6 rounded-lg bg-teal-50 group-hover:bg-teal-100 transition-colors duration-200">
                                    <i class="fas fa-file-signature text-[10px] text-teal-500"></i>
                                </span>
                                <span class="hidden sm:inline">Export docs</span>
                                <span class="sm:hidden">Avail</span>
                            </button>
                            {% endif %}

                            {% if product.packaging_details %}
                            <button type="button" role="tab" aria-selected="false"
                                    class="ie-tab-btn group relative z-10 flex items-center gap-2 px-4 sm:px-5 py-2.5 sm:py-3 rounded-xl text-[11px] sm:text-xs font-semibold uppercase tracking-[0.15em] text-gray-600 transition-all duration-300 whitespace-nowrap focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-gray-900"
                                    data-ie-tab-btn data-ie-target="ie-tab-packaging">
                                <span class="flex items-center justify-center w-6 h-6 rounded-lg bg-amber-50 group-hover:bg-amber-100 transition-colors duration-200">
                                    <i class="fas fa-box-open text-[10px] text-amber-600"></i>
                                </span>
                                <span class="hidden sm:inline">Packaging</span>
                                <span class="sm:hidden">Pack</span>
                            </button>
                            {% endif %}

                            {% if product.important_compliance %}
                            <button type="button" role="tab" aria-selected="false"
                                    class="ie-tab-btn group relative z-10 flex items-center gap-2 px-4 sm:px-5 py-2.5 sm:py-3 rounded-xl text-[11px] sm:text-xs font-semibold uppercase tracking-[0.15em] text-gray-600 transition-all duration-300 whitespace-nowrap focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-gray-900"
                                    data-ie-tab-btn data-ie-target="ie-tab-compliance">
                                <span class="flex items-center justify-center w-6 h-6 rounded-lg bg-purple-50 group-hover:bg-purple-100 transition-colors duration-200">
                                    <i class="fas fa-shield-alt text-[10px] text-purple-500"></i>
                                </span>
                                <span class="hidden sm:inline">Compliance</span>
                                <span class="sm:hidden">Comply</span>
                            </button>
                            {% endif %}
                        </nav>
                </div>

                    <!-- Tab counter / progress indicator for mobile -->
                    <div id="ie-tab-counter" class="flex items-center justify-center gap-1.5 mt-3 sm:hidden">
                        <!-- Dots will be generated by JS -->
                                    </div>
                                    </div>

                <!-- Content Panels -->
                <div class="relative">
                    <!-- Glass morphism container -->
                    <div class="relative bg-white/95 backdrop-blur-xl rounded-3xl border border-white/50 overflow-hidden">
                        <!-- Subtle top gradient line -->
                        <div class="absolute top-0 left-0 right-0 h-1 bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500 opacity-60"></div>
                        
                        <div class="p-6 sm:p-8 md:p-10">
                            {% if product.how_to_import_steps %}
                            <!-- How to Import Panel -->
                            <div id="ie-tab-how-import" data-ie-tab-panel role="tabpanel" class="hidden animate-fadeIn">
                                <div class="flex flex-col lg:flex-row lg:items-start lg:justify-between gap-4 mb-8">
                                    <div class="max-w-2xl">
                                        <div class="flex items-center gap-3 mb-2">
                                            <span class="flex items-center justify-center w-10 h-10 rounded-xl bg-gradient-to-br from-blue-500 to-indigo-600 text-white shadow-lg">
                                                <i class="fas fa-route"></i>
                                            </span>
                                            <h3 class="text-xl sm:text-2xl font-bold text-gray-900">
                                                How to Import
                                            </h3>
                                </div>
                                        <p class="text-sm sm:text-base text-gray-600 leading-relaxed pl-[52px]">
                                            Follow these curated steps to move from enquiry to customs-cleared delivery with fewer surprises.
                                        </p>
                                    </div>
                                    <div class="flex items-center gap-2 bg-gradient-to-r from-gray-900 to-gray-800 text-white rounded-full px-4 py-2 text-xs font-bold tracking-[0.2em] uppercase shadow-lg self-start">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path></svg>
                                        <span>{{ product.how_to_import_steps|length|default:1 }} Step{{ product.how_to_import_steps|length|default:1|pluralize }}</span>
                                </div>
                                </div>
                                
                                <!-- Timeline Steps -->
                                <div class="relative">
                                    <!-- Vertical timeline line for desktop -->
                                    <div class="hidden lg:block absolute left-[23px] top-8 bottom-8 w-0.5 bg-gradient-to-b from-blue-400 via-indigo-400 to-purple-400 rounded-full"></div>
                                    
                                    <div class="space-y-4 lg:space-y-6">
                                        {% for step in product.how_to_import_steps %}
                                        <article class="group relative flex flex-col lg:flex-row gap-4 lg:gap-6" style="animation-delay: {{ forloop.counter0|add:1 }}00ms;">
                                            <!-- Step number -->
                                            <div class="flex-shrink-0 flex items-start lg:items-center gap-4">
                                                <div class="relative z-10 flex items-center justify-center w-12 h-12 rounded-2xl bg-gradient-to-br from-gray-900 to-gray-700 text-white text-sm font-bold shadow-lg group-hover:shadow-xl group-hover:scale-105 transition-all duration-300">
                                    {% if forloop.counter < 10 %}0{% endif %}{{ forloop.counter }}
                                                    <!-- Pulse ring on hover -->
                                                    <span class="absolute inset-0 rounded-2xl bg-gray-900 opacity-0 group-hover:opacity-20 group-hover:animate-ping"></span>
                                </div>
                                </div>
                                            
                                            <!-- Step content card -->
                                            <div class="flex-1 relative bg-gradient-to-br from-white to-gray-50/80 rounded-2xl border border-gray-100 p-5 sm:p-6 shadow-sm group-hover:shadow-md group-hover:border-gray-200 transition-all duration-300 text-left overflow-hidden">
                                                <!-- Decorative corner accent -->
                                                <div class="absolute top-0 right-0 w-20 h-20 bg-gradient-to-bl from-blue-50 to-transparent rounded-bl-3xl opacity-60"></div>
                                                
                                                <div class="relative">
                                                    <h4 class="text-base sm:text-lg font-semibold text-gray-900 mb-2 group-hover:text-blue-900 transition-colors">
                                                        {{ step.title|default:"Step" }}
                                                    </h4>
                                                    <p class="text-sm sm:text-base text-gray-600 leading-relaxed">
                                    {{ step.description }}
                                </p>
                            </div>
                        </div>
                                        </article>
                        {% endfor %}
                    </div>
                </div>
                                        </div>
                                        {% endif %}

                            {% if product.import_required_documents %}
                            <!-- Import Required Documents Panel -->
                            <div id="ie-tab-import-required" data-ie-tab-panel role="tabpanel" class="hidden animate-fadeIn">
                                <div class="flex flex-col lg:flex-row lg:items-start lg:justify-between gap-4 mb-8">
                                    <div class="max-w-2xl">
                                        <div class="flex items-center gap-3 mb-2">
                                            <span class="flex items-center justify-center w-10 h-10 rounded-xl bg-gradient-to-br from-red-500 to-rose-600 text-white shadow-lg">
                                                <i class="fas fa-file-shield"></i>
                                            </span>
                                            <h3 class="text-xl sm:text-2xl font-bold text-gray-900">
                                                Required Documents
                                            </h3>
                                            </div>
                                        <p class="text-sm sm:text-base text-gray-600 leading-relaxed pl-[52px]">
                                            These documents are mandatory for import clearance and compliance verification.
                                        </p>
                                            </div>
                                    <div class="flex items-center gap-2 bg-gradient-to-r from-red-500 to-rose-600 text-white rounded-full px-4 py-2 text-xs font-bold tracking-[0.15em] uppercase shadow-lg self-start">
                                        <i class="fas fa-exclamation-triangle text-[10px]"></i>
                                        <span>{{ product.import_required_documents|length }} Required</span>
                                        </div>
                                        </div>
                                
                                <!-- Document Grid -->
                                <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-3 sm:gap-4">
                                    {% for doc in product.import_required_documents %}
                                    <div class="group relative bg-gradient-to-br from-red-50 to-rose-50/50 rounded-xl border border-red-100 p-2 hover:border-red-200 hover:shadow-md transition-all duration-300 cursor-default" title="{{ doc }}">
                                        <div class="flex items-center gap-1.5">
                                            <div class="flex-shrink-0 flex items-center justify-center w-7 h-7 rounded-lg bg-red-100 text-red-600 group-hover:bg-red-500 group-hover:text-white transition-colors duration-300">
                                                <i class="fas fa-file-alt text-xs"></i>
                                            </div>
                                            <span class="text-xs font-semibold text-gray-800 truncate">{{ doc }}</span>
                                        </div>
                                        <!-- Required badge -->
                                        <div class="absolute -top-1.5 -right-1.5 w-4 h-4 rounded-full bg-red-500 text-white flex items-center justify-center shadow-sm">
                                            <i class="fas fa-asterisk text-[7px]"></i>
                                        </div>
                                    </div>
                            {% endfor %}
                        </div>
                                        </div>
                                        {% endif %}

                            {% if product.import_available_documents %}
                            <!-- Import Available Documents Panel -->
                            <div id="ie-tab-import-available" data-ie-tab-panel role="tabpanel" class="hidden animate-fadeIn">
                                <div class="flex flex-col lg:flex-row lg:items-start lg:justify-between gap-4 mb-8">
                                    <div class="max-w-2xl">
                                        <div class="flex items-center gap-3 mb-2">
                                            <span class="flex items-center justify-center w-10 h-10 rounded-xl bg-gradient-to-br from-emerald-500 to-teal-600 text-white shadow-lg">
                                                <i class="fas fa-file-circle-check"></i>
                                            </span>
                                            <h3 class="text-xl sm:text-2xl font-bold text-gray-900">
                                                Available Documents
                                            </h3>
                                        </div>
                                        <p class="text-sm sm:text-base text-gray-600 leading-relaxed pl-[52px]">
                                            Documents we can help arrange through our verified network of suppliers and partners.
                                        </p>
                                    </div>
                                    <div class="flex items-center gap-2 bg-gradient-to-r from-emerald-500 to-teal-600 text-white rounded-full px-4 py-2 text-xs font-bold tracking-[0.15em] uppercase shadow-lg self-start">
                                        <i class="fas fa-check-double text-[10px]"></i>
                                        <span>{{ product.import_available_documents|length }} Available</span>
                                </div>
                            </div>

                                <!-- Document Grid -->
                                <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-3 sm:gap-4">
                                    {% for doc in product.import_available_documents %}
                                    <div class="group relative bg-gradient-to-br from-emerald-50 to-teal-50/50 rounded-xl border border-emerald-100 p-4 hover:border-emerald-200 hover:shadow-md transition-all duration-300 cursor-default" title="{{ doc }}">
                                        <div class="flex items-center gap-3">
                                            <div class="flex-shrink-0 flex items-center justify-center w-9 h-9 rounded-lg bg-emerald-100 text-emerald-600 group-hover:bg-emerald-500 group-hover:text-white transition-colors duration-300">
                                                <i class="fas fa-file-alt text-sm"></i>
                        </div>
                                            <span class="text-xs sm:text-sm font-semibold text-gray-800 truncate">{{ doc }}</span>
                    </div>
                                        <!-- Available badge -->
                                        <div class="absolute -top-1.5 -right-1.5 w-5 h-5 rounded-full bg-emerald-500 text-white flex items-center justify-center shadow-sm">
                                            <i class="fas fa-check text-[8px]"></i>
                                        </div>
                            </div>
                            {% endfor %}
                        </div>
                                        </div>
                                        {% endif %}

                            {% if product.import_shipping_options %}
                            <!-- Shipping Options Panel -->
                            <div id="ie-tab-shipping" data-ie-tab-panel role="tabpanel" class="hidden animate-fadeIn">
                                <div class="flex flex-col lg:flex-row lg:items-start lg:justify-between gap-4 mb-8">
                                    <div class="max-w-2xl">
                                        <div class="flex items-center gap-3 mb-2">
                                            <span class="flex items-center justify-center w-10 h-10 rounded-xl bg-gradient-to-br from-blue-500 to-cyan-600 text-white shadow-lg">
                                                <i class="fas fa-shipping-fast"></i>
                                            </span>
                                            <h3 class="text-xl sm:text-2xl font-bold text-gray-900">
                                                Shipping Options
                                            </h3>
                                        </div>
                                        <p class="text-sm sm:text-base text-gray-600 leading-relaxed pl-[52px]">
                                            Choose the right shipping mode based on urgency, volume and landed cost requirements.
                                        </p>
                    </div>
                </div>

                                <!-- Shipping Cards -->
                                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6">
                                    {% for opt in product.import_shipping_options %}
                                    <article class="group relative bg-gradient-to-br from-white to-blue-50/30 rounded-2xl border border-gray-100 p-6 hover:border-blue-200 hover:shadow-xl transition-all duration-300 overflow-hidden">
                                        <!-- Background decoration -->
                                        <div class="absolute -top-10 -right-10 w-32 h-32 rounded-full bg-gradient-to-br from-blue-100/50 to-cyan-100/30 blur-2xl group-hover:scale-150 transition-transform duration-500"></div>
                                        
                                        <div class="relative text-center">
                                            <!-- Icon -->
                                            <div class="inline-flex items-center justify-center w-16 h-16 rounded-2xl bg-gradient-to-br from-gray-900 to-gray-700 text-white shadow-lg mb-4 group-hover:scale-110 group-hover:shadow-xl transition-all duration-300">
                                                {% if opt.image %}
                                                    <img src="{{ opt.image }}" alt="{{ opt.name }}" class="w-10 h-10 object-contain">
                {% else %}
                                                    {% with name_lower=opt.name|default:''|lower %}
                                                        {% if "air" in name_lower %}
                                                            <i class="fas fa-plane text-2xl"></i>
                                                        {% elif "ship" in name_lower or "sea" in name_lower %}
                                                            <i class="fas fa-ship text-2xl"></i>
                                                        {% elif "door" in name_lower %}
                                                            <i class="fas fa-truck text-2xl"></i>
                                                        {% elif "rail" in name_lower or "train" in name_lower %}
                                                            <i class="fas fa-train text-2xl"></i>
                                                        {% else %}
                                                            <i class="fas fa-globe text-2xl"></i>
                                                        {% endif %}
                                                    {% endwith %}
                                                {% endif %}
                            </div>

                                            <h4 class="text-base sm:text-lg font-bold text-gray-900 uppercase tracking-[0.12em] mb-2">
                                                {{ opt.name }}
                                            </h4>
                                            
                                            <p class="text-xs sm:text-sm text-gray-600 leading-relaxed">
                                                {% with name_lower=opt.name|default:''|lower %}
                                                    {% if "air" in name_lower %}
                                                        Fastest delivery option. Ideal for urgent, time-sensitive shipments with premium freight rates.
                                                    {% elif "ship" in name_lower or "sea" in name_lower %}
                                                        Most economical for bulk orders. Best for large volumes with flexible delivery timelines.
                                                    {% elif "door" in name_lower %}
                                                        End-to-end delivery to your location. Complete logistics handling from origin to destination.
                                                    {% else %}
                                                        Reliable shipping option optimized for {{ product.city|default:"your destination" }}.
                                                    {% endif %}
                                                {% endwith %}
                                            </p>
                                            
                                            <!-- Feature tags -->
                                            <div class="flex flex-wrap justify-center gap-2 mt-4">
                                                {% with name_lower=opt.name|default:''|lower %}
                                                    {% if "air" in name_lower %}
                                                        <span class="px-2.5 py-1 rounded-full bg-blue-100 text-blue-700 text-[10px] font-semibold uppercase tracking-wider">Fast</span>
                                                        <span class="px-2.5 py-1 rounded-full bg-amber-100 text-amber-700 text-[10px] font-semibold uppercase tracking-wider">Premium</span>
                                                    {% elif "ship" in name_lower or "sea" in name_lower %}
                                                        <span class="px-2.5 py-1 rounded-full bg-emerald-100 text-emerald-700 text-[10px] font-semibold uppercase tracking-wider">Economical</span>
                                                        <span class="px-2.5 py-1 rounded-full bg-blue-100 text-blue-700 text-[10px] font-semibold uppercase tracking-wider">Bulk</span>
                                                    {% elif "door" in name_lower %}
                                                        <span class="px-2.5 py-1 rounded-full bg-purple-100 text-purple-700 text-[10px] font-semibold uppercase tracking-wider">Convenient</span>
                                                        <span class="px-2.5 py-1 rounded-full bg-teal-100 text-teal-700 text-[10px] font-semibold uppercase tracking-wider">E2E</span>
                                                    {% endif %}
                                                {% endwith %}
                                            </div>
                                            </div>
                                    </article>
                            {% endfor %}
                                        </div>
                                        </div>
                                        {% endif %}
                
                            {% if product.export_required_documents %}
                            <!-- Export Required Documents Panel -->
                            <div id="ie-tab-export-required" data-ie-tab-panel role="tabpanel" class="hidden animate-fadeIn">
                                <div class="flex flex-col lg:flex-row lg:items-start lg:justify-between gap-4 mb-8">
                                    <div class="max-w-2xl">
                                        <div class="flex items-center gap-3 mb-2">
                                            <span class="flex items-center justify-center w-10 h-10 rounded-xl bg-gradient-to-br from-orange-500 to-amber-600 text-white shadow-lg">
                                                <i class="fas fa-file-export"></i>
                                            </span>
                                            <h3 class="text-xl sm:text-2xl font-bold text-gray-900">
                                                Export Required Documents
                                            </h3>
                                        </div>
                                        <p class="text-sm sm:text-base text-gray-600 leading-relaxed pl-[52px]">
                                            Mandatory paperwork required from the exporter's side for customs clearance and banking.
                                        </p>
                                    </div>
                                    <div class="flex items-center gap-2 bg-gradient-to-r from-orange-500 to-amber-600 text-white rounded-full px-4 py-2 text-xs font-bold tracking-[0.15em] uppercase shadow-lg self-start">
                                        <i class="fas fa-exclamation-triangle text-[10px]"></i>
                                        <span>{{ product.export_required_documents|length }} Required</span>
                                </div>
                            </div>

                                <!-- Document Grid -->
                                <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-3 sm:gap-4">
                                    {% for doc in product.export_required_documents %}
                                    <div class="group relative bg-gradient-to-br from-orange-50 to-amber-50/50 rounded-xl border border-orange-100 p-3 hover:border-orange-200 hover:shadow-md transition-all duration-300 cursor-default" title="{{ doc }}">
                                        <div class="flex items-center gap-2">
                                            <div class="flex-shrink-0 flex items-center justify-center w-8 h-8 rounded-lg bg-orange-100 text-orange-600 group-hover:bg-orange-500 group-hover:text-white transition-colors duration-300">
                                                <i class="fas fa-file-alt text-xs"></i>
                        </div>
                                            <span class="text-xs font-semibold text-gray-800 truncate">{{ doc }}</span>
                    </div>
                                        <div class="absolute -top-1.5 -right-1.5 w-4 h-4 rounded-full bg-orange-500 text-white flex items-center justify-center shadow-sm">
                                            <i class="fas fa-asterisk text-[7px]"></i>
                        </div>
                                </div>
                                    {% endfor %}
                    </div>
                </div>
                {% endif %}
                
                            {% if product.export_available_documents %}
                            <!-- Export Available Documents Panel -->
                            <div id="ie-tab-export-available" data-ie-tab-panel role="tabpanel" class="hidden animate-fadeIn">
                                <div class="flex flex-col lg:flex-row lg:items-start lg:justify-between gap-4 mb-8">
                                    <div class="max-w-2xl">
                                        <div class="flex items-center gap-3 mb-2">
                                            <span class="flex items-center justify-center w-10 h-10 rounded-xl bg-gradient-to-br from-teal-500 to-cyan-600 text-white shadow-lg">
                                                <i class="fas fa-file-signature"></i>
                                            </span>
                                            <h3 class="text-xl sm:text-2xl font-bold text-gray-900">
                                                Export Available Documents
                                            </h3>
            </div>
                                        <p class="text-sm sm:text-base text-gray-600 leading-relaxed pl-[52px]">
                                            Certificates and paperwork we can typically help coordinate through our supplier network.
                                        </p>
                                    </div>
                                    <div class="flex items-center gap-2 bg-gradient-to-r from-teal-500 to-cyan-600 text-white rounded-full px-4 py-2 text-xs font-bold tracking-[0.15em] uppercase shadow-lg self-start">
                                        <i class="fas fa-check-double text-[10px]"></i>
                                        <span>{{ product.export_available_documents|length }} Available</span>
                                </div>
                </div>

                                <!-- Document Grid -->
                                <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-3 sm:gap-4">
                                    {% for doc in product.export_available_documents %}
                                    <div class="group relative bg-gradient-to-br from-teal-50 to-cyan-50/50 rounded-xl border border-teal-100 p-2 hover:border-teal-200 hover:shadow-md transition-all duration-300 cursor-default" title="{{ doc }}">
                                        <div class="flex items-center gap-1.5">
                                            <div class="flex-shrink-0 flex items-center justify-center w-7 h-7 rounded-lg bg-teal-100 text-teal-600 group-hover:bg-teal-500 group-hover:text-white transition-colors duration-300">
                                                <i class="fas fa-file-alt text-xs"></i>
                                        </div>
                                            <span class="text-xs font-semibold text-gray-800 truncate">{{ doc }}</span>
                                        </div>
                                        <div class="absolute -top-1.5 -right-1.5 w-4 h-4 rounded-full bg-teal-500 text-white flex items-center justify-center shadow-sm">
                                            <i class="fas fa-check text-[7px]"></i>
                                    </div>
                                </div>
                                    {% endfor %}
                            </div>
                            </div>
                            {% endif %}

                            {% if product.packaging_details %}
                            <!-- Packaging Details Panel -->
                            <div id="ie-tab-packaging" data-ie-tab-panel role="tabpanel" class="hidden animate-fadeIn">
                                <div class="flex flex-col lg:flex-row lg:items-start lg:justify-between gap-4 mb-8">
                                    <div class="max-w-2xl">
                                        <div class="flex items-center gap-3 mb-2">
                                            <span class="flex items-center justify-center w-10 h-10 rounded-xl bg-gradient-to-br from-amber-500 to-orange-600 text-white shadow-lg">
                                                <i class="fas fa-box-open"></i>
                                            </span>
                                            <h3 class="text-xl sm:text-2xl font-bold text-gray-900">
                                                Packaging Options
                                            </h3>
                                        </div>
                                        <p class="text-sm sm:text-base text-gray-600 leading-relaxed pl-[52px]">
                                            Industrial-grade packaging options optimized for safety, handling, and storage requirements.
                                        </p>
                                    </div>
                                    <div class="flex items-center gap-2 bg-gradient-to-r from-amber-500 to-orange-600 text-white rounded-full px-4 py-2 text-xs font-bold tracking-[0.15em] uppercase shadow-lg self-start">
                                        <i class="fas fa-cubes text-[10px]"></i>
                                        <span>{{ product.packaging_details|length }} Option{{ product.packaging_details|length|pluralize }}</span>
                                </div>
                            </div>

                                <!-- Packaging Cards -->
                                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6">
                                    {% for pack in product.packaging_details %}
                                    <article class="group relative bg-gradient-to-br from-white to-amber-50/30 rounded-2xl border border-gray-100 overflow-hidden hover:border-amber-200 hover:shadow-xl transition-all duration-300">
                                        <!-- Top colored bar -->
                                        <div class="h-1.5 bg-gradient-to-r from-amber-400 via-orange-500 to-amber-400"></div>
                                        
                                        <div class="p-5 sm:p-6">
                                            <div class="flex items-start justify-between gap-4 mb-4">
                                                <div class="flex items-center gap-3">
                                                    <div class="flex-shrink-0 flex items-center justify-center w-12 h-12 rounded-xl bg-gradient-to-br from-gray-900 to-gray-700 text-white shadow-md group-hover:scale-105 transition-transform duration-300">
                                                        {% with t=pack.type|default:""|lower %}
                                                            {% if "drum" in t %}
                                                                <i class="fas fa-oil-can text-lg"></i>
                                                            {% elif "bag" in t %}
                                                                <i class="fas fa-shopping-bag text-lg"></i>
                                                            {% elif "jar" in t or "bottle" in t %}
                                                                <i class="fas fa-flask text-lg"></i>
                                                            {% elif "carton" in t or "box" in t %}
                                                                <i class="fas fa-box text-lg"></i>
                                                            {% elif "pail" in t or "bucket" in t %}
                                                                <i class="fas fa-fill-drip text-lg"></i>
                                                            {% else %}
                                                                <i class="fas fa-cube text-lg"></i>
                                                            {% endif %}
                                                        {% endwith %}
                                                    </div>
                                    <div>
                                                        <h4 class="text-base sm:text-lg font-bold text-gray-900">
                                                            {{ pack.type|default:"Packaging" }}
                                                        </h4>
                                                        <p class="text-xs text-gray-500 font-medium uppercase tracking-wider">Container Type</p>
                                        </div>
                                </div>
                            </div>

                                            <!-- Specs -->
                                            <div class="space-y-3">
                                                <div class="flex items-center justify-between p-3 rounded-xl bg-gray-50 border border-gray-100">
                                                    <span class="text-xs font-semibold text-gray-500 uppercase tracking-wider">Unit Size</span>
                                                    <span class="text-sm sm:text-base font-bold text-gray-900 bg-gradient-to-r from-amber-500 to-orange-600 bg-clip-text text-transparent">{{ pack.unit|default:"—" }}</span>
                                        </div>
                                                <div class="flex items-center justify-between p-3 rounded-xl bg-gray-50 border border-gray-100">
                                                    <span class="text-xs font-semibold text-gray-500 uppercase tracking-wider">Material</span>
                                                    <span class="text-sm font-semibold text-gray-800">{{ pack.material|default:"N/A" }}</span>
                                        </div>
                                                {% if pack.notes %}
                                                <div class="p-3 rounded-xl bg-amber-50 border border-amber-100">
                                                    <p class="text-xs sm:text-sm text-amber-800 leading-relaxed">
                                                        <i class="fas fa-info-circle mr-1.5 text-amber-600"></i>
                                                        {{ pack.notes }}
                                        </p>
                                    </div>
                                                {% endif %}
                                </div>
                            </div>
                                    </article>
                                    {% endfor %}
                                        </div>
                                        </div>
                            {% endif %}

                            {% if product.important_compliance %}
                            <!-- Important Compliance Panel -->
                            <div id="ie-tab-compliance" data-ie-tab-panel role="tabpanel" class="hidden animate-fadeIn">
                                <div class="flex flex-col lg:flex-row lg:items-start lg:justify-between gap-4 mb-8">
                                    <div class="max-w-2xl">
                                        <div class="flex items-center gap-3 mb-2">
                                            <span class="flex items-center justify-center w-10 h-10 rounded-xl bg-gradient-to-br from-purple-500 to-indigo-600 text-white shadow-lg">
                                                <i class="fas fa-shield-alt"></i>
                                            </span>
                                            <h3 class="text-xl sm:text-2xl font-bold text-gray-900">
                                                Compliance & Safety
                                            </h3>
                                        </div>
                                        <p class="text-sm sm:text-base text-gray-600 leading-relaxed pl-[52px]">
                                            Key regulatory, quality and safety considerations to review before import or export.
                                        </p>
                                    </div>
                                    <div class="flex items-center gap-2 bg-gradient-to-r from-purple-500 to-indigo-600 text-white rounded-full px-4 py-2 text-xs font-bold tracking-[0.15em] uppercase shadow-lg self-start">
                                        <i class="fas fa-gavel text-[10px]"></i>
                                        <span>{{ product.important_compliance|length }} Note{{ product.important_compliance|length|pluralize }}</span>
                                    </div>
                                </div>

                                <!-- Timeline Steps (mirroring How to Import layout, with purple theming) -->
                                <div class="relative">
                                    <!-- Vertical timeline line for desktop -->
                                    <div class="hidden lg:block absolute left-[23px] top-8 bottom-8 w-0.5 bg-gradient-to-b from-purple-400 via-indigo-400 to-pink-400 rounded-full"></div>
                                    
                                    <div class="space-y-4 lg:space-y-6">
                                        {% for item in product.important_compliance %}
                                        <article class="group relative flex flex-col lg:flex-row gap-4 lg:gap-6" style="animation-delay: {{ forloop.counter0|add:1 }}00ms;">
                                            <!-- Step number -->
                                            <div class="flex-shrink-0 flex items-start lg:items-center gap-4">
                                                <div class="relative z-10 flex items-center justify-center w-12 h-12 rounded-2xl bg-gradient-to-br from-gray-900 to-gray-700 text-white text-sm font-bold shadow-lg group-hover:shadow-xl group-hover:scale-105 transition-all duration-300">
                                                    {% if forloop.counter < 10 %}0{% endif %}{{ forloop.counter }}
                                                    <!-- Pulse ring on hover -->
                                                    <span class="absolute inset-0 rounded-2xl bg-gray-900 opacity-0 group-hover:opacity-20 group-hover:animate-ping"></span>
                                                </div>
                                            </div>
                                            
                                            <!-- Step content card -->
                                            <div class="flex-1 relative bg-gradient-to-br from-white to-gray-50/80 rounded-2xl border border-gray-100 p-5 sm:p-6 shadow-sm group-hover:shadow-md group-hover:border-gray-200 transition-all duration-300 text-left overflow-hidden">
                                                <!-- Decorative corner accent -->
                                                <div class="absolute top-0 right-0 w-20 h-20 bg-gradient-to-bl from-purple-50 to-transparent rounded-bl-3xl opacity-60"></div>
                                                
                                                <div class="relative">
                                                    <h4 class="text-base sm:text-lg font-semibold text-gray-900 mb-2 group-hover:text-purple-900 transition-colors">
                                                        {{ item.title|default:"Compliance Highlight" }}
                                                    </h4>
                                                    <p class="text-sm sm:text-base text-gray-600 leading-relaxed">
                                                        {{ item.description }}
                                                    </p>
                                                </div>
                                            </div>
                                        </article>
                                        {% endfor %}
                                    </div>
                                </div>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
                
                <style>
                    /* Tab scroll container - hide scrollbar */
                    .ie-tabs-scroll {
                        -ms-overflow-style: none;
                        scrollbar-width: none;
                        scroll-behavior: smooth;
                    }
                    .ie-tabs-scroll::-webkit-scrollbar {
                        display: none;
                    }
                    
                    /* Fade in animation for panels */
                    @keyframes fadeIn {
                        from { opacity: 0; transform: translateY(12px); }
                        to { opacity: 1; transform: translateY(0); }
                    }
                    .animate-fadeIn {
                        animation: fadeIn 0.4s ease-out forwards;
                    }
                    
                    /* Active tab button styles */
                    .ie-tab-btn.ie-active {
                        color: white !important;
                    }
                    .ie-tab-btn.ie-active span:first-child {
                        background: rgba(255,255,255,0.2) !important;
                    }
                    .ie-tab-btn.ie-active span:first-child i {
                        color: white !important;
                    }
                    
                    /* Smooth indicator transition */
                    #ie-tab-indicator {
                        transition: transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1), 
                                    width 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
                    }
                    
                    /* Scroll arrow visibility */
                    #ie-scroll-left.ie-visible,
                    #ie-scroll-right.ie-visible {
                        opacity: 1;
                        pointer-events: auto;
                    }
                    
                    /* Fade gradient visibility */
                    #ie-fade-left.ie-visible,
                    #ie-fade-right.ie-visible {
                        opacity: 1;
                    }
                    
                    /* Tab counter dots */
                    .ie-tab-dot {
                        width: 8px;
                        height: 8px;
                        border-radius: 50%;
                        background: #d1d5db;
                        transition: all 0.3s ease;
                    }
                    .ie-tab-dot.ie-dot-active {
                        width: 24px;
                        border-radius: 4px;
                        background: linear-gradient(to right, #1f2937, #374151);
                    }
                    
                    /* Scroll arrow pulse animation */
                    @keyframes scrollPulse {
                        0%, 100% { transform: translateY(-50%) scale(1); }
                        50% { transform: translateY(-50%) scale(1.1); }
                    }
                    #ie-scroll-right.ie-pulse {
                        animation: scrollPulse 1.5s ease-in-out infinite;
                    }
                    
                    /* Mobile optimizations */
                    @media (max-width: 639px) {
                        #import-export-section .ie-tab-btn {
                            padding-left: 0.75rem;
                            padding-right: 0.75rem;
                            padding-top: 0.5rem;
                            padding-bottom: 0.5rem;
                        }
                        #import-export-section .ie-tab-btn span:first-child {
                            width: 1.5rem;
                            height: 1.5rem;
                        }
                    }
                </style>
            </div>
        </section>

        <script>
            document.addEventListener('DOMContentLoaded', function () {
                const nav = document.getElementById('ie-tabs-nav');
                if (!nav) return;

                const buttons = nav.querySelectorAll('[data-ie-tab-btn]');
                const panels = document.querySelectorAll('[data-ie-tab-panel]');
                const indicator = document.getElementById('ie-tab-indicator');
                const scrollContainer = document.getElementById('ie-tabs-scroll-container');
                const scrollLeftBtn = document.getElementById('ie-scroll-left');
                const scrollRightBtn = document.getElementById('ie-scroll-right');
                const fadeLeft = document.getElementById('ie-fade-left');
                const fadeRight = document.getElementById('ie-fade-right');
                const tabCounter = document.getElementById('ie-tab-counter');
                
                if (!buttons.length || !panels.length) return;

                // Create tab counter dots
                function createTabDots() {
                    if (!tabCounter) return;
                    tabCounter.innerHTML = '';
                    buttons.forEach((btn, idx) => {
                        const dot = document.createElement('span');
                        dot.className = 'ie-tab-dot';
                        dot.setAttribute('data-dot-index', idx);
                        dot.addEventListener('click', () => {
                            const target = btn.getAttribute('data-ie-target');
                            if (target) setActive(target);
                        });
                        tabCounter.appendChild(dot);
                    });
                }

                // Update tab counter dots
                function updateTabDots(activeIdx) {
                    if (!tabCounter) return;
                    const dots = tabCounter.querySelectorAll('.ie-tab-dot');
                    dots.forEach((dot, idx) => {
                        dot.classList.toggle('ie-dot-active', idx === activeIdx);
                    });
                }

                // Check scroll position and update arrows/gradients
                function updateScrollIndicators() {
                    if (!scrollContainer) return;
                    
                    const { scrollLeft, scrollWidth, clientWidth } = scrollContainer;
                    const canScrollLeft = scrollLeft > 5;
                    const canScrollRight = scrollLeft < scrollWidth - clientWidth - 5;
                    
                    // Update left arrow and fade
                    if (scrollLeftBtn) {
                        scrollLeftBtn.classList.toggle('ie-visible', canScrollLeft);
                    }
                    if (fadeLeft) {
                        fadeLeft.classList.toggle('ie-visible', canScrollLeft);
                    }
                    
                    // Update right arrow and fade
                    if (scrollRightBtn) {
                        scrollRightBtn.classList.toggle('ie-visible', canScrollRight);
                        // Add pulse animation on initial load if can scroll right
                        if (canScrollRight && !scrollRightBtn.dataset.pulsed) {
                            scrollRightBtn.classList.add('ie-pulse');
                            scrollRightBtn.dataset.pulsed = 'true';
                            // Remove pulse after user interacts
                            setTimeout(() => {
                                scrollRightBtn.classList.remove('ie-pulse');
                            }, 4500);
                        }
                    }
                    if (fadeRight) {
                        fadeRight.classList.toggle('ie-visible', canScrollRight);
                    }
                }

                // Scroll tabs left/right
                function scrollTabs(direction) {
                    if (!scrollContainer) return;
                    const scrollAmount = scrollContainer.clientWidth * 0.6;
                    scrollContainer.scrollBy({
                        left: direction === 'left' ? -scrollAmount : scrollAmount,
                        behavior: 'smooth'
                    });
                }

                // Scroll active tab into view
                function scrollActiveTabIntoView(btn) {
                    if (!scrollContainer || !btn) return;
                    const containerRect = scrollContainer.getBoundingClientRect();
                    const btnRect = btn.getBoundingClientRect();
                    
                    // Check if button is fully visible
                    const isFullyVisible = btnRect.left >= containerRect.left && btnRect.right <= containerRect.right;
                    
                    if (!isFullyVisible) {
                        // Calculate scroll position to center the button
                        const scrollLeft = btn.offsetLeft - (scrollContainer.clientWidth / 2) + (btn.offsetWidth / 2);
                        scrollContainer.scrollTo({
                            left: Math.max(0, scrollLeft),
                            behavior: 'smooth'
                        });
                    }
                }

                function updateIndicator(btn) {
                    if (!indicator || !btn) return;
                    const navRect = nav.getBoundingClientRect();
                    const btnRect = btn.getBoundingClientRect();
                    const left = btnRect.left - navRect.left;
                    indicator.style.transform = 'translateX(' + left + 'px)';
                    indicator.style.width = btnRect.width + 'px';
                }

                function setActive(targetId, animate = true) {
                    // Update panels
                    panels.forEach(panel => {
                        const isTarget = panel.id === targetId;
                        panel.classList.toggle('hidden', !isTarget);
                        if (isTarget && animate) {
                            panel.classList.remove('animate-fadeIn');
                            void panel.offsetWidth; // Trigger reflow
                            panel.classList.add('animate-fadeIn');
                        }
                    });

                    // Update buttons and indicator
                    let activeIdx = 0;
                    buttons.forEach((btn, idx) => {
                        const t = btn.getAttribute('data-ie-target');
                        const isActive = t === targetId;
                        
                        btn.classList.toggle('ie-active', isActive);
                        btn.setAttribute('aria-selected', isActive ? 'true' : 'false');
                        
                        if (isActive) {
                            activeIdx = idx;
                            updateIndicator(btn);
                            // Scroll active tab into view on mobile
                            setTimeout(() => scrollActiveTabIntoView(btn), 50);
                        }
                    });
                    
                    // Update tab dots
                    updateTabDots(activeIdx);
                }

                // Click handlers for scroll buttons
                if (scrollLeftBtn) {
                    scrollLeftBtn.addEventListener('click', () => {
                        scrollTabs('left');
                        scrollRightBtn.classList.remove('ie-pulse');
                    });
                }
                if (scrollRightBtn) {
                    scrollRightBtn.addEventListener('click', () => {
                        scrollTabs('right');
                        scrollRightBtn.classList.remove('ie-pulse');
                    });
                }

                // Listen for scroll events to update indicators
                if (scrollContainer) {
                    scrollContainer.addEventListener('scroll', updateScrollIndicators, { passive: true });
                    // Also update on touch/mouse interaction
                    scrollContainer.addEventListener('touchstart', () => {
                        if (scrollRightBtn) scrollRightBtn.classList.remove('ie-pulse');
                    }, { passive: true });
                }

                // Click handlers for tab buttons
                buttons.forEach(btn => {
                    btn.addEventListener('click', function () {
                        const target = btn.getAttribute('data-ie-target');
                        if (target) setActive(target);
                        if (scrollRightBtn) scrollRightBtn.classList.remove('ie-pulse');
                    });
                });

                // Keyboard navigation (Arrow keys)
                nav.addEventListener('keydown', function (e) {
                    if (e.key !== 'ArrowRight' && e.key !== 'ArrowLeft') return;
                    
                    const current = document.activeElement && document.activeElement.closest('[data-ie-tab-btn]');
                    if (!current) return;
                    
                    const arr = Array.from(buttons);
                    const idx = arr.indexOf(current);
                    if (idx === -1) return;
                    
                    let nextIdx = e.key === 'ArrowRight' ? idx + 1 : idx - 1;
                    if (nextIdx < 0) nextIdx = arr.length - 1;
                    if (nextIdx >= arr.length) nextIdx = 0;
                    
                    const nextBtn = arr[nextIdx];
                    const target = nextBtn && nextBtn.getAttribute('data-ie-target');
                    if (target) {
                        setActive(target);
                        nextBtn.focus();
                        e.preventDefault();
                    }
                });

                // Handle window resize for indicator position
                let resizeTimer;
                window.addEventListener('resize', function() {
                    clearTimeout(resizeTimer);
                    resizeTimer = setTimeout(function() {
                        const activeBtn = nav.querySelector('.ie-active');
                        if (activeBtn) updateIndicator(activeBtn);
                        updateScrollIndicators();
                    }, 100);
                });

                // Initialize
                createTabDots();
                
                const firstBtn = buttons[0];
                if (firstBtn) {
                    const target = firstBtn.getAttribute('data-ie-target');
                    if (target) {
                        // Small delay to ensure proper rendering
                        requestAnimationFrame(() => {
                            setActive(target, false);
                            // Initial check for scroll indicators
                            setTimeout(updateScrollIndicators, 100);
                        });
                    }
                }
            });
        </script>
        {% endif %}

        <!-- Customer Ratings & Reviews Section -->
        <!-- Reviews Section (Below FAQs) -->
        <section id="reviews-section" class="pt-12 pb-16 sm:pt-16 sm:pb-16 bg-white px-4 sm:px-0"
            data-section="reviews">
            <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-12">
                <div class="flex flex-col sm:flex-row sm:items-end sm:justify-between gap-4 mb-6">
                    <div class="text-center sm:text-left max-w-3xl">
                        <h2 class="text-lg uppercase tracking-[0.25em] text-gray-800 font-semibold">Product Reviews</h2>
                        <p class="mt-2 text-sm text-gray-700 font-medium sm:font-normal">Share your experience with {{ product.product_title }}.</p>
                    </div>
                    <div class="flex justify-center sm:justify-end">
                        <button id="writeReviewBtn" type="button"
                            class="inline-flex items-center rounded-full border border-gray-300 bg-white px-4 py-2 text-xs sm:text-sm font-semibold uppercase tracking-[0.16em] text-gray-900 shadow-sm hover:border-gray-400 hover:bg-gray-50 transition">
                            <i class="fas fa-star mr-2 text-amber-500"></i>
                            Write a review
                        </button>
                    </div>
                </div>
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <!-- Summary -->
                    <div class="lg:col-span-1 p-5 bg-gray-100 rounded-md">
                        <div class="text-sm uppercase tracking-[0.2em] text-blue-700">Overall Rating</div>
                        <div class="mt-2 flex items-end gap-3">
                            <div class="text-4xl font-semibold text-gray-900">
                                {{ reviews_data.avg_rating|default:0|floatformat:1 }}
                            </div>
                            <div class="text-sm text-gray-600">/ 5</div>
                        </div>
                        <div class="mt-2 text-xs text-gray-600">Based on {{ reviews_data.total_count|default:0 }}
                            review{{ reviews_data.total_count|default:0|pluralize }}</div>
                        <div class="mt-4 flex items-center">
                            {% with rating=reviews_data.avg_rating|default:0 %}
                                {% for i in "12345" %}
                                    {% if forloop.counter <= rating %}
                                        <svg class="w-5 h-5 text-amber-500 fill-current"
                                             xmlns="http://www.w3.org/2000/svg"
                                             viewBox="0 0 24 24">
                                            <path
                                                d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z" />
                                        </svg>
                                    {% else %}
                                        <svg class="w-5 h-5 text-gray-300 fill-current"
                                             xmlns="http://www.w3.org/2000/svg"
                                             viewBox="0 0 24 24">
                                            <path
                                                d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z" />
                                        </svg>
                                    {% endif %}
                                {% endfor %}
                            {% endwith %}
                        </div>
                    </div>
                    <!-- Reviews list and form -->
                    <div class="lg:col-span-2">
                        <!-- AJAX success greeting -->
                        <div id="reviewSuccessBanner"
                            class="hidden mb-4 rounded-xl border border-emerald-200 bg-emerald-50 px-4 py-3 text-sm text-emerald-900 shadow-sm">
                            <div class="flex items-start gap-3">
                                <div
                                    class="mt-0.5 flex h-7 w-7 items-center justify-center rounded-full bg-emerald-100 text-emerald-700">
                                    <i class="fas fa-check"></i>
                                </div>
                                <div>
                                    <p class="font-semibold">Thank you for sharing your experience!</p>
                                    <p class="mt-1 text-xs sm:text-sm opacity-90" data-role="review-success-detail">
                                        Your review has been submitted successfully and will be visible after a quick
                                        verification.
                                    </p>
                                </div>
                            </div>
                        </div>
                        {% if reviews_data.latest_reviews %}
                        <ul class="space-y-4">
                            {% for r in reviews_data.latest_reviews %}
                            <li class="bg-white rounded-2xl ring-1 ring-gray-200 shadow-sm p-5">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-start gap-2">
                                        <div class="text-sm font-medium text-gray-900">{{ r.name|default:'Anonymous' }}
                                        </div>
                                        <div class="text-[11px] text-gray-600">{{ r.created_at|date:'M d, Y' }}</div>
                                    </div>
                                    <div class="flex items-center">
                                        {% for i in "12345" %}
                                        {% if forloop.counter <= r.rating %} <svg
                                            class="w-4 h-4 text-amber-500 fill-current"
                                            xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                                            <path
                                                d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z" />
                                            </svg>
                                            {% else %}
                                            <svg class="w-4 h-4 text-gray-300 fill-current"
                                                xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                                                <path
                                                    d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z" />
                                            </svg>
                                            {% endif %}
                                            {% endfor %}
                                    </div>
                                </div>
                                {% if r.title %}<div class="mt-1 text-sm text-left font-medium text-gray-900">{{ r.title }}</div>
                                {% endif %}
                                <p class="mt-2 text-sm text-left text-gray-700 leading-relaxed">{{ r.content|linebreaksbr }}</p>
                            </li>
                            {% endfor %}
                        </ul>
                        {% else %}
                        <div class="text-sm text-gray-600 bg-yellow-50 p-4 rounded-lg">No reviews yet. Be the first to
                            review.</div>
                        {% endif %}
                        <!-- Review form (Accordion) -->
                        <div class="mt-6 bg-white shadow-sm rounded-xl">
                            <button id="review-accordion-btn" type="button"
                                class="w-full flex items-center justify-between px-5 py-4"
                                aria-controls="review-accordion-panel" aria-expanded="false"
                                data-default-open="{% if reviews_data.total_count %}1{% else %}0{% endif %}"
                                onclick="(function(btn){try{var panel=document.getElementById('review-accordion-panel');if(!panel)return;var expanded=btn.getAttribute('aria-expanded')==='true';var next=!expanded;btn.setAttribute('aria-expanded',next?'true':'false');if(next){panel.classList.remove('hidden');var icon=document.getElementById('review-accordion-icon');if(icon){icon.classList.add('rotate-180');}var section=document.getElementById('reviews-section');if(section){section.scrollIntoView({behavior:'smooth',block:'start'});}setTimeout(function(){var nameInput=document.getElementById('reviewName');if(nameInput){nameInput.focus();}},300);}else{panel.classList.add('hidden');var icon2=document.getElementById('review-accordion-icon');if(icon2){icon2.classList.remove('rotate-180');}}}catch(e){}})(this);">
                                <span class="text-sm font-medium text-gray-900">Write a review</span>
                                <svg id="review-accordion-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
                                    class="h-5 w-5 text-gray-500 transition-transform duration-200" fill="none"
                                    stroke="currentColor" stroke-width="1.5">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M6 9l6 6 6-6" />
                                </svg>
                            </button>
                            <div id="review-accordion-panel"
                                class="border-t border-gray-100 {% if not reviews_data.total_count %}hidden{% endif %}">
                                <div class="p-5 space-y-6">
                                    <!-- Primary review form -->
                                    <form id="reviewForm" method="post" class="space-y-4">
                                        {% csrf_token %}
                                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                                            <div>
                                                <label
                                                    class="block text-[11px] uppercase text-left tracking-[0.2em] text-gray-600">Name</label>
                                                <input type="text" id="reviewName" name="name"
                                                    class="mt-1 w-full rounded-md border border-gray-300 px-3 py-2 text-sm focus:ring-2 focus:ring-blue-600 focus:outline-none"
                                                    placeholder="Your name" />
                                            </div>
                                            <div>
            <label
                                                    class="block text-[11px] uppercase text-left tracking-[0.2em] text-gray-600">Email</label>
                                                <input type="email" id="reviewEmail" name="email"
                                                    class="mt-1 w-full rounded-md border border-gray-300 px-3 py-2 text-sm focus:ring-2 focus:ring-blue-600 focus:outline-none"
                                                    placeholder="you@example.com" />
                                            </div>
                                            <div>
                                                <label
                                                    class="block text-[11px] uppercase text-left tracking-[0.2em] text-gray-600">Rating</label>
                                                <select name="rating" id="ratingInput"
                                                    class="mt-1 w-full rounded-md border border-gray-300 px-3 py-2 text-sm focus:ring-2 focus:ring-blue-600 focus:outline-none">
                                                    <option value="5">5 - Excellent</option>
                                                    <option value="4">4 - Good</option>
                                                    <option value="3">3 - Average</option>
                                                    <option value="2">2 - Poor</option>
                                                    <option value="1">1 - Terrible</option>
                                                </select>
                                            </div>
                                            <div>
                                                <label
                                                    class="block text-[11px] uppercase text-left tracking-[0.2em] text-gray-600">Title</label>
                                                <input type="text" id="reviewTitle" name="title"
                                                    class="mt-1 w-full rounded-md border border-gray-300 px-3 py-2 text-sm focus:ring-2 focus:ring-blue-600 focus:outline-none"
                                                    placeholder="Optional title" />
                                            </div>
                                        </div>
                                        <div>
                                            <label
                                                class="block text-[11px] uppercase text-left tracking-[0.2em] text-gray-600">Review</label>
                                            <textarea id="reviewContent" name="content" rows="4"
                                                class="mt-1 w-full rounded-md border border-gray-300 px-3 py-2 text-sm focus:ring-2 focus:ring-blue-600 focus:outline-none"
                                                placeholder="Share your experience with this product"
                                                required></textarea>
                                        </div>
                                        <!-- Required bill document -->
                                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                                            <div>
                                                <label
                                                    class="block text-[11px] uppercase text-left tracking-[0.2em] text-gray-600">Bill
                                                    document <span class="text-red-500">*</span></label>
                                                <div
                                                    class="mt-1 flex items-center justify-between rounded-lg border border-dashed border-gray-300 bg-gray-50 px-3 py-2 text-xs sm:text-sm text-gray-600">
                                                    <div class="flex-1">
                                                        <p class="font-medium">Upload purchase bill / invoice</p>
                                                        <p class="mt-1 text-[11px] text-gray-500">PDF, JPG, PNG (max 5MB)</p>
                                                    </div>
                                                    <label
                                                        class="relative inline-flex items-center justify-center rounded-md bg-gray-900 px-3 py-1.5 text-[11px] font-semibold uppercase tracking-[0.18em] text-white shadow-sm cursor-pointer hover:bg-gray-800">
                                                        <span>Select file</span>
                                                        <input id="billUpload" name="bill_document" type="file"
                                                            accept=".pdf,image/*"
                                                            class="absolute inset-0 opacity-0 cursor-pointer" />
                                                    </label>
                                                </div>
                                                <p id="billUploadName"
                                                    class="mt-1 text-[11px] text-gray-600 line-clamp-1 hidden"></p>
                                            </div>
                                            <!-- Required product media -->
                                            <div>
                                                <label
                                                    class="block text-[11px] uppercase text-left tracking-[0.2em] text-gray-600">Product
                                                    photo / video <span class="text-red-500">*</span></label>
                                                <div
                                                    class="mt-1 flex items-center justify-between rounded-lg border border-dashed border-gray-300 bg-gray-50 px-3 py-2 text-xs sm:text-sm text-gray-600">
                                                    <div class="flex-1">
                                                        <p class="font-medium">Upload clear product photo or short video</p>
                                                        <p class="mt-1 text-[11px] text-gray-500">Images or MP4 (max 20MB)</p>
                                                    </div>
                                                    <label
                                                        class="relative inline-flex items-center justify-center rounded-md bg-gray-900 px-3 py-1.5 text-[11px] font-semibold uppercase tracking-[0.18em] text-white shadow-sm cursor-pointer hover:bg-gray-800">
                                                        <span>Select file</span>
                                                        <input id="mediaUpload" name="product_media" type="file"
                                                            accept="image/*,video/mp4,video/*"
                                                            class="absolute inset-0 opacity-0 cursor-pointer" />
                                                    </label>
                                                </div>
                                                <p id="mediaUploadName"
                                                    class="mt-1 text-[11px] text-gray-600 line-clamp-1 hidden"></p>
                                            </div>
                                        </div>
                                        <!-- Optional gallery photos -->
                                        <div>
                                            <label
                                                class="block text-[11px] uppercase text-left tracking-[0.2em] text-gray-600">Additional
                                                photos (optional)</label>
                                            <div id="photoUploadArea"
                                                class="mt-1 flex flex-col sm:flex-row sm:items-center gap-3 rounded-lg border border-dashed border-gray-300 bg-white px-4 py-3 cursor-pointer transition hover:border-blue-500 hover:bg-blue-50">
                                                <div class="flex items-center gap-3">
                                                    <div
                                                        class="flex h-10 w-10 items-center justify-center rounded-full bg-blue-50 text-blue-600">
                                                        <i class="fas fa-camera text-sm"></i>
                                                    </div>
                                                    <div>
                                                        <p class="text-xs sm:text-sm font-medium text-gray-800">Drag & drop or
                                                            click to upload photos</p>
                                                        <p class="text-[11px] text-gray-500">Up to 5 images to showcase the
                                                            product in use.</p>
                                                    </div>
                                                </div>
                                                <input id="photoUpload" type="file" accept="image/*" multiple
                                                    class="hidden" />
                                            </div>
                                            <div id="uploadPreviewContainer"
                                                class="mt-3 flex flex-wrap gap-2"></div>
                                        </div>
                                        <div class="flex items-center justify-end">
                                            <button type="button" id="reviewSubmitBtn"
                                                onclick="window.bsSubmitReview && window.bsSubmitReview();"
                                                class="inline-flex items-center justify-center px-5 py-2.5 bg-blue-600 text-white text-xs uppercase tracking-[0.15em] hover:bg-blue-700 shadow-sm transition-colors">
                                                Submit Review
                                            </button>
                                        </div>
                                    </form>
                                    <!-- OTP verification form (step 2) -->
                                    <form id="otpVerificationForm" class="space-y-4 hidden">
                                        <div
                                            class="rounded-lg border border-blue-100 bg-blue-50 px-4 py-3 text-xs sm:text-sm text-blue-900">
                                            <p class="font-semibold">Verify your email</p>
                                            <p class="mt-1 text-[11px] sm:text-xs">We have sent a 6-digit verification code to
                                                your email. Enter it below to submit your review.</p>
                                        </div>
                                        <div class="grid grid-cols-1 sm:grid-cols-[1fr_auto] gap-3 sm:items-end">
                                            <div>
                                                <label
                                                    class="block text-[11px] uppercase text-left tracking-[0.2em] text-gray-600">Verification
                                                    code</label>
                                                <input id="otpInput" type="text" inputmode="numeric" maxlength="6"
                                                    class="mt-1 w-full rounded-md border border-gray-300 px-3 py-2 text-sm tracking-[0.3em] text-center font-semibold focus:ring-2 focus:ring-blue-600 focus:outline-none"
                                                    placeholder="●●●●●●" />
                                            </div>
                                            <div class="flex gap-2 sm:justify-end">
                                                <button type="button" id="backToReviewBtn"
                                                    class="inline-flex items-center justify-center rounded-md border border-gray-300 px-3 py-2 text-[11px] font-medium uppercase tracking-[0.15em] text-gray-700 bg-white hover:bg-gray-50">
                                                    Edit review
                                                </button>
                                                <button type="button" id="resendOtpBtn"
                                                    class="inline-flex items-center justify-center rounded-md border border-gray-200 px-3 py-2 text-[11px] font-medium uppercase tracking-[0.15em] text-blue-700 bg-blue-50 hover:bg-blue-100">
                                                    Resend code
                                                </button>
                                            </div>
                                        </div>
                                        <div class="flex items-center justify-end">
                                            <button type="submit" id="verifyOtpBtn"
                                                class="inline-flex items-center justify-center px-5 py-2.5 bg-blue-600 text-white text-xs uppercase tracking-[0.15em] hover:bg-blue-700 shadow-sm transition-colors">
                                                Verify &amp; submit
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Helpline Section -->
        <section class="w-full bg-[rgb(240,240,240,1)] py-16" data-section="helpline">
            <div class="max-w-5xl sm:max-w-7xl mx-auto px-4">
                <div class="flex flex-col justify-center items-center">
                    <div class="text-center items-center flex-col justify-center gap-2 mb-8 md:mb-0">
                        <div class="mt-2 text-xl md:text-3xl font-bold tracking-tight text-gray-900 text-center">
                            {% if product.city %}
                            <span class="flex text-center justify-center items-center gap-2 mb-2">
                                <i class="fas fa-map-marker-alt text-blue-600"></i>Supplier Available from: {{ product.city }}
                            </span>
                            {% endif %}
                            {% if product.origin_country %}
                            <span class="flex text-center justify-center items-center gap-2 mb-2">
                                <i class="fas fa-globe text-blue-600"></i>Supplier Available from: {{ product.origin_country }}
                            </span>
                            {% endif %}
                        </div>
                        <div class="mt-3 flex flex-row justify-center items-center gap-2">
                            {% if product.dispatch_time %}
                            <span class="flex items-center gap-2 text-sm md:text-lg">
                                <i class="fas fa-shipping-fast text-green-600"></i> Dispatches in {{ product.dispatch_time }}
                            </span>
                            {% endif %}
                            <span class="ml-4 flex items-center gap-2 text-sm md:text-lg font-bold">
                                <i class="fas fa-truck text-blue-600"></i> Worldwide Delivery
                            </span>
                        </div>
                    </div>
                    <div class="sm:mt-8 text-left md:text-right">
                        <!-- Shipping Information Highlights -->
                        <div class="mt-4 sm:mt-8 grid grid-cols-2 md:grid-cols-4 gap-5 sm:gap-3">
                            <!-- Icon 1 -->
                            <div class="flex flex-col items-center">
                                <div
                                    class="h-12 w-12 rounded-full border-2 border-gray-400 flex items-center justify-center bg-white shadow-sm">
                                    <i class="fas fa-truck-fast text-lg text-gray-600"></i>
                                </div>
                                <div
                                    class="w-full px-4 py-4">
                                    <h4 class="text-base sm:text-lg font-semibold text-gray-900 text-center">
                                        Fast Dispatch
                                    </h4>
                                    <p
                                        class="mt-1 text-sm sm:text-base font-medium text-gray-500 text-center leading-snug">
                                        Ships quickly from our {{ product.city }} <br> warehouse.
                                    </p>
                                </div>
                            </div>

                            <!-- Icon 2 -->
                            <div class="flex flex-col items-center">
                                <div
                                    class="h-12 w-12 rounded-full border-2 border-gray-400 flex items-center justify-center bg-white shadow-sm">
                                    <i class="fas fa-box-open text-lg text-gray-600"></i>  
                                </div>
                                <div
                                    class="w-full px-4 py-4">
                                    <h4 class="text-base sm:text-lg font-semibold text-gray-900 text-center">
                                        Secure Packing
                                    </h4>
                                    <p
                                        class="mt-1 text-sm sm:text-base font-medium text-gray-500 text-center leading-snug">
                                        Shock-proof, export-grade bulk <br> packing.
                                    </p>
                                </div>
                            </div>

                            <!-- Icon 3 -->
                            <div class="flex flex-col items-center">
                                <div
                                    class="h-12 w-12 rounded-full border-2 border-gray-400 flex items-center justify-center bg-white shadow-sm">
                                    <i class="fas fa-bolt text-lg text-gray-600"></i>
                                </div>
                                <div
                                    class="w-full px-4 py-4">
                                    <h4 class="text-base sm:text-lg font-semibold text-gray-900 text-center">
                                        Instant Tracking
                                    </h4>
                                    <p
                                        class="mt-1 text-sm sm:text-base font-medium text-gray-500 text-center leading-snug">
                                        Tracking shared immediately after <br> pickup.
                                    </p>
                                </div>
                            </div>

                            <!-- Icon 4 -->
                            <div class="flex flex-col items-center">
                                <div
                                    class="h-12 w-12 rounded-full border-2 border-gray-400 flex items-center justify-center bg-white shadow-sm">
                                    <i class="fas fa-handshake text-lg text-gray-600"></i>
                                </div>
                                <div
                                    class="w-full px-4 py-4">
                                    <h4 class="text-base sm:text-lg font-semibold text-gray-900 text-center">
                                        Trusted Logistics
                                    </h4>
                                    <p
                                        class="mt-1 text-sm sm:text-base font-medium text-gray-500 text-center leading-snug">
                                        Shipped via verified logistics <br> partners.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Shipping & Return Policy Links -->
                    <div class="mt-8 flex flex-row justify-center items-center gap-6">
                        <a href="#shipping-policy" class="group flex items-center text-blue-600 hover:text-blue-800 transition-colors">
                            <span class="inline-block mr-2 p-2 rounded-full bg-blue-50 group-hover:bg-blue-100 transition-colors">
                                <i class="fas fa-shipping-fast text-blue-600"></i>
                            </span>
                            <span class="text-sm font-medium underline decoration-1 underline-offset-2">Shipping Policy</span>
                        </a>
                        
                        <a href="#return-policy" class="group flex items-center text-blue-600 hover:text-blue-800 transition-colors">
                            <span class="inline-block mr-2 p-2 rounded-full bg-blue-50 group-hover:bg-blue-100 transition-colors">
                                <i class="fas fa-exchange-alt text-blue-600"></i>
                            </span>
                            <span class="text-sm font-medium underline decoration-1 underline-offset-2">Return/Cancellation  Policy</span>
                        </a>
                    </div>
                </div>
            </div>
        </section>
        <!-- Discuss Your Needs Section -->
        <section class="w-full bg-white py-14 md:py-20" id="discuss-your-needs" data-section="enquiry">
            <div class="max-w-5xl mx-auto text-center px-4">
                <h2 class="text-3xl md:text-5xl font-semibold text-gray-900 leading-tight">
                    Discuss Your <span class="font-extrabold">Needs</span>
                </h2>
                <p class="mt-4 text-gray-600 text-sm md:text-base font-medium sm:font-normal max-w-2xl mx-auto">
                    Everyday we work hard to make life of our clients better and happier.
                </p>
                <form id="discussForm" class="mt-8 flex flex-col sm:flex-row items-stretch justify-center gap-3">
                    <input name="quantity" type="number" min="1" placeholder="Quantity"
                        class="px-5 py-2.5 rounded-md border border-gray-300 bg-white text-gray-700 placeholder-gray-500 shadow-sm w-full sm:w-auto" />
                    <input name="mobile" type="tel" placeholder="Mobile Number"
                        class="px-5 py-2.5 rounded-md border border-gray-300 bg-white text-gray-700 placeholder-gray-500 shadow-sm w-full sm:w-auto" />
                    <select name="frequency"
                        class="px-5 py-2.5 rounded-md border border-gray-300 bg-white text-gray-700 placeholder-gray-500 outline-none shadow-sm w-full sm:w-auto appearance-none cursor-pointer">
                        <option value="" disabled selected>Select</option>
                        <option value="one_time">One time</option>
                        <option value="repeat">Repeat</option>
                    </select>
                    <button type="submit"
                        class="px-6 py-2.5 rounded-md bg-blue-600 text-white font-medium hover:bg-blue-700 active:scale-[0.98] transition-transform shadow-sm w-full sm:w-auto">Submit</button>
                </form>
                <p id="discussStatus" class="mt-3 text-sm text-gray-700 hidden"></p>
            </div>
        </section>
    </main>

    <script>
        (function () {
            const wrapper = document.getElementById('stepsSliderWrapper');
            const slider = document.getElementById('stepsSlider');
            const prevBtn = document.getElementById('stepsPrev');
            const nextBtn = document.getElementById('stepsNext');
            const dots = document.querySelectorAll('#stepsDots [data-dot]');
            
            if (!wrapper || !slider || !prevBtn || !nextBtn) return;

            const cards = slider.querySelectorAll('[data-step-card]');
            const total = cards.length;
            let currentIndex = 0;

            // Get card width including padding
            function getCardWidth() {
                if (cards.length === 0) return 280;
                const card = cards[0];
                return card.offsetWidth + parseInt(getComputedStyle(card).marginRight || 0);
            }

            // Calculate which card is currently centered
            function getCurrentCardIndex() {
                const scrollLeft = wrapper.scrollLeft;
                const wrapperWidth = wrapper.offsetWidth;
                const cardWidth = getCardWidth();
                
                // Account for the spacer at the beginning
                const spacerWidth = cards[0] ? cards[0].offsetLeft : 0;
                
                // Calculate index based on scroll position
                const index = Math.round((scrollLeft) / cardWidth);
                return Math.max(0, Math.min(total - 1, index));
            }

            // Scroll to a specific card index
            function scrollToCard(index) {
                if (index < 0 || index >= total) return;
                
                const card = cards[index];
                if (!card) return;
                
                const cardCenter = card.offsetLeft + card.offsetWidth / 2;
                const wrapperCenter = wrapper.offsetWidth / 2;
                const scrollTarget = cardCenter - wrapperCenter;
                
                wrapper.scrollTo({
                    left: scrollTarget,
                    behavior: 'smooth'
                });
            }

            // Update button states and dots
            function updateUI() {
                currentIndex = getCurrentCardIndex();
                
                // Update buttons
                prevBtn.disabled = currentIndex === 0;
                nextBtn.disabled = currentIndex >= total - 1;

                [prevBtn, nextBtn].forEach(btn => {
                    if (btn.disabled) {
                        btn.classList.add('opacity-40', 'cursor-not-allowed');
                    } else {
                        btn.classList.remove('opacity-40', 'cursor-not-allowed');
                    }
                });

                // Update dots
                dots.forEach((dot, i) => {
                    if (i === currentIndex) {
                        dot.classList.remove('bg-gray-300');
                        dot.classList.add('bg-gray-800');
                    } else {
                        dot.classList.remove('bg-gray-800');
                        dot.classList.add('bg-gray-300');
                    }
                });
            }

            // Button click handlers
            prevBtn.addEventListener('click', function () {
                const newIndex = Math.max(0, currentIndex - 1);
                scrollToCard(newIndex);
            });

            nextBtn.addEventListener('click', function () {
                const newIndex = Math.min(total - 1, currentIndex + 1);
                scrollToCard(newIndex);
            });

            // Dot click handlers
            dots.forEach((dot, i) => {
                dot.addEventListener('click', function() {
                    scrollToCard(i);
                });
                dot.style.cursor = 'pointer';
            });

            // Listen for scroll events to update UI
            let scrollTimeout;
            wrapper.addEventListener('scroll', function () {
                clearTimeout(scrollTimeout);
                scrollTimeout = setTimeout(updateUI, 50);
            }, { passive: true });

            // Handle resize
            window.addEventListener('resize', function () {
                window.requestAnimationFrame(updateUI);
            });

            // Initial setup
            updateUI();
        })();
    </script>

    <script>
        (function () {
            const form = document.getElementById('discussForm');
            const statusEl = document.getElementById('discussStatus');
            if (!form || !statusEl) return;

            const setStatus = (msg, ok = true) => {
                statusEl.textContent = msg;
                statusEl.classList.remove('hidden');
                if (ok) {
                    statusEl.classList.remove('text-red-600');
                    statusEl.classList.add('text-green-700');
                } else {
                    statusEl.classList.remove('text-green-700');
                    statusEl.classList.add('text-red-600');
                }
            };

            const DRAFT_ENDPOINT = '/api/enquiry/draft/';
            const SESSION_KEY = 'bs_sid';
            let draftTimer = null;

            function getFormSnapshot() {
                const quantity = form.querySelector('input[name="quantity"]')?.value || '';
                const mobile = form.querySelector('input[name="mobile"]')?.value || '';
                const frequency = form.querySelector('select[name="frequency"]')?.value || '';
                return { quantity, mobile, frequency };
            }

            function hasMeaningfulData(snapshot) {
                if (!snapshot) return false;
                const { quantity, mobile, frequency } = snapshot;
                return Boolean(
                    (quantity && quantity.toString().trim().length) ||
                    (mobile && mobile.toString().trim().length) ||
                    (frequency && frequency.toString().trim().length)
                );
            }

            function buildDraftPayload(reason) {
                const snap = getFormSnapshot();
                if (!hasMeaningfulData(snap)) return null;

                const pid = "{{ product.id|default:'' }}";
                const pslug = "{{ product.slug|default:'' }}";
                const pname = "{{ product.product_title|default:'' }}";
                let sid = '';
                try {
                    sid = (window.localStorage && localStorage.getItem(SESSION_KEY)) || '';
                } catch (e) {
                    sid = '';
                }

                return {
                    session_id: sid || '',
                    product_id: pid || '',
                    product_slug: pslug || '',
                    product_name: pname || '',
                    quantity: snap.quantity,
                    mobile: snap.mobile,
                    frequency: snap.frequency,
                    page_url: window.location.pathname + window.location.search,
                    reason: reason || 'typing',
                };
            }

            function sendDraftNow(reason, useBeaconIfPossible) {
                const payload = buildDraftPayload(reason);
                if (!payload) return;

                const bodyStr = JSON.stringify(payload);

                if (useBeaconIfPossible && navigator.sendBeacon) {
                    try {
                        const blob = new Blob([bodyStr], { type: 'application/json' });
                        navigator.sendBeacon(DRAFT_ENDPOINT, blob);
                        return;
                    } catch (e) {
                        // Fallback to fetch below
                    }
                }

                // Fire and forget; errors are intentionally ignored
                fetch(DRAFT_ENDPOINT, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: bodyStr,
                    keepalive: !!useBeaconIfPossible,
                }).catch(() => {});
            }

            function scheduleDraftSave(reason) {
                const snap = getFormSnapshot();
                if (!hasMeaningfulData(snap)) return;

                if (draftTimer) {
                    clearTimeout(draftTimer);
                }
                draftTimer = setTimeout(() => {
                    sendDraftNow(reason || 'typing', false);
                }, 800);
            }

            // Autosave while the user is typing/changing fields
            ['input', 'change'].forEach(evtName => {
                form.addEventListener(evtName, () => {
                    scheduleDraftSave('typing');
                });
            });

            // Final best-effort save just before the user leaves the page
            window.addEventListener('beforeunload', function () {
                try {
                    // Flush any pending timer synchronously
                    if (draftTimer) {
                        clearTimeout(draftTimer);
                        draftTimer = null;
                    }
                    sendDraftNow('unload', true);
                } catch (e) { }
            });

            document.addEventListener('visibilitychange', function () {
                if (document.visibilityState === 'hidden') {
                    try {
                        if (draftTimer) {
                            clearTimeout(draftTimer);
                            draftTimer = null;
                        }
                        sendDraftNow('hidden', true);
                    } catch (e) { }
                }
            });

            form.addEventListener('submit', async function (e) {
                e.preventDefault();
                const submitBtn = form.querySelector('button[type="submit"]');
                const quantity = form.querySelector('input[name="quantity"]')?.value || '';
                const mobile = form.querySelector('input[name="mobile"]')?.value || '';
                const frequency = form.querySelector('select[name="frequency"]')?.value || '';
                const pid = "{{ product.id|default:'' }}";
                const pslug = "{{ product.slug|default:'' }}";
                const pname = "{{ product.product_title|default:'' }}";

                setStatus('Submitting your request...', true);
                submitBtn && (submitBtn.disabled = true);
                try {
                    // Try to mark the latest draft as up-to-date before full submit
                    try {
                        if (draftTimer) {
                            clearTimeout(draftTimer);
                            draftTimer = null;
                        }
                        sendDraftNow('submit', false);
                    } catch (e) { }

                    const resp = await fetch('/api/enquiry/submit/', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            product_id: pid,
                            product_slug: pslug,
                            product_name: pname,
                            quantity,
                            mobile,
                            frequency
                        })
                    });
                    const data = await resp.json();
                    if (resp.ok && data.status === 'success') {
                        form.reset();
                        setStatus(`Thanks! We received your request for ${pname || 'this product'}. Our team will contact you shortly.`, true);
                    } else {
                        setStatus(data.message || 'Failed to submit. Please try again.', false);
                    }
                } catch (err) {
                    setStatus('Network error. Please try again.', false);
                } finally {
                    submitBtn && (submitBtn.disabled = false);
                }
            });
        })();
    </script>

    <!-- Footer (same as product_detail.html) -->
  <footer class="bg-gray-800 text-white">
    <!-- QC Checked Notice Strip -->
    <div class="quicksand-font w-full bg-[#F1EFF2] border-b border-gray-200">
      <div
        class="{% if request.path == '/about/' %} hidden{% else %}max-w-7xl mx-auto px-4 py-4 text-center text-[10px] xs:text-xs md:text-sm font-medium text-gray-700 uppercase{% endif %}">
        ALL PRODUCTS ARE QC-VERIFIED BY <b class="font-bold">globesuggest</b> AND DISPATCHED FROM OUR CERTIFIED MANUFACTURING NETWORK.
      </div>
    </div>

    <div class="max-w-7xl mx-auto px-6 md:px-0 py-12">
      <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
        <div>
          <h3 class="text-xl font-bold mb-4">globesuggest</h3>
          <p class="text-sm text-gray-400">Trusted by manufacturers, D2C brands, and private-label businesses for repeatable quality, verified specifications, and uninterrupted bulk supply across all major product categories.</p>
        </div>
        <div>
          <h3 class="text-xl font-bold mb-4">Quick Links</h3>
          <ul class="space-y-2">
            <li><a href="/" class="hover:text-indigo-400 transition-colors">Home</a></li>
            <li><a href="{% url 'about' %}" class="hover:text-indigo-400 transition-colors">About</a></li>
            <li><a href="{% url 'contact_view' %}" class="hover:text-indigo-400 transition-colors">Contact Us</a></li>
          </ul>
        </div>
        <div>
          <h3 class="text-xl font-bold mb-4">Legal</h3>
          <ul class="space-y-2">
            <li>
              <a href="{% url 'privacy_policy' %}" class="hover:text-indigo-400 transition-colors">
                Privacy Policy
              </a>
            </li>
            <li>
              <a href="{% url 'terms_of_service' %}" class="hover:text-indigo-400 transition-colors">
                Terms of Service
              </a>
            </li>
            <li>
              <a href="{% url 'cookies_policy' %}" class="hover:text-indigo-400 transition-colors">
                Cookies
              </a>
            </li>
          </ul>
        </div>
        <div>
          <h3 class="text-xl font-bold mb-4">Connect With Us</h3>
          <div class="mt-4 text-gray-400 text-justify">
            <p>Helpline: <a href="tel:+918860160101" class="hover:text-indigo-400 transition-colors">+91 88 601 601 01</a></p>
                <p class="mt-2 text-sm">Email us at <a href="mailto:care@globesuggest.com" class="hover:text-indigo-400 transition-colors">care@globesuggest.com</a></p>
          </div>
        </div>
      </div>
      <div class="mt-12 border-t border-gray-700 pt-8 text-center text-gray-500">
        <p>&copy; {% now "Y" %} globesuggest. All Rights Reserved.</p>
      </div>
    </div>
  </footer>

    <script>
        // --- Behavioural tracking client ---
        (function () {
            try {
                const CONFIG = {
                    ingestUrl: '{{ analytics.ingest_url|default:"/api/analytics/ingest/" }}',
                    sampleRate: {{ analytics.sample_rate|default: 1.0
            }},
            requireConsent: { { analytics.require_consent | yesno: 'true,false' } },
        batchIntervalMs: 5000,
            maxBatch: 40
        };

        const win = window; const doc = document;
        // Client-side sampling
        if (Math.random() > CONFIG.sampleRate) return;

        // Session
        const sidKey = 'bs_sid';
        const firstSeenKey = 'bs_first_seen';
        const storedSid = localStorage.getItem(sidKey) || (crypto.randomUUID ? crypto.randomUUID() : (Date.now() + '' + Math.random()).replace('.', ''));
        localStorage.setItem(sidKey, storedSid);
        const firstSeen = localStorage.getItem(firstSeenKey) || (Date.now().toString());
        localStorage.setItem(firstSeenKey, firstSeen);
        const isReturning = Date.now() - parseInt(firstSeen || '0', 10) > 1000 * 60 * 60 * 24;

        const productId = '{{ product.id|default:product.id|default:"" }}';
        const userId = (win.__userId || '') + '';
        const consent = CONFIG.requireConsent ? (win.__userConsent === true) : true;

        const nav = navigator || {}; const scr = screen || {};
        const ctx = {
            session_id: storedSid,
            user_id: userId || null,
            product_id: productId || null,
            started_at: new Date().toISOString(),
            path: location.pathname + location.search,
            traffic_source: document.referrer ? 'referral' : 'direct',
            utm_source: new URLSearchParams(location.search).get('utm_source') || '',
            utm_medium: new URLSearchParams(location.search).get('utm_medium') || '',
            utm_campaign: new URLSearchParams(location.search).get('utm_campaign') || '',
            utm_term: new URLSearchParams(location.search).get('utm_term') || '',
            utm_content: new URLSearchParams(location.search).get('utm_content') || '',
            device: (scr.width >= 1024 ? 'desktop' : (scr.width >= 768 ? 'tablet' : 'mobile')),
            os: (nav.userAgentData && nav.userAgentData.platform) || (nav.platform || ''),
            browser: (nav.userAgentData && nav.userAgentData.brands && nav.userAgentData.brands.map(b => b.brand + "/" + b.version).join(', ')) || (nav.userAgent || ''),
            viewport: (win.innerWidth + 'x' + win.innerHeight),
            orientation: (screen.orientation && screen.orientation.type) || (win.innerWidth > win.innerHeight ? 'landscape' : 'portrait'),
            language: (nav.language || '').split(',')[0],
            country: '',
            consent: !!consent,
            is_returning: !!isReturning,
            sampled: true,
            max_scroll_pct: 0,
            cta_clicks: 0,
            enquiry_submissions: 0,
            video_seconds_watched: 0,
            idle_time_ms: 0,
            events_count: 0,
        };

        // Event queue with offline fallback
        const q = [];
        const offlineKey = 'bs_event_queue';
        try { const cached = JSON.parse(localStorage.getItem(offlineKey) || '[]'); if (Array.isArray(cached)) q.push(...cached); } catch (e) { }

        function pushEvent(ev) {
            ev.session_id = ctx.session_id;
            ev.user_id = ctx.user_id;
            ev.product_id = ctx.product_id;
            ev.page_url = location.href;
            ev.referrer = document.referrer || '';
            ev.occurred_at = ev.occurred_at || new Date().toISOString();
            q.push(ev); ctx.events_count++;
            if (!navigator.onLine) { localStorage.setItem(offlineKey, JSON.stringify(q.slice(-200))); }
            if (q.length >= CONFIG.maxBatch) flush();
        }

        // Throttled flush
        let flushing = false;
        async function flush() {
            if (flushing || q.length === 0) return; flushing = true;
            const batch = q.splice(0, CONFIG.maxBatch);
            const payload = { session: ctx, events: batch };
            try {
                await fetch(CONFIG.ingestUrl, {
                    method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload), keepalive: true
                });
                localStorage.removeItem(offlineKey);
            } catch (e) {
                // Put back at front and persist
                batch.reverse().forEach(ev => q.unshift(ev));
                localStorage.setItem(offlineKey, JSON.stringify(q.slice(-200)));
            } finally { flushing = false; }
        }
        setInterval(flush, CONFIG.batchIntervalMs);
        win.addEventListener('beforeunload', () => { ctx.ended_at = new Date().toISOString(); flush(); });
        document.addEventListener('visibilitychange', () => { if (document.visibilityState === 'hidden') { ctx.ended_at = new Date().toISOString(); flush(); } });

        // Load performance timings (first paint etc.)
        if ('performance' in win && performance.getEntriesByType) {
            setTimeout(() => {
                try {
                    const navEntry = performance.getEntriesByType('navigation')[0];
                    if (navEntry) {
                        pushEvent({
                            event_type: 'perf', payload: {
                                domContentLoaded: Math.round(navEntry.domContentLoadedEventEnd),
                                loadEventEnd: Math.round(navEntry.loadEventEnd),
                                firstByte: Math.round(navEntry.responseStart - navEntry.requestStart),
                            }
                        });
                    }
                } catch (e) { }
            }, 0);
        }

        // Scroll depth
        let maxScroll = 0; let ticking = false;
        win.addEventListener('scroll', () => {
            if (!ticking) {
                ticking = true; requestAnimationFrame(() => {
                    const scrolled = (win.scrollY + win.innerHeight) / Math.max(document.body.scrollHeight, 1);
                    const pct = Math.round(scrolled * 100);
                    if (pct > maxScroll) { maxScroll = pct; ctx.max_scroll_pct = pct; pushEvent({ event_type: 'scroll_depth', payload: { pct } }); }
                    ticking = false;
                });
            }
        }, { passive: true });

        // Section view tracking via IntersectionObserver
        if ('IntersectionObserver' in win) {
            const io = new IntersectionObserver((entries) => {
                entries.forEach(e => {
                    if (e.isIntersecting && e.intersectionRatio >= 0.5) {
                        const id = e.target.getAttribute('data-section') || 'section';
                        pushEvent({ event_type: 'section_view', payload: { id } });
                    }
                })
            }, { threshold: [0.5] });
            document.querySelectorAll('[data-section]').forEach(el => io.observe(el));
        }

        // CTA clicks
        document.body.addEventListener('click', (ev) => {
            const btn = ev.target.closest('[data-cta]');
            if (btn) { ctx.cta_clicks++; pushEvent({ event_type: 'cta_click', payload: { id: btn.getAttribute('data-cta') } }); }
            // Heatmap click (rounded coords)
            const x = Math.round(ev.clientX / 10) * 10; const y = Math.round(ev.clientY / 10) * 10;
            pushEvent({ event_type: 'click', payload: { x, y } });
        });

        // Variation interactions
        document.body.addEventListener('click', (ev) => {
            const btn = ev.target.closest('button');
            if (btn && btn.textContent && btn.closest('[data-section]') && /Variations|Size|Colours|Color/i.test(btn.closest('[data-section]').textContent)) {
                pushEvent({ event_type: 'variation_select', payload: { text: (btn.innerText || '').trim().slice(0, 80) } });
            }
        });

        // Price-area interactions
        document.querySelectorAll('[data-role="price-area"]').forEach(el => {
            el.addEventListener('click', () => pushEvent({ event_type: 'price_area_click' }));
        });

        // Read-more toggles
        const rm = document.getElementById('readMoreBtn'); const rl = document.getElementById('readLessBtn');
        if (rm) rm.addEventListener('click', () => pushEvent({ event_type: 'read_more' }));
        if (rl) rl.addEventListener('click', () => pushEvent({ event_type: 'read_less' }));

        // FAQ expands
        document.querySelectorAll('#faqs-section [data-faq-item] .faq-toggle').forEach(btn => {
            btn.addEventListener('click', () => {
                const q = (btn.querySelector('h3')?.innerText || '').slice(0, 120);
                pushEvent({ event_type: 'faq_toggle', payload: { question: q } });
            })
        });

        // Comparison interactions
        const comp = document.getElementById('comparison-section');
        if (comp) { comp.addEventListener('click', () => pushEvent({ event_type: 'comparison_interact' })); }

        // Blog clicks
        document.querySelectorAll('#blog a[href]').forEach(a => {
            a.addEventListener('click', () => pushEvent({ event_type: 'blog_click', payload: { href: a.getAttribute('href') } }));
        });

        // Enquiry form focus / submit
        (function () {
            const form = document.querySelector('#discuss-your-needs form');
            if (!form) return;
            form.addEventListener('focusin', () => pushEvent({ event_type: 'enquiry_focus' }));
            form.addEventListener('submit', () => { ctx.enquiry_submissions++; pushEvent({ event_type: 'enquiry_submit' }); });
        })();

        // Idle/active tracking
        let idleSince = Date.now();
        function markActive() { if (Date.now() - idleSince > 1000) { ctx.idle_time_ms += Date.now() - idleSince; } idleSince = Date.now(); }
        ['mousemove', 'keydown', 'scroll', 'touchstart'].forEach(evt => document.addEventListener(evt, markActive, { passive: true }));

        // Exit-intent (desktop)
        document.addEventListener('mouseout', (e) => { if (e.clientY <= 0) { pushEvent({ event_type: 'exit_intent' }); } });

        // Page visibility
        document.addEventListener('visibilitychange', () => { pushEvent({ event_type: 'visibility', payload: { state: document.visibilityState } }); });

        // YouTube IFrame API for video metrics
        function initYT() {
            if (!win.YT || !YT.Player) return;
            const selector = 'iframe[src*="youtube.com/embed/"], iframe[src*="youtube-nocookie.com/embed/"]';
            const iframes = Array.from(document.querySelectorAll(selector));
            const locationOrigin = (win.location && win.location.origin) ? win.location.origin : (document.location.protocol + '//' + document.location.host);

            const makeThumbFallback = (frame) => {
                try {
                    const src = frame.getAttribute('src') || '';
                    const match = src.match(/embed\/([a-zA-Z0-9_-]{11})/);
                    const id = match ? match[1] : '';
                    const img = 'https://i.ytimg.com/vi/' + id + '/hqdefault.jpg';
                    const link = document.createElement('a');
                    link.href = 'https://www.youtube.com/watch?v=' + id;
                    link.target = '_blank';
                    link.rel = 'noopener noreferrer';
                    link.className = 'relative block w-full h-full';
                    link.innerHTML = '<img src="' + img + '" alt="Watch on YouTube" class="w-full h-full object-cover">\
                <span class="absolute inset-0 flex items-center justify-center">\
                  <span class="bg-black/60 text-white px-3 py-2 rounded-full text-xs font-semibold">Watch on YouTube</span>\
                </span>';
                    frame.parentNode && frame.parentNode.replaceChild(link, frame);
                } catch (e) { }
            };

            iframes.forEach((frame) => {
                try {
                    const srcLocal = frame.getAttribute('src') || '';
                    const matchLocal = srcLocal.match(/embed\/([a-zA-Z0-9_-]{11})/);
                    const videoId = matchLocal ? matchLocal[1] : '';
                    const p = new YT.Player(frame, {
                        host: 'https://www.youtube-nocookie.com',
                        playerVars: { playsinline: 1, rel: 0, modestbranding: 1, origin: locationOrigin, loop: 1, playlist: videoId },
                        events: {
                            onReady: () => {
                                try { p.mute && p.mute(); } catch (e) { }
                                try { p.playVideo && p.playVideo(); } catch (e) { }
                            },
                            onStateChange: (ev) => {
                                const s = ev.data;
                                const dur = Math.round((p.getDuration ? p.getDuration() : 0));
                                const ct = Math.round((p.getCurrentTime ? p.getCurrentTime() : 0));
                                if (s === YT.PlayerState.PLAYING) pushEvent({ event_type: 'video_play', payload: { ct, dur } });
                                if (s === YT.PlayerState.PAUSED) pushEvent({ event_type: 'video_pause', payload: { ct, dur } });
                                if (s === YT.PlayerState.ENDED) { pushEvent({ event_type: 'video_end', payload: { ct: dur, dur } }); try { p.seekTo(0, true); p.playVideo && p.playVideo(); } catch (e) { } }
                                ctx.video_seconds_watched = Math.max(ctx.video_seconds_watched, ct);
                            },
                            onError: (err) => {
                                const code = (err && err.data) || 0;
                                // 150/101/153 => embedding disabled or blocked, 2/5/100 other errors
                                if (code === 150 || code === 101 || code === 153) {
                                    const retried = frame.getAttribute('data-nc-retried') === '1';
                                    const src = frame.getAttribute('src') || '';
                                    const alreadyNoCookie = src.indexOf('youtube-nocookie.com') !== -1;
                                    if (!alreadyNoCookie) {
                                        const newSrc = src.replace('youtube.com', 'youtube-nocookie.com');
                                        frame.setAttribute('src', newSrc);
                                        frame.setAttribute('data-nc-retried', '1');
                                        // Try once more after switching host
                                        setTimeout(() => { try { new YT.Player(frame, { host: 'https://www.youtube-nocookie.com' }); } catch (e) { } }, 50);
                                        return;
                                    }
                                    if (!retried) { frame.setAttribute('data-nc-retried', '1'); setTimeout(() => { try { p.playVideo && p.playVideo(); } catch (e) { } }, 50); return; }
                                    // Final fallback: thumbnail link
                                    makeThumbFallback(frame);
                                }
                            }
                        }
                    });
                } catch (e) { }
            });
        }
        if (!win.YT) {
            const tag = document.createElement('script'); tag.src = 'https://www.youtube.com/iframe_api';
            win.onYouTubeIframeAPIReady = function () { try { initYT(); } catch (e) { } };
            document.head.appendChild(tag);
        } else { initYT(); }

        // Image showcase interactions
        document.querySelectorAll('[data-showcase-thumb]').forEach(btn => {
            btn.addEventListener('click', () => pushEvent({ event_type: 'image_thumb_click' }));
        });

        // Initial page_view
        pushEvent({ event_type: 'page_view' });

        // Periodic duration update
        setInterval(() => { ctx.duration_ms = Date.now() - (new Date(ctx.started_at)).getTime(); }, 1000);

      } catch (e) { /* swallow */ }
    }) ();
        // Reviews Functionality
        (function () {
            function initReviews() {
            // Reviews System
            // Handle Review CTA / Popup / Accordion
            const writeReviewBtn = document.getElementById('writeReviewBtn');
            const reviewPopup = document.getElementById('reviewPopup');
            const closeReviewPopup = document.getElementById('closeReviewPopup');
            const seeAllReviewsBtn = document.getElementById('seeAllReviewsBtn');
            const reviewSortSelect = document.getElementById('reviewSortSelect');
            const prevPageBtn = document.getElementById('prevPageBtn');
            const nextPageBtn = document.getElementById('nextPageBtn');
            const paginationNumbers = document.getElementById('paginationNumbers');
            const reviewsList = document.getElementById('reviewsList');
            const productId = '{{ product.id }}';

            // Review Accordion behavior
            const reviewAccordionBtn = document.getElementById('review-accordion-btn');
            const reviewAccordionPanel = document.getElementById('review-accordion-panel');
            const reviewAccordionIcon = document.getElementById('review-accordion-icon');

            function setReviewAccordionOpen(isOpen) {
                if (!reviewAccordionBtn || !reviewAccordionPanel) return;

                reviewAccordionBtn.setAttribute('aria-expanded', isOpen ? 'true' : 'false');
                if (isOpen) {
                    reviewAccordionPanel.classList.remove('hidden');
                    if (reviewAccordionIcon) reviewAccordionIcon.classList.add('rotate-180');
                } else {
                    reviewAccordionPanel.classList.add('hidden');
                    if (reviewAccordionIcon) reviewAccordionIcon.classList.remove('rotate-180');
                }
            }

            if (reviewAccordionBtn && reviewAccordionPanel) {
                const defaultOpen = reviewAccordionBtn.getAttribute('data-default-open') === '1';
                setReviewAccordionOpen(defaultOpen);
            }

            // Allow FAQ or other CTAs to open the review accordion
            const reviewOpenSelectors = 'a[href="#reviews-section"], a[href="#write-review"], [data-open-review], .open-review';
            document.querySelectorAll(reviewOpenSelectors).forEach((el) => {
                el.addEventListener('click', function (e) {
                    // If it's an anchor, prevent default jump to handle smooth scroll + open
                    if (el.tagName.toLowerCase() === 'a') {
                        e.preventDefault();
                    }
                    setReviewAccordionOpen(true);
                    const reviewsSection = document.getElementById('reviews-section');
                    if (reviewsSection) {
                        reviewsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    }
                    setTimeout(() => {
                        const nameInput = document.getElementById('reviewName');
                        if (nameInput) nameInput.focus();
                    }, 300);
                });
            });

            // Global state for reviews pagination
            const reviewsState = {
                currentPage: 1,
                totalPages: 1,
                sort: 'newest'
            };

            // Initial setup
            if (prevPageBtn) {
                prevPageBtn.disabled = true;
            }

            if (nextPageBtn && reviewsState.currentPage >= reviewsState.totalPages) {
                nextPageBtn.disabled = true;
            }

            // Review CTA behavior: prefer accordion, fall back to popup if present
            if (writeReviewBtn) {
                writeReviewBtn.addEventListener('click', function () {
                    // If accordion exists, open it and scroll into view
                    if (reviewAccordionBtn && reviewAccordionPanel) {
                        setReviewAccordionOpen(true);
                        const reviewsSection = document.getElementById('reviews-section');
                        if (reviewsSection) {
                            reviewsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                        }
                        setTimeout(() => {
                            const nameInput = document.getElementById('reviewName');
                            if (nameInput) nameInput.focus();
                        }, 300);
                        return;
                    }

                    // Legacy popup behavior (only if popup markup exists)
                    if (reviewPopup) {
                        reviewPopup.classList.remove('hidden');
                        // Make sure review form is visible and OTP form is hidden
                        const reviewFormEl = document.getElementById('reviewForm');
                        const otpFormEl = document.getElementById('otpVerificationForm');
                        if (reviewFormEl) reviewFormEl.classList.remove('hidden');
                        if (otpFormEl) otpFormEl.classList.add('hidden');
                    }
                });
            }

            if (closeReviewPopup && reviewPopup) {
                closeReviewPopup.addEventListener('click', function () {
                    reviewPopup.classList.add('hidden');
                });

                // Close popup when clicking outside
                reviewPopup.addEventListener('click', function (e) {
                    if (e.target === reviewPopup) {
                        reviewPopup.classList.add('hidden');
                    }
                });
            }

            // See all reviews button
            if (seeAllReviewsBtn) {
                seeAllReviewsBtn.addEventListener('click', function () {
                    // Scroll to reviews container
                    document.getElementById('reviewsContainer').scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });

                    // Load all reviews
                    loadReviews(1, reviewsState.sort);
                });
            }

            // Review sorting
            if (reviewSortSelect) {
                reviewSortSelect.addEventListener('change', function () {
                    reviewsState.sort = this.value;
                    loadReviews(1, reviewsState.sort);
                });
            }

            // Pagination buttons
            if (prevPageBtn) {
                prevPageBtn.addEventListener('click', function () {
                    if (reviewsState.currentPage > 1) {
                        loadReviews(reviewsState.currentPage - 1, reviewsState.sort);
                    }
                });
            }

            if (nextPageBtn) {
                nextPageBtn.addEventListener('click', function () {
                    if (reviewsState.currentPage < reviewsState.totalPages) {
                        loadReviews(reviewsState.currentPage + 1, reviewsState.sort);
                    }
                });
            }

            // Handle Star Rating
            const ratingStars = document.querySelectorAll('.rating-stars i');
            const ratingInput = document.getElementById('ratingInput');

            if (ratingStars.length > 0 && ratingInput) {
                ratingStars.forEach(star => {
                    star.addEventListener('click', function () {
                        const rating = parseInt(this.getAttribute('data-rating'));
                        ratingInput.value = rating;

                        // Update stars visual
                        ratingStars.forEach((s, index) => {
                            if (index < rating) {
                                s.classList.add('text-yellow-400');
                                s.classList.remove('text-gray-300');
                            } else {
                                s.classList.remove('text-yellow-400');
                                s.classList.add('text-gray-300');
                            }
                        });
                    });

                    // Hover effects
                    star.addEventListener('mouseenter', function () {
                        const rating = parseInt(this.getAttribute('data-rating'));

                        ratingStars.forEach((s, index) => {
                            if (index < rating) {
                                s.classList.add('text-yellow-400');
                                s.classList.remove('text-gray-300');
                            }
                        });
                    });

                    star.addEventListener('mouseleave', function () {
                        const currentRating = parseInt(ratingInput.value);

                        ratingStars.forEach((s, index) => {
                            if (index < currentRating) {
                                s.classList.add('text-yellow-400');
                                s.classList.remove('text-gray-300');
                            } else {
                                s.classList.remove('text-yellow-400');
                                s.classList.add('text-gray-300');
                            }
                        });
                    });
                });
            }

            // Handle Photo Upload
            const photoUploadArea = document.getElementById('photoUploadArea');
            const photoUpload = document.getElementById('photoUpload');
            const uploadPreviewContainer = document.getElementById('uploadPreviewContainer');
            const billUploadInput = document.getElementById('billUpload');
            const billUploadName = document.getElementById('billUploadName');
            const mediaUploadInput = document.getElementById('mediaUpload');
            const mediaUploadName = document.getElementById('mediaUploadName');

            if (billUploadInput && billUploadName) {
                billUploadInput.addEventListener('change', function () {
                    if (this.files && this.files.length > 0) {
                        billUploadName.textContent = this.files[0].name;
                        billUploadName.classList.remove('hidden');
                    } else {
                        billUploadName.textContent = '';
                        billUploadName.classList.add('hidden');
                    }
                });
            }

            if (mediaUploadInput && mediaUploadName) {
                mediaUploadInput.addEventListener('change', function () {
                    if (this.files && this.files.length > 0) {
                        mediaUploadName.textContent = this.files[0].name;
                        mediaUploadName.classList.remove('hidden');
                    } else {
                        mediaUploadName.textContent = '';
                        mediaUploadName.classList.add('hidden');
                    }
                });
            }

            if (photoUploadArea && photoUpload && uploadPreviewContainer) {
                photoUploadArea.addEventListener('click', function () {
                    photoUpload.click();
                });

                photoUpload.addEventListener('change', function () {
                    displaySelectedImages(this.files);
                });

                // Drag and drop functionality
                photoUploadArea.addEventListener('dragover', function (e) {
                    e.preventDefault();
                    photoUploadArea.classList.add('border-indigo-500');
                    photoUploadArea.classList.add('bg-indigo-50');
                });

                photoUploadArea.addEventListener('dragleave', function () {
                    photoUploadArea.classList.remove('border-indigo-500');
                    photoUploadArea.classList.remove('bg-indigo-50');
                });

                photoUploadArea.addEventListener('drop', function (e) {
                    e.preventDefault();
                    photoUploadArea.classList.remove('border-indigo-500');
                    photoUploadArea.classList.remove('bg-indigo-50');

                    if (e.dataTransfer.files.length) {
                        displaySelectedImages(e.dataTransfer.files);
                    }
                });

                function displaySelectedImages(files) {
                    // Limit to 5 images
                    const maxFiles = 5;
                    const filesToProcess = Array.from(files).slice(0, maxFiles);

                    filesToProcess.forEach(file => {
                        if (file.type.startsWith('image/')) {
                            const reader = new FileReader();

                            reader.onload = function (e) {
                                const imgContainer = document.createElement('div');
                                imgContainer.className = 'relative';

                                const img = document.createElement('img');
                                img.src = e.target.result;
                                img.className = 'w-20 h-20 object-cover rounded-md';
                                img.file = file;

                                const removeBtn = document.createElement('button');
                                removeBtn.className = 'absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center';
                                removeBtn.innerHTML = '×';
                                removeBtn.onclick = function () {
                                    imgContainer.remove();
                                };

                                imgContainer.appendChild(img);
                                imgContainer.appendChild(removeBtn);
                                uploadPreviewContainer.appendChild(imgContainer);
                            };

                            reader.readAsDataURL(file);
                        }
                    });
                }
            }

            // Handle Review Form Submission
            const reviewForm = document.getElementById('reviewForm');
            const otpVerificationForm = document.getElementById('otpVerificationForm');
            const backToReviewBtn = document.getElementById('backToReviewBtn');
            const resendOtpBtn = document.getElementById('resendOtpBtn');
            const reviewSubmitBtn = document.getElementById('reviewSubmitBtn');
            let currentEmail = ''; // Store email for OTP verification

            // Prevent native form submission (always use AJAX)
            if (reviewForm) {
                reviewForm.addEventListener('submit', function (e) {
                    e.preventDefault();
                });
            }

            function submitReviewViaAjax() {
                if (!reviewForm || !reviewSubmitBtn) return;

                // Show loading state
                const submitBtn = reviewSubmitBtn;
                const originalBtnText = submitBtn.innerHTML;
                submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Submitting...';
                submitBtn.disabled = true;

                // Validate rating
                const rating = parseInt(ratingInput.value);
                if (isNaN(rating) || rating === 0) {
                    alert('Please select a rating');
                    submitBtn.innerHTML = originalBtnText;
                    submitBtn.disabled = false;
                    return;
                }

                // Validate required files
                if (!billUploadInput || !billUploadInput.files.length) {
                    alert('Please upload your bill / invoice document.');
                    submitBtn.innerHTML = originalBtnText;
                    submitBtn.disabled = false;
                    return;
                }
                if (!mediaUploadInput || !mediaUploadInput.files.length) {
                    alert('Please upload a product photo or video.');
                    submitBtn.innerHTML = originalBtnText;
                    submitBtn.disabled = false;
                    return;
                }

                // Collect form data
                const formData = {
                    name: document.getElementById('reviewName').value,
                    email: document.getElementById('reviewEmail').value,
                    title: document.getElementById('reviewTitle').value,
                    content: document.getElementById('reviewContent').value,
                    rating: rating
                };

                // Store email for OTP verification
                currentEmail = formData.email;

                // Submit review data and request OTP
                fetch(`/api/products/${productId}/reviews/add/`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                })
                    .then(response => response.json())
                    .then(data => {
                        if (data.status === 'success' && data.require_verification) {
                            // Show OTP verification form
                            reviewForm.classList.add('hidden');
                            otpVerificationForm.classList.remove('hidden');

                            // Focus on OTP input
                            const otpEl = document.getElementById('otpInput');
                            if (otpEl) otpEl.focus();
                        } else {
                            // For backward compatibility or if OTP is not required
                            handleReviewSuccess(data);
                        }

                        // Reset button
                        submitBtn.innerHTML = originalBtnText;
                        submitBtn.disabled = false;
                    })
                    .catch(error => {
                        alert('Error: ' + error.message);
                        submitBtn.innerHTML = originalBtnText;
                        submitBtn.disabled = false;
                    });
            }

            if (reviewSubmitBtn) {
                reviewSubmitBtn.addEventListener('click', function () {
                    submitReviewViaAjax();
                });
            }
            // Expose for inline onclick fallback
            window.bsSubmitReview = submitReviewViaAjax;

            // Handle OTP Verification
            if (otpVerificationForm) {
                otpVerificationForm.addEventListener('submit', function (e) {
                    e.preventDefault();

                    // Show loading state
                    const verifyBtn = document.getElementById('verifyOtpBtn');
                    const originalBtnText = verifyBtn.innerHTML;
                    verifyBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Verifying...';
                    verifyBtn.disabled = true;

                    const otpCode = document.getElementById('otpInput').value.trim();

                    // Validate OTP
                    if (!otpCode || otpCode.length !== 6) {
                        alert('Please enter a valid 6-digit verification code');
                        verifyBtn.innerHTML = originalBtnText;
                        verifyBtn.disabled = false;
                        return;
                    }

                    // Submit OTP for verification
                    fetch(`/api/products/${productId}/reviews/verify-otp/`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            email: currentEmail,
                            otp_code: otpCode
                        })
                    })
                        .then(response => response.json())
                        .then(data => {
                            if (data.status === 'success') {
                                // OTP verified, review submitted
                                handleReviewSuccess(data);

                                // Reset OTP form
                                otpVerificationForm.reset();
                            } else {
                                alert('Error: ' + (data.message || 'Invalid verification code'));
                            }

                            // Reset button
                            verifyBtn.innerHTML = originalBtnText;
                            verifyBtn.disabled = false;
                        })
                        .catch(error => {
                            alert('Error: ' + error.message);
                            verifyBtn.innerHTML = originalBtnText;
                            verifyBtn.disabled = false;
                        });
                });
            }

            // Handle "Back to Review" button
            if (backToReviewBtn) {
                backToReviewBtn.addEventListener('click', function () {
                    otpVerificationForm.classList.add('hidden');
                    reviewForm.classList.remove('hidden');
                });
            }

            // Handle "Resend OTP" button
            if (resendOtpBtn) {
                resendOtpBtn.addEventListener('click', function () {
                    const btn = this;
                    const originalText = btn.innerHTML;
                    btn.innerHTML = '<i class="fas fa-spinner fa-spin mr-1"></i> Sending...';
                    btn.disabled = true;

                    fetch(`/api/products/${productId}/reviews/resend-otp/`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ email: currentEmail })
                    })
                        .then(response => response.json())
                        .then(data => {
                            if (data.status === 'success') {
                                // Show temporary success message
                                btn.innerHTML = '<i class="fas fa-check mr-1"></i> Sent!';
                                setTimeout(() => {
                                    btn.innerHTML = originalText;
                                    btn.disabled = false;
                                }, 3000);
                            } else {
                                alert('Error: ' + (data.message || 'Failed to resend code'));
                                btn.innerHTML = originalText;
                                btn.disabled = false;
                            }
                        })
                        .catch(error => {
                            alert('Error: ' + error.message);
                            btn.innerHTML = originalText;
                            btn.disabled = false;
                        });
                });
            }

            // Helper function to handle successful review submission
            function handleReviewSuccess(data) {
                // Check if there are images to upload
                const uploadedImages = document.querySelectorAll('#uploadPreviewContainer img');

                if (data.review_id) {
                    // Upload bill, media and optional images
                    const filesFormData = new FormData();

                    if (billUploadInput && billUploadInput.files.length) {
                        filesFormData.append('bill_document', billUploadInput.files[0]);
                    }
                    if (mediaUploadInput && mediaUploadInput.files.length) {
                        filesFormData.append('product_media', mediaUploadInput.files[0]);
                    }

                    uploadedImages.forEach(img => {
                        if (img.file) {
                            filesFormData.append('images', img.file);
                        }
                    });

                    return fetch(`/api/reviews/${data.review_id}/images/`, {
                        method: 'POST',
                        body: filesFormData
                    })
                        .then(response => response.json())
                        .then(fileData => {
                            completeReviewSubmission(data.message + ' ' + (fileData.message || 'Files uploaded.'));
                        })
                        .catch(error => {
                            // Still complete the review even if file upload fails
                            completeReviewSubmission(data.message + ' (Some files may not have been uploaded)');
                        });
                } else {
                    completeReviewSubmission(data.message);
                }
            }

            // Final steps after review submission
            function completeReviewSubmission(message) {
                const banner = document.getElementById('reviewSuccessBanner');

                // Show inline greeting instead of intrusive alert
                if (banner) {
                    const defaultMsg = 'Thank you for your review! It will be visible after moderation.';
                    const finalText = message || defaultMsg;
                    // Only replace the descriptive line; keep heading & icon
                    const detailNode = banner.querySelector('p[data-role="review-success-detail"]');
                    if (detailNode) {
                        detailNode.textContent = finalText;
                    }
                    banner.classList.remove('hidden');

                    // Auto-hide after a while (non-blocking)
                    setTimeout(() => {
                        banner.classList.add('hidden');
                    }, 10000);
                } else {
                    // Fallback if banner is missing
                    alert(message || 'Thank you for your review! It will be visible after moderation.');
                }

                // Close popup and reset forms
                if (reviewPopup) {
                    reviewPopup.classList.add('hidden');
                }
                if (reviewForm) {
                    reviewForm.reset();
                }
                if (otpVerificationForm) {
                    otpVerificationForm.reset();
                }

                // Reset rating stars
                if (ratingStars && ratingStars.forEach) {
                    ratingStars.forEach(s => {
                        s.classList.remove('text-yellow-400');
                        s.classList.add('text-gray-300');
                    });
                }
                if (ratingInput) {
                    ratingInput.value = 0;
                }

                // Clear image previews
                if (uploadPreviewContainer) {
                    uploadPreviewContainer.innerHTML = '';
                }

                // Reset forms visibility for next use
                if (reviewForm) {
                    reviewForm.classList.remove('hidden');
                }
                if (otpVerificationForm) {
                    otpVerificationForm.classList.add('hidden');
                }
                setReviewAccordionOpen(false);
            }

            // Expose helpers globally so other scripts (failsafe handler) can reuse
            window.handleReviewSuccess = handleReviewSuccess;
            window.completeReviewSubmission = completeReviewSubmission;
        }
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', initReviews);
            } else {
                initReviews();
            }
        })();
    </script>

    <!-- Failsafe AJAX handler for review submission (decoupled from analytics/initReviews) -->
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const btn = document.getElementById('reviewSubmitBtn');
            if (!btn) return;

            btn.addEventListener('click', function () {
                try {
                    const form = document.getElementById('reviewForm');
                    if (!form) return;

                    const nameEl = document.getElementById('reviewName');
                    const emailEl = document.getElementById('reviewEmail');
                    const titleEl = document.getElementById('reviewTitle');
                    const contentEl = document.getElementById('reviewContent');
                    const ratingEl = document.getElementById('ratingInput');
                    const billEl = document.getElementById('billUpload');
                    const mediaEl = document.getElementById('mediaUpload');
                    const otpFormEl = document.getElementById('otpVerificationForm');

                    const submitBtn = btn;
                    const originalBtnText = submitBtn.innerHTML;

                    const rating = parseInt((ratingEl && ratingEl.value) || '0', 10);
                    if (!rating || isNaN(rating)) {
                        alert('Please select a rating');
                        return;
                    }
                    if (!billEl || !billEl.files || !billEl.files.length) {
                        alert('Please upload your bill / invoice document.');
                        return;
                    }
                    if (!mediaEl || !mediaEl.files || !mediaEl.files.length) {
                        alert('Please upload a product photo or video.');
                        return;
                    }

                    const payload = {
                        name: (nameEl && nameEl.value) || '',
                        email: (emailEl && emailEl.value) || '',
                        title: (titleEl && titleEl.value) || '',
                        content: (contentEl && contentEl.value) || '',
                        rating: rating,
                    };

                    if (!payload.name || !payload.email || !payload.content) {
                        alert('Please fill your name, email and review.');
                        return;
                    }

                    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Submitting...';
                    submitBtn.disabled = true;

                    const productId = '{{ product.id }}';

                    fetch(`/api/products/${productId}/reviews/add/`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(payload),
                    })
                        .then((r) => r.json())
                        .then((data) => {
                            submitBtn.innerHTML = originalBtnText;
                            submitBtn.disabled = false;

                            if (data.status !== 'success') {
                                alert(data.message || 'Failed to submit review.');
                                return;
                            }

                            // Store email globally for OTP handler (used by existing script)
                            window.bsReviewEmail = payload.email;

                            if (data.require_verification && otpFormEl) {
                                form.classList.add('hidden');
                                otpFormEl.classList.remove('hidden');
                                const otpInput = document.getElementById('otpInput');
                                if (otpInput) otpInput.focus();
                            } else {
                                // No OTP required – treat as complete
                                if (window.handleReviewSuccess) {
                                    window.handleReviewSuccess(data);
                                } else {
                                    alert(data.message || 'Review submitted successfully.');
                                }
                            }
                        })
                        .catch((err) => {
                            submitBtn.innerHTML = originalBtnText;
                            submitBtn.disabled = false;
                            alert('Error submitting review: ' + err.message);
                        });
                } catch (e) {
                    alert('Unexpected error while submitting review.');
                    try {
                        console.error(e);
                    } catch (_) { }
                }
            });
        });
    </script>

    <!-- Voice Narration Script -->
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const narrateButton = document.getElementById('narrate-button');
            if (!narrateButton) return;

            let audioCache = {};
            let currentAudio = null;
            let isPlaying = false;
            const productId = '{{ product.id }}';

            // Helper to get CSRF token
            function getCookie(name) {
                let cookieValue = null;
                if (document.cookie && document.cookie !== '') {
                    const cookies = document.cookie.split(';');
                    for (let i = 0; i < cookies.length; i++) {
                        const cookie = cookies[i].trim();
                        if (cookie.substring(0, name.length + 1) === (name + '=')) {
                            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                            break;
                        }
                    }
                }
                return cookieValue;
            }

            narrateButton.addEventListener('click', async () => {
                if (isPlaying) {
                    if (currentAudio) {
                        currentAudio.pause();
                    }
                    return; // The 'onpause' event will handle UI reset
                }

                narrateButton.innerHTML = `<span class="text-2xl animate-spin">⏳</span><span class="hidden md:inline font-semibold">Loading...</span>`;
                narrateButton.disabled = true;

                const visibleText = getVisibleText();
                if (!visibleText.trim()) {
                    console.warn('No visible text to narrate.');
                    narrateButton.innerHTML = `<span class="text-2xl">🤔</span><span class="hidden md:inline font-semibold">क्या आपको इस प्रोडक्ट को और अच्छे से समझना है?</span>`;
                    narrateButton.disabled = false;
                    return;
                }

                const textHash = simpleHash(visibleText);

                try {
                    let audioData;
                    if (audioCache[textHash]) {
                        audioData = audioCache[textHash];
                    } else {
                        const response = await fetch('/api/voice/narrate/', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'X-CSRFToken': getCookie('csrftoken')
                            },
                            body: JSON.stringify({ visible_text: visibleText, product_id: productId })
                        });

                        if (!response.ok) {
                            const errorData = await response.json();
                            throw new Error(errorData.message || 'Failed to generate audio.');
                        }

                        const data = await response.json();
                        if (data.status === 'success') {
                            audioData = `data:${data.mime_type};base64,${data.audio_base64}`;
                            audioCache[textHash] = audioData; // Cache the result
                        } else {
                            throw new Error(data.message || 'Unknown error from server.');
                        }
                    }

                    playAudio(audioData);

                } catch (error) {
                    console.error("Narration failed:", error);
                    // Show user-friendly error message
                    narrateButton.innerHTML = `<span class="text-2xl">😞</span><span class="hidden md:inline font-semibold">Error!</span>`;
                    setTimeout(() => {
                        narrateButton.innerHTML = `<span class="text-2xl">🤔</span><span class="hidden md:inline font-semibold">क्या आपको इस प्रोडक्ट को और अच्छे से समझना है?</span>`;
                        narrateButton.disabled = false;
                    }, 3000);
                }
            });

            function playAudio(audioSrc) {
                if (currentAudio) {
                    currentAudio.pause();
                    currentAudio.src = ''; // Detach old audio source
                }
                currentAudio = new Audio(audioSrc);

                currentAudio.onplay = () => {
                    isPlaying = true;
                    narrateButton.innerHTML = `<span class="text-2xl">⏹️</span><span class="hidden md:inline font-semibold">Stop Narration</span>`;
                    narrateButton.disabled = false;
                };

                currentAudio.onpause = () => { // Covers both pause and end of audio
                    isPlaying = false;
                    currentAudio.currentTime = 0;
                    narrateButton.innerHTML = `<span class="text-2xl">🤔</span><span class="hidden md:inline font-semibold">क्या आपको इस प्रोडक्ट को और अच्छे से समझना है?</span>`;
                    narrateButton.disabled = false;
                };

                currentAudio.onerror = () => {
                    console.error("Error playing audio.");
                    isPlaying = false;
                    narrateButton.innerHTML = `<span class="text-2xl">😞</span><span class="hidden md:inline font-semibold">Playback Error</span>`;
                    narrateButton.disabled = false;
                }

                currentAudio.play();
            }

            function getVisibleText() {
                // Select a wider range of text-containing elements within the main content
                const mainContent = document.querySelector('main');
                if (!mainContent) return '';

                const elements = mainContent.querySelectorAll('h1, h2, h3, h4, h5, h6, p, li, span, div.prose, th, td');
                let visibleText = new Set();

                elements.forEach(el => {
                    const rect = el.getBoundingClientRect();
                    // Check if the element is in the viewport
                    if (rect.top >= 0 && rect.left >= 0 && rect.bottom <= (window.innerHeight || document.documentElement.clientHeight) && rect.right <= (window.innerWidth || document.documentElement.clientWidth)) {

                        // Basic filtering to avoid including script tags or button texts
                        if (el.tagName.toLowerCase() === 'script' || el.tagName.toLowerCase() === 'style' || el.closest('button')) {
                            return;
                        }

                        let text = el.innerText || el.textContent;
                        text = text.trim();

                        // Only include meaningful text fragments
                        if (text && text.length > 15 && !/Read More|Order|Submit/.test(text)) {
                            visibleText.add(text);
                        }
                    }
                });

                // Join unique text fragments
                return Array.from(visibleText).join('. ');
            }

            function simpleHash(str) {
                let hash = 0;
                for (let i = 0; i < str.length; i++) {
                    const char = str.charCodeAt(i);
                    hash = (hash << 5) - hash + char;
                    hash |= 0; // Convert to 32bit integer
                }
                return hash;
            }
        });
    </script>

    <!-- Quick Enquiry Popup (triggered from fixed-right-logos) -->
    <div id="quick-enquiry-popup" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50 mb-[200px] sm:mb-0">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md mx-auto transform transition-all duration-300 ease-in-out scale-95 opacity-0" id="quick-enquiry-popup-content">
            <div class="p-6 md:p-8">
                <div class="flex justify-end">
                    <button type="button" onclick="closeQuickEnquiryPopup()" class="text-gray-400 hover:text-gray-600 transition-colors">
                        <span class="sr-only">Close</span>
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                </div>

                <div class="text-left max-w-xs mx-auto mt-[-1.5rem]">
                    <h2 class="text-2xl md:text-3xl font-bold text-gray-900">Quick enquiry</h2>
                    <p class="mt-2 text-sm text-gray-500">
                        Share your mobile number and we’ll call you back with the best options for
                        <span class="font-semibold">{{ product.product_title|default:"this product" }}</span>.
                    </p>
                </div>

                <form class="mt-6 space-y-4 max-w-xs mx-auto" onsubmit="event.preventDefault(); submitQuickEnquiry();">
                    <div>
                        <label for="quick-enquiry-mobile" class="block text-xs font-semibold text-gray-600 mb-1 uppercase tracking-wide">
                            Mobile Number
                        </label>
                        <input
                            type="tel"
                            name="quick-enquiry-mobile"
                            id="quick-enquiry-mobile"
                            class="w-full px-4 py-3 text-md font-medium text-gray-700 placeholder-gray-500 bg-gray-100 border-2 border-transparent rounded-xl focus:outline-none focus:ring-2 focus:ring-gray-400 focus:border-transparent"
                            placeholder="Enter your mobile number"
                            autocomplete="tel"
                        >
                    </div>
                    <p id="quick-enquiry-status" class="text-xs text-gray-600 hidden"></p>
                </form>

                <div class="mt-6 flex justify-end max-w-xs mx-auto">
                    <button
                        type="button"
                        id="quick-enquiry-submit-btn"
                        onclick="submitQuickEnquiry()"
                        class="inline-flex items-center gap-x-2 rounded-full bg-black px-4 py-2 text-xs font-semibold text-white shadow-sm hover:bg-gray-800 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-black transition-all duration-300"
                    >
                        <span class="flex h-6 w-6 items-center justify-center rounded-full bg-white">
                            <svg class="h-4 w-4 text-black" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5L21 12m0 0l-7.5 7.5M21 12H3" />
                            </svg>
                        </span>
                        Get call back
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Shipping Policy Modal -->
    <div id="shipping-policy-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50">
        <div id="shipping-policy-modal-content" class="bg-white rounded-2xl shadow-2xl w-full max-w-3xl mx-auto transform transition-all duration-300 ease-in-out scale-95 opacity-0">
            <div class="p-6 md:p-8">
                <div class="flex justify-between items-start gap-4">
                    <div>
                        <h2 class="text-2xl md:text-3xl font-extrabold text-gray-900">
                            {{ shipping_policy.title|default:"Shipping Policy" }}
                        </h2>
                        <p class="text-sm text-gray-500 mt-1">Updated {{ shipping_policy.updated_at|date:"M d, Y" }}</p>
                    </div>
                    <button type="button" onclick="closeShippingPolicyModal()" class="text-gray-400 hover:text-gray-600 transition-colors">
                        <span class="sr-only">Close</span>
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                </div>
                <div class="mt-6 prose max-w-none prose-sm sm:prose-base">
                    {{ shipping_policy.content|default:"<p>No shipping policy configured yet.</p>"|safe }}
                </div>
            </div>
        </div>
    </div>

    <!-- Return/Refund Policy Modal -->
    <div id="return-policy-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50">
        <div id="return-policy-modal-content" class="bg-white rounded-2xl shadow-2xl w-full max-w-3xl mx-auto transform transition-all duration-300 ease-in-out scale-95 opacity-0">
            <div class="p-6 md:p-8">
                <div class="flex justify-between items-start gap-4">
                    <div>
                        <h2 class="text-2xl md:text-3xl font-extrabold text-gray-900">
                            {{ return_policy.title|default:"Return & Cancellation Policy" }}
                        </h2>
                        <p class="text-sm text-gray-500 mt-1">Updated {{ return_policy.updated_at|date:"M d, Y" }}</p>
                    </div>
                    <button type="button" onclick="closeReturnPolicyModal()" class="text-gray-400 hover:text-gray-600 transition-colors">
                        <span class="sr-only">Close</span>
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                </div>
                <div class="mt-6 prose max-w-none prose-sm sm:prose-base">
                    {{ return_policy.content|default:"<p>No return/cancellation policy configured yet.</p>"|safe }}
                </div>
            </div>
        </div>
    </div>

    <!-- Fixed right-side logos (desktop & tablet landscape only) -->
    <div class="fixed-right-logos" aria-hidden="true" role="presentation">
        <div class="logo-item" aria-hidden="true">
            <img src="/media/Verified Supplier globesuggest.png" alt="Verified Supplier - globesuggest">
            <span class="tooltip" role="tooltip">Verified Supplier</span>
        </div>
        <div class="logo-item" aria-hidden="true">
            <img src="/media/Original Content By globesuggest.png" alt="Original Content - globesuggest">
            <span class="tooltip" role="tooltip">Original Content</span>
        </div>
        <div class="logo-item" aria-hidden="true" onclick="openQuickEnquiryPopup()" style="cursor: pointer;">
            <div class="h-14 w-14 rounded-full bg-gray-600 flex items-center justify-center">
                <i class="fas fa-bolt text-2xl text-white"></i>
            </div>
            <span class="tooltip" role="tooltip">Quick Enquiry</span>
        </div>
    </div>

    <!-- Mobile & tablet-portrait Quick Enquiry button (bottom-right) -->
    <div class="fixed bottom-3 right-3 z-40 lg:hidden">
        <button
            type="button"
            onclick="openQuickEnquiryPopup()"
            class="flex items-center gap-1.5 rounded-full bg-black text-white px-3 py-1.5 shadow-lg hover:bg-gray-900 active:scale-95 transition transform"
        >
            <span class="flex h-7 w-7 items-center justify-center rounded-full bg-white">
                <i class="fas fa-bolt text-lg text-black"></i>
            </span>
            <span class="flex flex-col items-start leading-tight">
                <span class="text-[10px] text-left font-semibold uppercase tracking-wide">Quick <br> Enquiry</span>
            </span>
        </button>
    </div>

    <!-- Mobile Search Overlay -->
    <div class="mobile-search-overlay" id="mobileSearchOverlay"></div>

    <!-- Mobile Search Button (Bottom-Left, transforms to top search bar) -->
    <button type="button" class="mobile-search-btn" id="mobileSearchBtn" aria-label="Search">
        <span class="search-icon-wrapper">
            <i class="fas fa-search search-icon" id="mobileSearchIcon"></i>
        </span>
        <input 
            type="text" 
            class="mobile-search-input" 
            id="mobileSearchInput"
            placeholder="Search on this page..."
            autocomplete="off"
        >
        <span class="mobile-search-close" id="mobileSearchClose">
            <i class="fas fa-times text-gray-500 text-sm"></i>
        </span>
    </button>

    <!-- Mobile Search Results Dropdown -->
    <div class="mobile-search-results" id="mobileSearchResults">
        <div class="p-4 text-center text-gray-500 text-sm" id="mobileSearchEmpty">
            Type to search content on this page
        </div>
        <div id="mobileSearchResultsList"></div>
    </div>

    <!-- Mobile Search Script -->
    <script>
        (function() {
            const searchBtn = document.getElementById('mobileSearchBtn');
            const searchInput = document.getElementById('mobileSearchInput');
            const searchOverlay = document.getElementById('mobileSearchOverlay');
            const searchResults = document.getElementById('mobileSearchResults');
            const searchResultsList = document.getElementById('mobileSearchResultsList');
            const searchEmpty = document.getElementById('mobileSearchEmpty');
            const searchClose = document.getElementById('mobileSearchClose');

            if (!searchBtn || !searchInput || !searchOverlay || !searchResults) return;

            let isSearchActive = false;
            let touchStarted = false;

            function openSearch() {
                if (isSearchActive) return;
                
                isSearchActive = true;
                searchBtn.classList.add('active');
                searchOverlay.classList.add('active');
                searchResults.classList.add('active');
                
                // Focus input after animation
                setTimeout(() => {
                    searchInput.focus();
                }, 350);
            }

            function closeSearch() {
                if (!isSearchActive) return;
                
                isSearchActive = false;
                searchBtn.classList.remove('active');
                searchOverlay.classList.remove('active');
                searchResults.classList.remove('active');
                searchInput.value = '';
                searchResultsList.innerHTML = '';
                searchEmpty.style.display = 'block';
                searchInput.blur();
            }

            // Button click/touch handlers
            searchBtn.addEventListener('touchstart', function(e) {
                if (isSearchActive) return; // Don't handle when already open
                touchStarted = true;
            }, { passive: true });

            searchBtn.addEventListener('touchend', function(e) {
                if (!touchStarted) return;
                if (isSearchActive) return;
                
                e.preventDefault();
                touchStarted = false;
                openSearch();
            });

            searchBtn.addEventListener('click', function(e) {
                if (touchStarted) {
                    touchStarted = false;
                    return; // Already handled by touch
                }
                if (isSearchActive) return;
                
                e.preventDefault();
                e.stopPropagation();
                openSearch();
            });

            // Close button handlers
            if (searchClose) {
                searchClose.addEventListener('touchend', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    closeSearch();
                });

                searchClose.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    closeSearch();
                });
            }

            // Overlay close handler
            searchOverlay.addEventListener('click', closeSearch);
            searchOverlay.addEventListener('touchend', function(e) {
                e.preventDefault();
                closeSearch();
            });

            // Input handler
            searchInput.addEventListener('input', function(e) {
                handleMobileSearchInput(this.value);
            });

            // Prevent input clicks from bubbling
            searchInput.addEventListener('click', function(e) {
                e.stopPropagation();
            });

            searchInput.addEventListener('touchend', function(e) {
                e.stopPropagation();
            });

            // Expose close function globally
            window.closeMobileSearch = closeSearch;

            // Search functionality
            let searchTimeout;
            function handleMobileSearchInput(query) {
                clearTimeout(searchTimeout);
                
                if (!query.trim()) {
                    searchResultsList.innerHTML = '';
                    searchEmpty.style.display = 'block';
                    return;
                }

                searchTimeout = setTimeout(() => {
                    performSearch(query.trim().toLowerCase());
                }, 200);
            }

            function performSearch(query) {
                searchEmpty.style.display = 'none';
                
                // Get all searchable text content from the page
                const searchableElements = document.querySelectorAll(
                    'main h1, main h2, main h3, main h4, main p, main li, main span:not([class*="hidden"]), main td, main th, [data-section] *'
                );
                
                const results = [];
                const seenTexts = new Set();

                searchableElements.forEach(el => {
                    const text = el.textContent || '';
                    const cleanText = text.trim();
                    
                    if (cleanText.length < 10 || cleanText.length > 500) return;
                    if (seenTexts.has(cleanText)) return;
                    
                    if (cleanText.toLowerCase().includes(query)) {
                        seenTexts.add(cleanText);
                        results.push({
                            text: cleanText,
                            element: el,
                            preview: getPreview(cleanText, query)
                        });
                    }
                });

                // Limit to 8 results
                const limitedResults = results.slice(0, 8);

                if (limitedResults.length === 0) {
                    searchResultsList.innerHTML = `
                        <div class="p-4 text-center text-gray-500 text-sm">
                            <i class="fas fa-search text-gray-300 text-2xl mb-2"></i>
                            <p>No results found for "<strong>${escapeHtml(query)}</strong>"</p>
                        </div>
                    `;
                    return;
                }

                searchResultsList.innerHTML = limitedResults.map((result, index) => `
                    <div 
                        class="px-4 py-3 border-b border-gray-100 hover:bg-gray-50 cursor-pointer transition-colors"
                        onclick="scrollToSearchResult(${index})"
                        data-search-result="${index}"
                    >
                        <div class="text-sm text-gray-800 line-clamp-2">${result.preview}</div>
                    </div>
                `).join('');

                // Store results for click handling
                window._mobileSearchResults = limitedResults;
            }

            function getPreview(text, query) {
                const lowerText = text.toLowerCase();
                const index = lowerText.indexOf(query);
                
                const start = Math.max(0, index - 40);
                const end = Math.min(text.length, index + query.length + 60);
                
                let preview = '';
                if (start > 0) preview += '...';
                
                const before = escapeHtml(text.substring(start, index));
                const match = escapeHtml(text.substring(index, index + query.length));
                const after = escapeHtml(text.substring(index + query.length, end));
                
                preview += before + '<mark class="bg-yellow-200 px-0.5 rounded">' + match + '</mark>' + after;
                
                if (end < text.length) preview += '...';
                
                return preview;
            }

            function escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }

            window.scrollToSearchResult = function(index) {
                const results = window._mobileSearchResults;
                if (!results || !results[index]) return;

                const element = results[index].element;
                
                // Close search first
                closeMobileSearch();

                // Scroll to element with offset for fixed header
                setTimeout(() => {
                    const headerOffset = 100;
                    const elementPosition = element.getBoundingClientRect().top;
                    const offsetPosition = elementPosition + window.pageYOffset - headerOffset;

                    window.scrollTo({
                        top: offsetPosition,
                        behavior: 'smooth'
                    });

                    // Highlight the element temporarily
                    element.style.transition = 'background-color 0.3s ease';
                    element.style.backgroundColor = 'rgba(253, 224, 71, 0.5)';
                    
                    setTimeout(() => {
                        element.style.backgroundColor = '';
                    }, 2000);
                }, 100);
            };

            // Close search on escape key
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && isSearchActive) {
                    closeMobileSearch();
                }
            });
        })();
    </script>

    <script>
        // Quick Enquiry popup + lead capture (reuses /api/enquiry/submit/)
        (function () {
            const popup = document.getElementById('quick-enquiry-popup');
            const popupContent = document.getElementById('quick-enquiry-popup-content');
            const mobileInput = document.getElementById('quick-enquiry-mobile');
            const statusEl = document.getElementById('quick-enquiry-status');
            const submitBtn = document.getElementById('quick-enquiry-submit-btn');

            if (!popup || !popupContent || !mobileInput || !statusEl || !submitBtn) return;

            window.openQuickEnquiryPopup = function () {
                popup.classList.remove('hidden');
                // Small delay so transition plays
                setTimeout(() => {
                    popupContent.classList.remove('scale-95', 'opacity-0');
                }, 50);
                statusEl.classList.add('hidden');
                statusEl.textContent = '';
                mobileInput.value = '';
                mobileInput.focus({ preventScroll: true });
            };

            window.closeQuickEnquiryPopup = function () {
                popupContent.classList.add('scale-95', 'opacity-0');
                setTimeout(() => {
                    popup.classList.add('hidden');
                }, 250);
            };

            function setStatus(message, ok = true) {
                statusEl.textContent = message;
                statusEl.classList.remove('hidden');
                statusEl.classList.remove('text-red-500', 'text-green-600');
                statusEl.classList.add(ok ? 'text-green-600' : 'text-red-500');
            }

            window.submitQuickEnquiry = async function () {
                const mobile = (mobileInput.value || '').trim();
                if (!mobile) {
                    setStatus('Please enter your mobile number.', false);
                    mobileInput.focus();
                    return;
                }

                const pid = "{{ product.id|default:'' }}";
                const pslug = "{{ product.slug|default:'' }}";
                const pname = "{{ product.product_title|default:'' }}";

                submitBtn.disabled = true;
                submitBtn.classList.add('opacity-70', 'cursor-not-allowed');
                setStatus('Submitting your enquiry...', true);

                try {
                    const resp = await fetch('/api/enquiry/submit/', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            product_id: pid,
                            product_slug: pslug,
                            product_name: pname,
                            mobile: mobile
                        })
                    });
                    const data = await resp.json().catch(() => ({}));
                    if (resp.ok && data.status === 'success') {
                        setStatus('Thank you! Our team will contact you shortly.', true);
                        setTimeout(() => {
                            closeQuickEnquiryPopup();
                        }, 900);
                    } else {
                        setStatus(data.message || 'Failed to submit. Please try again.', false);
                    }
                } catch (e) {
                    setStatus('Network error. Please try again.', false);
                } finally {
                    submitBtn.disabled = false;
                    submitBtn.classList.remove('opacity-70', 'cursor-not-allowed');
                }
            };

            // Close popup when clicking outside the content
            popup.addEventListener('click', function (evt) {
                if (evt.target === popup) {
                    closeQuickEnquiryPopup();
                }
            });
        })();
    </script>

    <script>
        // Shipping & Return modal handling
        (function () {
            const shippingModal = document.getElementById('shipping-policy-modal');
            const shippingContent = document.getElementById('shipping-policy-modal-content');
            const returnModal = document.getElementById('return-policy-modal');
            const returnContent = document.getElementById('return-policy-modal-content');

            function openModal(modal, content) {
                if (!modal || !content) return;
                modal.classList.remove('hidden');
                setTimeout(() => content.classList.remove('scale-95', 'opacity-0'), 50);
            }
            function closeModal(modal, content) {
                if (!modal || !content) return;
                content.classList.add('scale-95', 'opacity-0');
                setTimeout(() => modal.classList.add('hidden'), 250);
            }

            window.openShippingPolicyModal = function () { openModal(shippingModal, shippingContent); };
            window.closeShippingPolicyModal = function () { closeModal(shippingModal, shippingContent); };
            window.openReturnPolicyModal = function () { openModal(returnModal, returnContent); };
            window.closeReturnPolicyModal = function () { closeModal(returnModal, returnContent); };

            // Click handlers for links
            document.querySelectorAll('a[href="#shipping-policy"]').forEach(a => {
                a.addEventListener('click', function (e) {
                    e.preventDefault();
                    openShippingPolicyModal();
                });
            });
            document.querySelectorAll('a[href="#return-policy"]').forEach(a => {
                a.addEventListener('click', function (e) {
                    e.preventDefault();
                    openReturnPolicyModal();
                });
            });

            // Close on background click
            if (shippingModal) {
                shippingModal.addEventListener('click', function (e) {
                    if (e.target === shippingModal) closeShippingPolicyModal();
                });
            }
            if (returnModal) {
                returnModal.addEventListener('click', function (e) {
                    if (e.target === returnModal) closeReturnPolicyModal();
                });
            }

            // Open on hash
            if (location.hash === '#shipping-policy') { openShippingPolicyModal(); }
            if (location.hash === '#return-policy') { openReturnPolicyModal(); }
        })();
    </script>

    <script>
        // Single Video Playback - Only one video can play at a time (Desktop & Mobile)
        (function() {
            const videoSection = document.querySelector('[data-section="videos"]');
            if (!videoSection) return;

            // Get all HTML5 video elements in the video section
            const allVideos = videoSection.querySelectorAll('video');
            
            // Get all YouTube iframes in the video section
            const allIframes = videoSection.querySelectorAll('iframe');
            
            // Store YouTube player references
            const ytPlayers = new Map();
            
            // Function to pause all videos except the current one
            function pauseOtherVideos(currentVideo) {
                allVideos.forEach(video => {
                    if (video !== currentVideo && !video.paused) {
                        video.pause();
                    }
                });
                
                // Pause YouTube videos using postMessage API
                allIframes.forEach(iframe => {
                    try {
                        iframe.contentWindow.postMessage(JSON.stringify({
                            event: 'command',
                            func: 'pauseVideo',
                            args: []
                        }), '*');
                    } catch(e) {
                        // Iframe may not be accessible due to cross-origin
                    }
                });
            }
            
            // Function to pause all HTML5 videos when YouTube video plays
            function pauseAllHTML5Videos() {
                allVideos.forEach(video => {
                    if (!video.paused) {
                        video.pause();
                    }
                });
            }
            
            // Add play event listener to all HTML5 videos
            allVideos.forEach(video => {
                video.addEventListener('play', function() {
                    pauseOtherVideos(this);
                });
            });
            
            // Listen for YouTube player state changes via postMessage
            window.addEventListener('message', function(event) {
                try {
                    const data = typeof event.data === 'string' ? JSON.parse(event.data) : event.data;
                    
                    // YouTube sends state change events
                    if (data.event === 'onStateChange' || data.info?.playerState === 1) {
                        // State 1 = playing
                        if (data.info?.playerState === 1) {
                            pauseAllHTML5Videos();
                            
                            // Pause other YouTube iframes
                            allIframes.forEach(iframe => {
                                if (iframe.contentWindow !== event.source) {
                                    try {
                                        iframe.contentWindow.postMessage(JSON.stringify({
                                            event: 'command',
                                            func: 'pauseVideo',
                                            args: []
                                        }), '*');
                                    } catch(e) {}
                                }
                            });
                        }
                    }
                } catch(e) {
                    // Not a YouTube message or parsing error
                }
            });
            
            // Enable JS API listening for all YouTube iframes
            allIframes.forEach(iframe => {
                try {
                    iframe.contentWindow.postMessage(JSON.stringify({
                        event: 'listening',
                        id: iframe.src
                    }), '*');
                } catch(e) {}
            });
        })();
    </script>

</body>

</html>